!function(){function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,i=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(l){i=!0,r=l}finally{try{o||null==c.return||c.return()}finally{if(i)throw r}}return n}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return e(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,o=a(t);if(e){var i=a(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return r(this,n)}}function r(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{DE2N:function(e,o,r){"use strict";r.r(o),r.d(o,"ChatModule",function(){return ln});var a,l,u,d,b,f,m,p,h,g=r("SVse"),v=r("u9T3"),y=r("Tj54"),w=r("Dxy4"),O=r("SqCe"),j=r("8Qe2"),x=r("BSbQ"),k=r("pu8Q"),C=r("g7MM"),I=r("CSIE"),M=r("fi6C"),D=r("txmD"),P=r("uaks"),_=r("mjGE"),W=r("Wcq6"),V=r("8Y7J"),T=((b=function(){function t(){c(this,t)}return s(t,[{key:"transform",value:function(t){return t instanceof W.firestore.DocumentSnapshot?Object(_.b)(t):t}}]),t}()).\u0275fac=function(t){return new(t||b)},b.\u0275pipe=V.Pb({name:"snapshotData",type:b,pure:!0}),b),$=((d=function(){function t(){c(this,t)}return s(t,[{key:"transform",value:function(t){return t instanceof W.firestore.Timestamp?t.toDate():t}}]),t}()).\u0275fac=function(t){return new(t||d)},d.\u0275pipe=V.Pb({name:"timestamp",type:d,pure:!0}),d),L=((u=function(){function t(){c(this,t)}return s(t,[{key:"transform",value:function(t){var e,n=t instanceof W.firestore.DocumentSnapshot?Object(_.b)(t):t;return null===(e=null==n?void 0:n.created)||void 0===e?void 0:e.toDate()}}]),t}()).\u0275fac=function(t){return new(t||u)},u.\u0275pipe=V.Pb({name:"createdTime",type:u,pure:!0}),u),F=((l=function(){function t(){c(this,t)}return s(t,[{key:"transform",value:function(t){var e,n=t instanceof W.firestore.DocumentSnapshot?Object(_.b)(t):t;return null===(e=(null==n?void 0:n.updated)||(null==n?void 0:n.created))||void 0===e?void 0:e.toDate()}}]),t}()).\u0275fac=function(t){return new(t||l)},l.\u0275pipe=V.Pb({name:"updatedTime",type:l,pure:!0}),l),S=((a=function t(){c(this,t)}).\u0275mod=V.Ob({type:a}),a.\u0275inj=V.Nb({factory:function(t){return new(t||a)}}),a),G=r("C1VQ"),E=r("Entk"),U=["*"],A=((m=function t(){c(this,t)}).\u0275fac=function(t){return new(t||m)},m.\u0275cmp=V.Kb({type:m,selectors:[["wm-balloon"]],hostAttrs:[1,"wm-balloon"],hostVars:3,hostBindings:function(t,e){2&t&&V.Eb("side",e.side)("anchor",e.anchor)("color",e.color)},inputs:{side:"side",anchor:"anchor",color:"color"},ngContentSelectors:U,decls:2,vars:0,consts:[[1,"balloon-content"]],template:function(t,e){1&t&&(V.oc(),V.Wb(0,"div",0),V.nc(1),V.Vb())},styles:['.wm-balloon{position:relative;display:inline-block;border-radius:6px;box-sizing:border-box}.wm-balloon .balloon-content{position:relative;background-color:inherit;border-radius:inherit;padding:12px;overflow:hidden}.wm-balloon[side=bottom][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=bottom][anchor=center]:after,.wm-balloon[side=bottom][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=bottom][anchor=start]:after{left:12px}.wm-balloon[side=bottom]{margin-bottom:8.4px}.wm-balloon[side=bottom][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=left][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=left][anchor=center]:after,.wm-balloon[side=left][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=left][anchor=start]:after{top:12px}.wm-balloon[side=left]{margin-left:8.4px}.wm-balloon[side=left][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=right][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=right][anchor=center]:after,.wm-balloon[side=right][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=right][anchor=start]:after{top:12px}.wm-balloon[side=right]{margin-right:8.4px}.wm-balloon[side=right][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=top][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=top][anchor=center]:after,.wm-balloon[side=top][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;top:-1px;transform:translateY(-6px) rotate(-135deg)}.wm-balloon[side=top][anchor=start]:after{left:12px}.wm-balloon[side=top]{margin-top:8.4px}.wm-balloon[side=top][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;top:-1px;transform:translateY(-6px) rotate(-135deg)}'],encapsulation:2}),m),B=((f=function t(){c(this,t)}).\u0275mod=V.Ob({type:f}),f.\u0275inj=V.Nb({factory:function(t){return new(t||f)},imports:[[]]}),f),Q=r("XNpK"),z=r("EiPp"),J=r("kNiW"),R=r("sFr1"),N=((h=function(){function t(e,n){c(this,t),this.teleport=e,this.template=n}return s(t,[{key:"ngOnInit",value:function(){this.teleport.activate("toolbar",this.template,{align:this.wmToolbarAlign,gap:this.wmToolbarGap})}},{key:"ngOnChanges",value:function(t){this.ngOnInit()}},{key:"ngOnDestroy",value:function(){this.teleport.clear("toolbar",this.template)}}]),t}()).\u0275fac=function(t){return new(t||h)(V.Qb(z.b),V.Qb(V.O))},h.\u0275dir=V.Lb({type:h,selectors:[["ng-template","wmToolbar",""]],inputs:{wmToolbarAlign:"wmToolbarAlign",wmToolbarGap:"wmToolbarGap"},features:[V.Bb]}),h),X=((p=function t(){c(this,t)}).\u0275mod=V.Ob({type:p}),p.\u0275inj=V.Nb({factory:function(t){return new(t||p)}}),p);r("3wf5"),r("A8Sn");var K,q,Y=((q=function(){function t(e,n){c(this,t),this.teleport=e,this.template=n}return s(t,[{key:"ngOnInit",value:function(){this.teleport.activate("footer",this.template)}},{key:"ngOnDestroy",value:function(){this.teleport.clear("footer",this.template)}}]),t}()).\u0275fac=function(t){return new(t||q)(V.Qb(z.b),V.Qb(V.O))},q.\u0275dir=V.Lb({type:q,selectors:[["ng-template","wmFooter",""]]}),q),H=((K=function t(){c(this,t)}).\u0275mod=V.Ob({type:K}),K.\u0275inj=V.Nb({factory:function(t){return new(t||K)},imports:[[]]}),K),Z=r("u8yb"),tt=r("pvxE"),et=r("h4JL"),nt=r("U9eP"),ot=r("lWmb"),it=r("wSf6"),rt=r("JX91"),at=r("UXun"),ct=r("lJxs"),lt=r("/uUt"),st=r("eIep"),ut=r("eYWy"),dt=r("1Blm"),bt=r("rJgo"),ft=r("iInd"),mt=r("Qfjl"),pt=r("VDRc"),ht=r("a/j4"),gt=r("BTe0"),vt=r("xS4v"),yt=r("7/R1"),wt=r("iELJ"),Ot=r("n8oj"),jt=r("cpjW");function xt(t,e){1&t&&V.Rb(0,"mat-progress-bar",11)}function kt(t,e){if(1&t){var n=V.Xb();V.Wb(0,"div",12),V.Rb(1,"div",13),V.jc(2,"async"),V.jc(3,"async"),V.jc(4,"async"),V.Wb(5,"mat-icon",14),V.ec("click",function(t){return t.stopPropagation()}),V.Ic(6,"expand_more"),V.Vb(),V.Wb(7,"mat-menu",null,15),V.Wb(9,"button",16),V.jc(10,"async"),V.Ic(11),V.Vb(),V.Wb(12,"button",17),V.ec("click",function(){return V.yc(n),V.vc(15).open()}),V.Ic(13),V.Vb(),V.Wb(14,"wm-dialog",18,19),V.ec("closedChange",function(t){V.yc(n);var e=V.ic(2);return t&&e.delete()}),V.Wb(16,"h2",20),V.Wb(17,"b"),V.Ic(18),V.Vb(),V.Vb(),V.Wb(19,"mat-dialog-content",21),V.Ic(20," You're about to "),V.Wb(21,"b"),V.Ic(22,"delete"),V.Vb(),V.Ic(23," this conversation."),V.Rb(24,"br"),V.Ic(25,"Are you sure? "),V.Vb(),V.Wb(26,"mat-dialog-actions",22),V.Wb(27,"button",23),V.Ic(28),V.Vb(),V.Wb(29,"button",24),V.Ic(30),V.Vb(),V.Vb(),V.Vb(),V.Vb(),V.Vb()}if(2&t){var o,i,r=V.vc(8),a=V.ic().$implicit,c=V.ic();V.Db(1),V.Ib("unread",c.showUnread&&V.kc(2,15,c.unread$)>0)("skeleton-loading",!V.kc(3,17,c.sender$)),V.pc("wm-emoji-text",null==(o=V.kc(4,19,c.last$))?null:o.body),V.Db(4),V.pc("matMenuTriggerFor",r),V.Db(4),V.qc("routerLink","/@",null==(i=V.kc(10,21,c.sender$))?null:i.userName,""),V.Db(2),V.Jc((null==a.info?null:a.info.label)||"Contact info"),V.Db(2),V.Jc((null==a.delete?null:a.delete.label)||"Delete chat"),V.Db(5),V.Jc((null==a.confirmDelete?null:a.confirmDelete.title)||"Deleting chat"),V.Db(1),V.pc("wm-readme",null==a.confirmDelete?null:a.confirmDelete.message),V.Db(8),V.pc("mat-dialog-close",!1),V.Db(1),V.Jc((null==a.confirmDelete?null:a.confirmDelete.cancel)||"Abort"),V.Db(1),V.pc("mat-dialog-close",!0),V.Db(1),V.Jc((null==a.confirmDelete?null:a.confirmDelete.ok)||"Proceed")}}var Ct=function(){return{sameDay:"LT",lastDay:"[Yesterday]",lastWeek:"dddd",sameElse:"L"}};function It(t,e){if(1&t&&(V.Wb(0,"div",2),V.Wb(1,"div",3),V.jc(2,"async"),V.jc(3,"async"),V.Rb(4,"wm-avatar",4),V.jc(5,"async"),V.jc(6,"async"),V.Vb(),V.Wb(7,"div",5),V.Wb(8,"div",6),V.Wb(9,"div",7),V.jc(10,"async"),V.Ic(11),V.jc(12,"async"),V.jc(13,"async"),V.Vb(),V.Wb(14,"time",8),V.Ic(15),V.jc(16,"calendar"),V.jc(17,"updatedTime"),V.jc(18,"async"),V.Vb(),V.Vb(),V.Gc(19,xt,1,0,"ng-template",null,9,V.Hc),V.Gc(21,kt,31,23,"div",10),V.Vb(),V.Vb()),2&t){var n,o=e.$implicit,i=V.vc(20),r=V.ic();V.Db(1),V.pc("matBadge",r.unreadCount(V.kc(2,11,r.unread$)))("matBadgeHidden",!r.showUnread||V.kc(3,13,r.unread$)<=0),V.Db(3),V.Ib("skeleton-loading",!V.kc(5,15,r.sender$)),V.pc("src",null==(n=V.kc(6,17,r.sender$))?null:n.photo),V.Db(5),V.Ib("skeleton-loading",!V.kc(10,19,r.sender$)),V.Db(2),V.Jc(V.kc(12,21,r.sender$)?V.kc(13,23,r.sender$).fullName||o.unknownUser||"Unknown user":""),V.Db(4),V.Jc(V.lc(16,25,V.kc(17,28,V.kc(18,30,r.last$)||r.data),o.timeFormat||V.rc(32,Ct))),V.Db(6),V.pc("ngIf",!r.deleting)("ngIfElse",i)}}var Mt,Dt,Pt=function(t){return{with:t}},_t=((Mt=function(t){n(o,t);var e=i(o);function o(t,n){var i;return c(this,o),(i=e.call(this,t)).user=n,i._deleting=!1,i.deletingChange=new V.o,i}return s(o,[{key:"id",get:function(){return this.data.id}},{key:"me",get:function(){return this.user.uid}},{key:"deleting",get:function(){return this._deleting}},{key:"unknownUser",get:function(){return"unknown-".concat(this.data.id||"0")}},{key:"unreadCount",value:function(t){return t>10?"10+":null==t?void 0:t.toString()}},{key:"content",set:function(t){var e,n=this;if(!t||t.id!==(null===(e=this.ref)||void 0===e?void 0:e.id)){this.data=this.unwrap(t),this.data$=this.stream().pipe(Object(rt.a)(this.data),Object(at.a)(1)),this.thread$=this.collection("messages");var o=this.data.recipients.find(function(t){return t!==n.me})||"unknown";this.sender$=this.user.fromUserId(o).pipe(Object(ct.a)(function(t){return t||{userName:n.unknownUser}})),this.last$=this.thread$.stream(function(t){return t.orderBy("created").limitToLast(1)}).pipe(Object(ct.a)(function(t){return t[0]}),Object(at.a)(1)),this.unread$=this.data$.pipe(Object(ct.a)(function(t){var e,o;return null===(o=null===(e=null==t?void 0:t.status)||void 0===e?void 0:e[n.me])||void 0===o?void 0:o.lastRead}),Object(lt.a)(function(t,e){return!!t&&!!e&&t.isEqual(e)}),Object(st.a)(function(t){return n.thread$.pipe(Object(it.n)("sender","==",o),Object(it.g)("created"),Object(it.l)(t),Object(it.e)(11),Object(it.m)(n.db.zone),Object(ct.a)(function(t){return t.length}),Object(at.a)(1))}))}}},{key:"delete",value:function(){var t=this;return this.deletingChange.emit(this._deleting=!0),this.thread$.wipe(function(e){return e.where("sender","==",t.me).limit(100)}).then(function(e){return console.log("Messages deleted",e),t.update({recipients:t.db.arrayRemove(t.me)}).then(function(){return t.db.transaction(function(e){return e.get(t.ref).then(function(n){var o;(null===(o=null==n?void 0:n.recipients)||void 0===o?void 0:o.length)<=0&&e.delete(t.ref)})})})}).then(function(){return t.deletingChange.emit(t._deleting=!1)})}},{key:"onContextMenu",value:function(){var t;return null===(t=this.menuTrigger)||void 0===t||t.openMenu(),!1}}]),o}(dt.b)).\u0275fac=function(t){return new(t||Mt)(V.Qb(ut.b),V.Qb(ot.b))},Mt.\u0275cmp=V.Kb({type:Mt,selectors:[["wm-conversation"]],viewQuery:function(t,e){var n;1&t&&V.Lc(bt.d,1),2&t&&V.uc(n=V.fc())&&(e.menuTrigger=n.first)},hostVars:2,hostBindings:function(t,e){1&t&&V.ec("contextmenu",function(){return e.onContextMenu()}),2&t&&V.Eb("selected",e.highlight)("color",e.color)},inputs:{highlight:"highlight",color:"color",showUnread:"showUnread",content:"content"},outputs:{deletingChange:"deleting"},features:[V.Ab],decls:3,vars:6,consts:[["mat-button","","routerLink",".",3,"queryParams"],["fxLayout","row","fxLayoutAlign","start center",4,"wmContent","wmContentSelect"],["fxLayout","row","fxLayoutAlign","start center"],["fxFlex","0 0 auto","matBadgeSize","small",3,"matBadge","matBadgeHidden"],["color","primary",3,"src"],["fxFlex","1 1 auto","fxLayout","column","fxLayoutAlign","start stretch",1,"content"],["fxLayout","row","fxLayoutGap","8px"],["fxFlex","1 1 auto",1,"name","mat-title","text"],["fxFlex","0 0 auto",1,"time","mat-small"],["deletingProgress",""],["fxLayout","row",4,"ngIf","ngIfElse"],["color","primary","mode","indeterminate",1,"mat-body",2,"height","1em"],["fxLayout","row"],["fxFlex","1 1 auto",1,"last","mat-body","text",3,"wm-emoji-text"],["fxFlex","0 0 auto",1,"menu",3,"matMenuTriggerFor","click"],["menu","matMenu"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",3,"click"],[3,"closedChange"],["confirmDelete",""],["mat-dialog-title",""],[3,"wm-readme"],["align","end"],["mat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(t,e){var n;(1&t&&(V.Wb(0,"button",0),V.jc(1,"async"),V.Gc(2,It,22,33,"div",1),V.Vb()),2&t)&&(V.pc("queryParams",V.sc(4,Pt,null==(n=V.kc(1,2,e.sender$))?null:n.userName)),V.Db(2),V.pc("wmContentSelect","chat.conversation"))},directives:[w.b,ft.h,mt.a,pt.e,pt.d,pt.b,j.a,ht.a,pt.f,g.m,gt.a,vt.a,y.a,bt.d,bt.a,bt.b,yt.a,wt.h,wt.e,Ot.a,wt.c,wt.d],pipes:[g.b,jt.a,F],styles:["[_nghost-%COMP%]{position:relative;display:block;width:100%}[_nghost-%COMP%]   .mat-button[_ngcontent-%COMP%]{width:100%;text-align:left;padding:8px 16px}[_nghost-%COMP%]   .wm-avatar[_ngcontent-%COMP%]{width:56px;height:56px;margin-right:6px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .unread[_ngcontent-%COMP%]{font-weight:600}[_nghost-%COMP%]   .menu[_ngcontent-%COMP%]{transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}"]}),Mt),Wt=r("WIkw"),Vt=((Dt=function t(){c(this,t)}).\u0275mod=V.Ob({type:Dt}),Dt.\u0275inj=V.Nb({factory:function(t){return new(t||Dt)},imports:[[g.c,ft.k,v.a,j.b,w.c,y.b,bt.c,gt.b,Wt.b,G.a,E.a,Q.b,C.c,tt.a,S]]}),Dt),Tt=r("GJmQ"),$t=r("h0Qx");function Lt(t,e){if(1&t&&(V.Wb(0,"div"),V.Wb(1,"b"),V.Ic(2),V.jc(3,"async"),V.Vb(),V.Vb()),2&t){var n,o=V.ic(2);V.Db(2),V.Jc(null==(n=V.kc(3,1,o.sender$))?null:n.fullName)}}function Ft(t,e){if(1&t&&(V.Wb(0,"span",9),V.Rb(1,"wm-icon",10),V.Wb(2,"span"),V.Ic(3),V.Vb(),V.Vb()),2&t){var n=V.ic().$implicit;V.Db(1),V.pc("icon",(null==n.delete?null:n.delete.icon)||"error_outline"),V.Db(2),V.Jc((null==n.delete?null:n.delete.message)||"This message has been deleted")}}function St(t,e){if(1&t&&V.Rb(0,"span",11),2&t){var n=V.ic(2);V.pc("wm-emoji-text",null==n.data?null:n.data.body)}}function Gt(t,e){if(1&t){var n=V.Xb();V.Ub(0),V.Wb(1,"mat-icon",12),V.Ic(2,"expand_more"),V.Vb(),V.Wb(3,"mat-menu",null,13),V.Wb(5,"button",14),V.ec("click",function(){return V.yc(n),V.ic(2).delete()}),V.Ic(6),V.Vb(),V.Vb(),V.Tb()}if(2&t){var o=V.vc(4),i=V.ic().$implicit;V.Db(1),V.pc("matMenuTriggerFor",o),V.Db(5),V.Jc((null==i.delete?null:i.delete.label)||"Delete message")}}function Et(t,e){if(1&t&&(V.Ub(0),V.Wb(1,"wm-balloon",1),V.Wb(2,"div",2),V.Gc(3,Lt,4,3,"div",3),V.Wb(4,"div",4),V.Gc(5,Ft,4,2,"span",5),V.jc(6,"async"),V.Gc(7,St,1,1,"ng-template",null,6,V.Hc),V.Rb(9,"span",7),V.Wb(10,"time",8),V.Ic(11),V.jc(12,"moment"),V.jc(13,"timestamp"),V.Vb(),V.Gc(14,Gt,7,2,"ng-container",3),V.Vb(),V.Vb(),V.Vb(),V.Tb()),2&t){var n=e.$implicit,o=V.vc(8),i=V.ic();V.Db(1),V.pc("color",(null==i.data?null:i.data.sender)===i.me?"accent":"primary")("side",(null==i.data?null:i.data.sender)===i.me?"right":"left")("anchor",(null==i.data?null:i.data.sender)!==i.thread?"start":""),V.Db(2),V.pc("ngIf",(null==i.data?null:i.data.sender)!==i.thread),V.Db(2),V.pc("ngIf",V.kc(6,8,i.deleted$))("ngIfElse",o),V.Db(6),V.Jc(V.lc(12,10,V.kc(13,13,null==i.data?null:i.data.created),n.timeFormat||"LT")),V.Db(3),V.pc("ngIf",(null==i.data?null:i.data.sender)===i.me)}}var Ut,At,Bt=((At=function(t){n(o,t);var e=i(o);function o(t,n){var i;return c(this,o),(i=e.call(this,t)).user=n,i.dataChange=new V.o,i}return s(o,[{key:"id",get:function(){return this.data.id}},{key:"me",get:function(){return this.user.uid}},{key:"message",set:function(t){this.data=this.unwrap(t),this.sender$=this.user.fromUserId(this.data.sender),this.deleted$=this.asObservable().pipe(Object(ct.a)(function(t){return!t.exists}),Object(rt.a)(!t.exists),Object(Tt.a)(function(t){return!t},!0),Object(lt.a)()),this.dataChange.emit(this.data)}},{key:"onContextMenu",value:function(){var t;return null===(t=this.menuTrigger)||void 0===t||t.openMenu(),!1}}]),o}(dt.b)).\u0275fac=function(t){return new(t||At)(V.Qb(ut.b),V.Qb(ot.b))},At.\u0275cmp=V.Kb({type:At,selectors:[["wm-message"]],viewQuery:function(t,e){var n;1&t&&V.Lc(bt.d,1),2&t&&V.uc(n=V.fc())&&(e.menuTrigger=n.first)},hostAttrs:[1,"wm-message"],hostVars:4,hostBindings:function(t,e){1&t&&V.ec("contextmenu",function(){return e.onContextMenu()}),2&t&&V.Ib("in",(null==e.data?null:e.data.sender)!==e.me)("out",(null==e.data?null:e.data.sender)===e.me)},inputs:{thread:"thread",message:"message"},outputs:{dataChange:"data"},features:[V.Ab],decls:1,vars:1,consts:[[4,"wmContent","wmContentSelect"],[1,"mat-elevation-z2",3,"color","side","anchor"],["fxLayout","column","fxLayoutAlign","start stretch","fxLayoutGap","2px"],[4,"ngIf"],["fxLayout","row"],["class","deleted",4,"ngIf","ngIfElse"],["messageBody",""],[1,"spacer"],[1,"time","mat-small"],[1,"deleted"],[3,"icon"],[3,"wm-emoji-text"],[1,"menu",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"]],template:function(t,e){1&t&&V.Gc(0,Et,15,15,"ng-container",0),2&t&&V.pc("wmContentSelect","chat.message")},directives:[mt.a,A,pt.e,pt.d,pt.f,g.m,$t.a,vt.a,y.a,bt.d,bt.a,bt.b],pipes:[g.b,jt.c,$],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-flow:row;padding:0 2vw}.in[_nghost-%COMP%]{justify-content:flex-start}.out[_nghost-%COMP%]{justify-content:flex-end}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .deleted[_ngcontent-%COMP%]{opacity:.5;font-style:italic}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{display:inline-block;width:48px}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:5px;bottom:0;opacity:.5}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{position:absolute;right:5px;top:0;background-color:inherit;cursor:pointer;transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}"]}),At),Qt=((Ut=function t(){c(this,t)}).\u0275mod=V.Ob({type:Ut}),Ut.\u0275inj=V.Nb({factory:function(t){return new(t||Ut)},imports:[[g.c,v.a,y.b,bt.c,Wt.b,D.a,B,tt.a,S,C.c]]}),Ut),zt=r("o4Yh"),Jt=r("8LU1"),Rt=r("OWci"),Nt=r("0zyZ"),Xt=r("eyIN"),Kt=r("ZFy/"),qt=r("0qK6"),Yt=r("Q2Ze"),Ht=r("e6WT"),Zt=r("nGdH"),te=r("8sFK"),ee=r("gX7t"),ne=r("H7fF"),oe=r("XtK9");function ie(t,e){if(1&t){var n=V.Xb();V.Wb(0,"mat-form-field",8),V.Wb(1,"mat-label"),V.Ic(2),V.Vb(),V.Wb(3,"textarea",9),V.ec("valueChange",function(t){return V.yc(n),V.ic(2).value=t}),V.Ic(4,"      "),V.Vb(),V.Wb(5,"wm-icon",10),V.ec("mousedown",function(){V.yc(n);var t=V.ic(2);return!t.disabled&&t.toggleEmojiKeys()}),V.Vb(),V.Vb()}if(2&t){var o=V.ic().$implicit,i=V.ic();V.Db(2),V.Jc(o.placeholder||"Type a message"),V.Db(1),V.pc("value",i.value)("newline",i.enterMode)("disabled",i.disabled),V.Db(2),V.Ib("color-disabled",i.disabled),V.pc("icon",(null==o.emoji?null:o.emoji.icon)||"insert_emoticon")("matTooltip",(null==o.emoji?null:o.emoji.tooltip)||"Insert an emoji")}}function re(t,e){if(1&t){var n=V.Xb();V.Wb(0,"mat-form-field",8),V.Wb(1,"mat-label"),V.Ic(2),V.Vb(),V.Wb(3,"wm-emoji-input",11),V.ec("valueChange",function(t){return V.yc(n),V.ic(2).value=t}),V.Vb(),V.Wb(4,"wm-icon",10),V.ec("mousedown",function(){V.yc(n);var t=V.ic(2);return!t.disabled&&t.toggleEmojiKeys()}),V.Vb(),V.Vb()}if(2&t){var o=V.ic().$implicit,i=V.ic();V.Db(2),V.Jc(o.placeholder||"Type a message"),V.Db(1),V.pc("value",i.value)("newline",i.enterMode)("disabled",i.disabled),V.Db(1),V.Ib("color-disabled",i.disabled),V.pc("icon",(null==o.emoji?null:o.emoji.icon)||"insert_emoticon")("matTooltip",(null==o.emoji?null:o.emoji.tooltip)||"Insert an emoji")}}function ae(t,e){if(1&t){var n=V.Xb();V.Ub(0),V.Wb(1,"div",1),V.ec("keydown",function(t){return V.yc(n),V.ic().sendOnEnter(t)}),V.Gc(2,ie,6,8,"mat-form-field",2),V.Gc(3,re,5,8,"ng-template",null,3,V.Hc),V.Wb(5,"button",4),V.ec("mousedown",function(){return V.yc(n),V.ic().sendNow()}),V.Rb(6,"wm-icon",5),V.Vb(),V.Vb(),V.Wb(7,"mat-expansion-panel",6),V.ec("afterExpand",function(){return V.yc(n),V.ic().expanded.emit()}),V.Wb(8,"wm-emoji-keyboard",7),V.ec("keyPressed",function(t){V.yc(n);var e=V.ic();return!e.disabled&&e.typein(t)}),V.Vb(),V.Vb(),V.Tb()}if(2&t){var o=e.$implicit,i=V.vc(4),r=V.ic();V.Db(2),V.pc("ngIf","native"===r.mode)("ngIfElse",i),V.Db(3),V.pc("disabled",r.disabled||!r.valid),V.Db(1),V.pc("icon",(null==o.send?null:o.send.icon)||"send")("matTooltip",(null==o.send?null:o.send.tooltip)||"Send"),V.Db(2),V.pc("favorites",r.keys)("mode",r.mode)}}var ce,le,se,ue=((ce=function(){function t(e,n){c(this,t),this.utils=e,this.touch=n,this._disabled=!1,this.valueChange=new V.o,this.expanded=new V.o,this.send=new V.o}return s(t,[{key:"value",get:function(){return this._value},set:function(t){this.valueChange.emit(this._value=t)}},{key:"disabled",get:function(){return this._disabled},set:function(t){var e;(this._disabled=Object(Jt.c)(t))&&(null===(e=this.emojiKeysPanel)||void 0===e||e.close())}},{key:"typein",value:function(t){var e;return null===(e=this.typeinAdapter)||void 0===e||e.typein(t),!1}},{key:"toggleEmojiKeys",value:function(){return this.emojiKeysPanel.toggle(),!1}},{key:"mode",get:function(){return this.utils.emojiMode()}},{key:"enterMode",get:function(){return this.touch?"always":"shift"}},{key:"sendOnEnter",value:function(t){return this.touch||t.shiftKey||"Enter"!==t.key||this.sendNow()}},{key:"valid",get:function(){return null===(this.value||"").match(/^\s*$/)}},{key:"sendNow",value:function(){return this.valid&&this.send.emit(this.value),!1}}]),t}()).\u0275fac=function(t){return new(t||ce)(V.Qb(Xt.c),V.Qb(Rt.b))},ce.\u0275cmp=V.Kb({type:ce,selectors:[["wm-composer"]],viewQuery:function(t,e){var n;1&t&&(V.Lc(zt.c,1),V.Lc(Nt.b,1)),2&t&&(V.uc(n=V.fc())&&(e.emojiKeysPanel=n.first),V.uc(n=V.fc())&&(e.typeinAdapter=n.first))},hostAttrs:[1,"wm-composer"],inputs:{value:"value",keys:"keys",disabled:"disabled"},outputs:{valueChange:"valueChange",expanded:"expanded",send:"send"},decls:1,vars:1,consts:[[4,"wmContent","wmContentSelect"],["fxLayout","row","fxLayoutAlign","center end",1,"input",3,"keydown"],["appearance","legacy","fxFlex","1 1 auto",4,"ngIf","ngIfElse"],["webMode",""],["mat-icon-button","",3,"disabled","mousedown"],[3,"icon","matTooltip"],["hideToggle","",1,"padding-0","mat-elevation-z0",3,"afterExpand"],[3,"favorites","mode","keyPressed"],["appearance","legacy","fxFlex","1 1 auto"],["matInput","","typein","","cdkTextareaAutosize","","cdkAutosizeMinRows","1",3,"value","newline","disabled","valueChange"],["inline","","matSuffix","",1,"tools",3,"icon","matTooltip","mousedown"],["matEmoji","","typein","",3,"value","newline","disabled","valueChange"]],template:function(t,e){1&t&&V.Gc(0,ae,9,7,"ng-container",0),2&t&&V.pc("wmContentSelect","chat.composer")},directives:[mt.a,pt.e,pt.d,g.m,w.b,$t.a,Kt.b,zt.c,qt.a,Yt.c,pt.b,Yt.g,Ht.b,Zt.a,te.b,ee.a,Yt.i,ne.a,oe.a],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-flow:column;justify-content:center;align-items:stretch;box-sizing:border-box;margin-top:5px}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{margin:0 20px}[_nghost-%COMP%]   .wm-emoji-input[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{word-break:break-all}[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{cursor:pointer;vertical-align:middle}[_nghost-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{margin-bottom:10px}"]}),ce),de=r("UYqx"),be=r("KRLS"),fe=r("glvt"),me=((le=function t(){c(this,t)}).\u0275mod=V.Ob({type:le}),le.\u0275inj=V.Nb({factory:function(t){return new(t||le)},imports:[[g.c,v.a,w.c,Ht.c,Yt.e,zt.b,Kt.c,de.b,be.a,fe.a,C.c,D.a,Nt.a]]}),le),pe=r("lPMd"),he=r("IzEk"),ge=r("LRne"),ve=((se=function(t){n(o,t);var e=i(o);function o(t,n,i){var r;return c(this,o),(r=e.call(this,t,"conversations")).user=n,r.router=i,r}return s(o,[{key:"me",get:function(){return this.user.uid}},{key:"canActivate",value:function(t,e){var n,o=this,i=t.queryParamMap.get("with");return!(!this.user.auth.authenticated||i==(null===(n=this.user.data)||void 0===n?void 0:n.userName))&&(i?i.startsWith("unknown-")?Object(ge.a)(!0):this.user.fromUserName(i).pipe(Object(he.a)(1),Object(st.a)(function(t){if(!t||t.id===o.me)return Object(ge.a)(!1);var e=o.ref.doc(o.me<t.id?o.me.concat(t.id):t.id.concat(o.me)),n=o.db.arrayUnion(o.user.uid,t.id);return o.db.transaction(function(t){return t.snap(e).then(function(o){return o.exists?t.merge(e,{recipients:n}):t.set(e,{recipients:n}),!0})})})):this.pipe(Object(it.j)(function(t){return t.where("recipients","array-contains",o.me).orderBy("updated","desc").limit(1)}),Object(it.d)(),Object(st.a)(function(t){if(t.empty)return Object(ge.a)(!0);var n=t.docs[0].data().recipients.find(function(t){return t!=o.me});return o.user.fromUserId(n).pipe(Object(he.a)(1),Object(ct.a)(function(n){var i=(null==n?void 0:n.userName)||"unknown-".concat(t.docs[0].id);return o.router.createUrlTree(e.url.split("/"),{queryParams:{with:i}})}))})))}}]),o}(pe.a)).\u0275fac=function(t){return new(t||se)(V.ac(ut.b),V.ac(ot.b),V.ac(ft.g))},se.\u0275prov=V.Mb({token:se,factory:se.\u0275fac,providedIn:"root"}),se),ye=r("FQpF"),we=r("pLZG"),Oe=r("wO+i"),je=r("3E0/"),xe=r("vkgz"),ke=r("1G5W"),Ce=r("zP0r"),Ie=r("2Vo4"),Me=r("itXk"),De=r("DwbE"),Pe=r("j8uH"),_e=r("GS7A"),We="450ms cubic-bezier(0.8, -0.5, 0.2, 1.5)",Ve=[Object(_e.o)("pop",[Object(_e.n)(":enter",[Object(_e.m)({transform:"scale(0.5)",opacity:0}),Object(_e.e)(We,Object(_e.m)("*"))]),Object(_e.n)(":leave",Object(_e.e)(We,Object(_e.m)({transform:"scale(0.5)",opacity:0})))])],Te=r("FkMH"),$e=r("mx0f"),Le=r("glcp"),Fe=r("U3RD"),Se=r("++Qg"),Ge=r("q9NA");function Ee(t,e){if(1&t&&V.Rb(0,"wm-icon",13),2&t){var n=V.ic(2).$implicit;V.pc("icon",(null==n.conversation||null==n.conversation.new?null:n.conversation.new.icon)||"add_comment")}}function Ue(t,e){if(1&t&&V.Ic(0),2&t){var n=V.ic(2).$implicit;V.Jc((null==n.conversation||null==n.conversation.new?null:n.conversation.new.caption)||"New chat")}}function Ae(t,e){if(1&t){var n=V.Xb();V.Wb(0,"wm-conversation",16),V.ec("deleting",function(t){V.yc(n);var e=V.ic(6);return e.onDeleting(t,e.conv.id)})("click",function(){V.yc(n);var t=V.ic(6);return t.browse=!t.browse}),V.Vb()}if(2&t){var o=V.ic(2).ngIf;V.pc("content",o)}}function Be(t,e){1&t&&(V.Ub(0),V.Gc(1,Ae,1,1,"wm-conversation",15),V.Tb())}function Qe(t,e){if(1&t){var n=V.Xb();V.Wb(0,"wm-conversation",17),V.ec("deleting",function(t){V.yc(n);var o=e.$implicit;return V.ic(5).onDeleting(t,o.id)})("click",function(){V.yc(n);var t=V.ic(3).isMobile,e=V.ic(2);return t&&(e.browse=!e.browse)}),V.Vb()}if(2&t){var o=e.$implicit,i=V.ic().ngIf;V.pc("content",o)("highlight",o.id===i.id)("showUnread",o.id!==i.id)}}function ze(t,e){if(1&t&&(V.Ub(0),V.Gc(1,Be,2,0,"ng-container",5),V.Gc(2,Qe,1,3,"wm-conversation",14),V.jc(3,"async"),V.Tb()),2&t){var n=V.ic(2).isMobile,o=V.ic(2);V.Db(1),V.pc("ngIf",n),V.Db(1),V.pc("ngForOf",V.kc(3,3,o.conversations$))("ngForTrackBy",o.trackById)}}function Je(t,e){if(1&t&&(V.Gc(0,ze,4,5,"ng-container",5),V.jc(1,"async")),2&t){var n=V.ic(3);V.pc("ngIf",V.kc(1,1,n.activeConversation$))}}function Re(t,e){if(1&t){var n=V.Xb();V.Wb(0,"button",9),V.Gc(1,Ee,1,1,"wm-icon",10),V.Gc(2,Ue,1,1,"ng-template",null,11,V.Hc),V.Vb(),V.Gc(4,Je,2,3,"ng-template",12),V.jc(5,"async"),V.ec("openedChange",function(t){return V.yc(n),V.ic(2).browse=t})}if(2&t){var o,i=e.isMobile,r=V.vc(3),a=V.ic().$implicit,c=V.ic();V.pc("routerLink",(null==a.conversation||null==a.conversation.new?null:a.conversation.new.link)||"/explore/people"),V.Db(1),V.pc("ngIf",i)("ngIfElse",r),V.Db(3),V.pc("opened",(null==(o=V.kc(5,4,c.conversations$))?null:o.length)>0&&(c.browse||!i))}}function Ne(t,e){1&t&&(V.Wb(0,"div",18),V.Rb(1,"mat-spinner",19),V.Vb())}var Xe=function(){return{sameDay:"[Today]",lastDay:"[Yesterday]",lastWeek:"dddd",sameElse:"L"}};function Ke(t,e){if(1&t&&(V.Ub(0),V.Wb(1,"wm-balloon",22),V.Ic(2),V.jc(3,"calendar"),V.jc(4,"createdTime"),V.Vb(),V.Tb()),2&t){var n=V.ic().$implicit,o=V.ic(2).$implicit;V.Db(2),V.Jc(V.lc(3,1,V.kc(4,4,n),(null==o.thread?null:o.thread.timeFormat)||V.rc(6,Xe)))}}function qe(t,e){if(1&t&&(V.Ub(0),V.Gc(1,Ke,5,7,"ng-container",5),V.jc(2,"moment"),V.jc(3,"createdTime"),V.jc(4,"moment"),V.jc(5,"createdTime"),V.Rb(6,"wm-message",21),V.jc(7,"snapshotData"),V.Tb()),2&t){var n,o=e.$implicit,i=e.index,r=V.ic().ngIf;V.Db(1),V.pc("ngIf",0===i||V.lc(2,3,V.kc(3,6,r[i-1]),"D")!==V.lc(4,8,V.kc(5,11,o),"D")),V.Db(5),V.pc("thread",null==(n=V.kc(7,13,r[i-1]))?null:n.sender)("message",o)}}function Ye(t,e){if(1&t&&(V.Ub(0),V.Gc(1,qe,8,15,"ng-container",20),V.Tb()),2&t){var n=e.ngIf,o=V.ic(2);V.Db(1),V.pc("ngForOf",n)("ngForTrackBy",o.trackById)}}function He(t,e){if(1&t){var n=V.Xb();V.Wb(0,"button",24),V.ec("click",function(){return V.yc(n),V.ic(3).scrollToBottom()}),V.Wb(1,"mat-icon"),V.Ic(2,"expand_more"),V.Vb(),V.Vb()}2&t&&V.pc("@pop",void 0)}function Ze(t,e){if(1&t&&(V.Gc(0,He,3,1,"button",23),V.jc(1,"async")),2&t){var n=V.ic(2);V.pc("ngIf",V.kc(1,1,n.scrolled$))}}function tn(t,e){if(1&t){var n=V.Xb();V.Wb(0,"wm-composer",25),V.ec("valueChange",function(t){return V.yc(n),V.ic(2).text=t})("expanded",function(){return V.yc(n),V.ic(2).onKeyboardExpand()})("send",function(t){return V.yc(n),V.ic(2).send(t)}),V.Vb()}if(2&t){var o=V.ic(2);V.pc("value",o.text)("keys",o.keys)("disabled",!o.recipient||o.loading||o.deleting)}}function en(t,e){if(1&t&&(V.Wb(0,"wm-dialog",26),V.Wb(1,"h2",27),V.Wb(2,"b"),V.Ic(3),V.Vb(),V.Vb(),V.Wb(4,"mat-dialog-content",28),V.Ic(5," You're about to leave the page without sending the last message. "),V.Vb(),V.Wb(6,"mat-dialog-actions",29),V.Wb(7,"button",30),V.Ic(8),V.Vb(),V.Wb(9,"button",31),V.Ic(10),V.Vb(),V.Vb(),V.Vb()),2&t){var n=e.ngIf,o=V.ic(2);V.pc("dontLeave",!!o.text),V.Db(3),V.Jc(n.title||"Unsent message"),V.Db(1),V.pc("wm-readme",n.message),V.Db(3),V.pc("mat-dialog-close",!1),V.Db(1),V.Jc(n.cancel||"Wait"),V.Db(1),V.pc("mat-dialog-close",!0),V.Db(1),V.Jc(n.ok||"Proceed")}}function nn(t,e){if(1&t&&(V.Ub(0,1),V.Gc(1,Re,6,6,"ng-template",2),V.Wb(2,"div",3),V.Gc(3,Ne,2,0,"div",4),V.Gc(4,Ye,2,2,"ng-container",5),V.jc(5,"async"),V.Vb(),V.Gc(6,Ze,2,3,"ng-template",6),V.Gc(7,tn,1,3,"wm-composer",7),V.Gc(8,en,11,7,"wm-dialog",8),V.Tb()),2&t){var n=e.$implicit,o=V.ic();V.Db(3),V.pc("ngIf",o.loading),V.Db(1),V.pc("ngIf",V.kc(5,3,o.messages$)),V.Db(4),V.pc("ngIf",n.canLeave)}}var on,rn=((on=function(e){n(r,e);var o=i(r);function r(e,n,i,a,l,s,u){var d;c(this,r),(d=o.call(this,e,"conversations")).route=n,d.router=i,d.scroller=a,d.user=l,d.regex=s,d.zone=u,d.reload$=new Ie.a(null),d.loading=!0,d.browse=!0,d.deletingCount=0,d.autoScroll=!0,d.stats={"\ud83d\ude02":1,"\ud83d\udc4b\ud83c\udffb":1,"\ud83d\udc4d":1,"\ud83d\udc95":1,"\ud83d\ude4f":1},d.text="",d.recipient="",d.conversations$=d.reload$.pipe(Object(st.a)(function(){return d.pipe(Object(it.n)("recipients","array-contains",d.me),Object(it.g)("created","desc"),function(t){return t.pipe(Object(it.k)(),Object(ct.a)(function(t){return{cursor:t[0],convs:d.sortByUpdated(t,"desc")}}),Object(ye.a)(function(e){var n=e.cursor,o=e.convs;return t.pipe(Object(it.c)(n),Object(it.f)(u),Object(we.a)(function(t){return t.size>0&&!t.metadata.hasPendingWrites}),Object(it.b)(),Object(he.a)(1),Object(ct.a)(function(t){return{cursor:t[0],convs:t.concat(o)}}))}),Object(Oe.a)("convs"))},Object(at.a)(1))})),d.conversationId$=n.queryParamMap.pipe(Object(ct.a)(function(t){return t.get("with")||""}),Object(lt.a)(),Object(je.a)(0),Object(st.a)(function(t){return t.startsWith("unknown-")?(d.recipient="",Object(ge.a)(t.replace(/^unknown-/,""))):l.fromUserName(t).pipe(Object(he.a)(1),Object(ct.a)(function(t){return t?(d.recipient=t.id,d.me<t.id?d.me.concat(t.id):d.recipient.concat(d.me)):d.recipient=""}))}),Object(at.a)(1)),d.activeConversation$=Object(Me.a)(d.conversations$,d.conversationId$).pipe(Object(ct.a)(function(e){var n=t(e,2),o=n[0],i=n[1];return(null==o?void 0:o.find(function(t){return t.id===i}))||{}}));var b=a.pipe(Object(ct.a)(function(t){return t.top<50}),Object(lt.a)(),Object(we.a)(function(t){return t}),Object(ct.a)(function(){return 20}),Object(xe.a)(function(){return d.loading=!0}));return d.messages$=d.conversationId$.pipe(Object(ct.a)(function(t){return d.conversation=t&&d.document(t)}),Object(ct.a)(function(t){return d.thread=t&&t.collection("messages")}),Object(st.a)(function(t){return t?t.pipe(Object(it.g)("created"),function(t){return t.pipe(Object(it.i)(b),Object(ye.a)(function(e){return t.pipe(Object(it.l)(e[e.length-1]),Object(it.f)(d.db.zone),Object(we.a)(function(t){return t.size>0&&!t.metadata.hasPendingWrites}),Object(it.b)(),Object(he.a)(1),Object(ct.a)(function(t){return e.concat(t)}))}),Object(rt.a)([]))}):Object(ge.a)([])}),Object(Pe.f)(u,function(){d.autoScroll&&d.scrollToBottom(),d.loading=!1}),Object(at.a)(1)),d.scrolled$=a.pipe(Object(ct.a)(function(t){return t.bottom>=50}),Object(lt.a)(),Object(xe.a)(function(t){return d.autoScroll=!t}),Object(Pe.d)(d.zone)),d}return s(r,[{key:"deleting",get:function(){return this.deletingCount>0}},{key:"me",get:function(){return this.user.uid}},{key:"ngAfterViewInit",value:function(){var t=this;this.sub=this.conversationId$.pipe(Object(st.a)(function(e){return t.fromId(e).pipe(Object(he.a)(1))}),Object(ct.a)(function(e){var n;return null===(n=null==e?void 0:e.status)||void 0===n?void 0:n[t.me]}),Object(xe.a)(function(e){console.log("Loading",e),t.stats=(null==e?void 0:e.favorites)||t.stats,t.keys=t.sortFavorites(t.stats)}),Object(ye.a)(function(e){return t.lastMessage().pipe(Object(ke.a)(t.conversationId$.pipe(Object(Ce.a)(1))),Object(ct.a)(function(t){return null==t?void 0:t.created}),Object(we.a)(function(t){return!!t&&(!(null==e?void 0:e.lastRead)||t>e.lastRead)}),Object(st.a)(function(e){var n,o,i,r={favorites:t.stats,lastRead:e};return console.log("Saving data",r),t.conversation.merge({status:(n={},o=t.me,i=r,o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i,n)}).then(function(){return r})}),Object(he.a)(1))})).subscribe()}},{key:"ngOnDestroy",value:function(){this.sub.unsubscribe()}},{key:"fromId",value:function(t){var e=this;return this.zone.onStable.pipe(Object(he.a)(1),Object(st.a)(function(){return e.conversationsList.changes.pipe(Object(rt.a)(null))}),Object(ct.a)(function(){return e.conversationsList.find(function(e){return e.id===t})}),Object(we.a)(function(t){return!!t}),Object(lt.a)(void 0,function(t){return t.id}),Object(st.a)(function(t){return t.data$}))}},{key:"lastMessage",value:function(){var t=this;return this.zone.onStable.pipe(Object(he.a)(1),Object(st.a)(function(){return t.messagesList.changes.pipe(Object(rt.a)(null))}),Object(ct.a)(function(){var e;return null===(e=t.messagesList.last)||void 0===e?void 0:e.data}),Object(lt.a)())}},{key:"onDeleting",value:function(t,e){this.deletingCount=this.deletingCount+(t?1:-1),this.deletingCount<=0&&(this.text="",this.reload())}},{key:"reload",value:function(){var t=this;return this.router.navigate(["."],{relativeTo:this.route,replaceUrl:!0}).then(function(){return t.reload$.next()})}},{key:"scrollToBottom",value:function(){this.scroller.scrollTo({bottom:0})}},{key:"onKeyboardExpand",value:function(){this.autoScroll&&this.scrollToBottom()}},{key:"send",value:function(t){var e=this;return this.updateFavorites(t),this.thread.add({body:t,sender:this.me,recipient:this.recipient}).then(function(){e.autoScroll=!0,e.text=""}),!1}},{key:"sortFavorites",value:function(t){return Object.keys(t).sort(function(e,n){return t[n]-t[e]})}},{key:"updateFavorites",value:function(t){for(var e,n=this,o=[],i=function(){var t=e[0];o.findIndex(function(e){return e===t})<0&&(o.push(e[0]),n.stats[t]=(n.stats[t]||0)+1)};e=this.regex.exec(t);)i();o.length>0&&(this.keys=this.sortFavorites(this.stats))}},{key:"trackById",value:function(t){return t.id}},{key:"sortByUpdated",value:function(t,e){var n="desc"===e?-1:1;return t.sort(function(t,e){var o=null==t?void 0:t.data().updated;if(!o)return n;var i=null==e?void 0:e.data().updated;return i?i<o?n:i>o?-n:0:-n})}}]),r}(pe.a)).\u0275fac=function(t){return new(t||on)(V.Qb(ut.b),V.Qb(ft.a),V.Qb(ft.g),V.Qb(De.a),V.Qb(ot.b),V.Qb(Xt.b),V.Qb(V.B))},on.\u0275cmp=V.Kb({type:on,selectors:[["wm-chat"]],viewQuery:function(t,e){var n;1&t&&(V.Lc(_t,1),V.Lc(Bt,1)),2&t&&(V.uc(n=V.fc())&&(e.conversationsList=n),V.uc(n=V.fc())&&(e.messagesList=n))},features:[V.Ab],decls:1,vars:1,consts:[["gtag","chat",4,"wmContent","wmContentSelect"],["gtag","chat"],["wmActionbar",""],["fxFlex","100","fxLayout","column","fxLayoutAlign","end stretch"],["fxLayout","row","fxLayoutAlign","center",4,"ngIf"],[4,"ngIf"],["wmFab","right bottom"],[3,"value","keys","disabled","valueChange","expanded","send",4,"wmFooter"],[3,"dontLeave",4,"ngIf"],["mat-stroked-button","","type.lt-sm","icon","color","primary",3,"routerLink"],[3,"icon",4,"ngIf","ngIfElse"],["newMessage",""],["wmSidenav","","persist","","minWidth","280px","maxWidth","350px",3,"opened","openedChange"],[3,"icon"],["color","primary",3,"content","highlight","showUnread","deleting","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"content","deleting","click",4,"wmToolbar"],[3,"content","deleting","click"],["color","primary",3,"content","highlight","showUnread","deleting","click"],["fxLayout","row","fxLayoutAlign","center"],["mode","indeterminate","diameter","40"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"thread","message"],["fxFlexAlign","center",1,"group-label","mat-elevation-z2"],["mat-mini-fab","","color","primary",3,"click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"click"],[3,"value","keys","disabled","valueChange","expanded","send"],[3,"dontLeave"],["mat-dialog-title",""],[3,"wm-readme"],["align","end"],["mat-button","","color","warn","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","","color","primary",3,"mat-dialog-close"]],template:function(t,e){1&t&&V.Gc(0,nn,9,5,"ng-container",0),2&t&&V.pc("wmContentSelect","chat")},directives:[mt.a,Te.a,$e.a,pt.b,pt.e,pt.d,g.m,Le.a,Y,w.b,Fe.a,ft.h,Se.a,$t.a,g.l,N,_t,k.c,Bt,A,pt.a,y.a,ue,yt.a,Ge.a,wt.h,wt.e,Ot.a,wt.c,wt.d],pipes:[g.b,jt.c,L,T,jt.a],styles:["[_nghost-%COMP%]{position:relative;min-height:100%;width:100%;padding:8px;display:flex;flex-direction:column;box-sizing:border-box}[_nghost-%COMP%]   .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%]{margin-top:12px}[_nghost-%COMP%]   .in[_ngcontent-%COMP%] + .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%] + .out[_ngcontent-%COMP%]{margin-top:2px}[_nghost-%COMP%]   .group-label[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:auto}"],data:{animation:Ve}}),on);r("J3Me");var an,cn=[{path:"",content:["chat","emoji-keys"],component:rn,canActivate:[nt.a,ot.c,ve],data:{authGuardPipe:nt.d},canDeactivate:[et.a]}],ln=((an=function t(){c(this,t)}).\u0275mod=V.Ob({type:an}),an.\u0275inj=V.Nb({factory:function(t){return new(t||an)},imports:[[g.c,v.a,y.b,w.c,O.e,j.b,x.b,k.b,I.a,S,M.a,D.a,P.a,G.a,E.a,B,Q.b,z.a,J.a,R.a,X,H,Z.a,tt.a,et.b,Vt,Qt,me,C.e.forChild(cn)]]}),an)}}])}();