(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{DE2N:function(t,e,n){"use strict";n.r(e),n.d(e,"ChatModule",function(){return Fe});var o=n("SVse"),i=n("u9T3"),a=n("Tj54"),r=n("Dxy4"),c=n("SqCe"),s=n("8Qe2"),l=n("BSbQ"),d=n("pu8Q"),b=n("g7MM"),u=n("CSIE"),m=n("fi6C"),h=n("txmD"),p=n("uaks"),g=n("mjGE"),f=n("Wcq6"),y=n("8Y7J");let w=(()=>{class t{transform(t){return t instanceof f.firestore.DocumentSnapshot?Object(g.b)(t):t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=y.Pb({name:"snapshotData",type:t,pure:!0}),t})(),v=(()=>{class t{transform(t){return t instanceof f.firestore.Timestamp?t.toDate():t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=y.Pb({name:"timestamp",type:t,pure:!0}),t})(),x=(()=>{class t{transform(t){var e;const n=t instanceof f.firestore.DocumentSnapshot?Object(g.b)(t):t;return null===(e=null==n?void 0:n.created)||void 0===e?void 0:e.toDate()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=y.Pb({name:"createdTime",type:t,pure:!0}),t})(),O=(()=>{class t{transform(t){var e;const n=t instanceof f.firestore.DocumentSnapshot?Object(g.b)(t):t;return null===(e=(null==n?void 0:n.updated)||(null==n?void 0:n.created))||void 0===e?void 0:e.toDate()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=y.Pb({name:"updatedTime",type:t,pure:!0}),t})(),j=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)}}),t})();var k=n("C1VQ"),C=n("Entk");const I=["*"];let M=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=y.Kb({type:t,selectors:[["wm-balloon"]],hostAttrs:[1,"wm-balloon"],hostVars:3,hostBindings:function(t,e){2&t&&y.Eb("side",e.side)("anchor",e.anchor)("color",e.color)},inputs:{side:"side",anchor:"anchor",color:"color"},ngContentSelectors:I,decls:2,vars:0,consts:[[1,"balloon-content"]],template:function(t,e){1&t&&(y.oc(),y.Wb(0,"div",0),y.nc(1),y.Vb())},styles:['.wm-balloon{position:relative;display:inline-block;border-radius:6px;box-sizing:border-box}.wm-balloon .balloon-content{position:relative;background-color:inherit;border-radius:inherit;padding:12px;overflow:hidden}.wm-balloon[side=bottom][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=bottom][anchor=center]:after,.wm-balloon[side=bottom][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=bottom][anchor=start]:after{left:12px}.wm-balloon[side=bottom]{margin-bottom:8.4px}.wm-balloon[side=bottom][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=left][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=left][anchor=center]:after,.wm-balloon[side=left][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=left][anchor=start]:after{top:12px}.wm-balloon[side=left]{margin-left:8.4px}.wm-balloon[side=left][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=right][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=right][anchor=center]:after,.wm-balloon[side=right][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=right][anchor=start]:after{top:12px}.wm-balloon[side=right]{margin-right:8.4px}.wm-balloon[side=right][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=top][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=top][anchor=center]:after,.wm-balloon[side=top][anchor=start]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;top:-1px;transform:translateY(-6px) rotate(-135deg)}.wm-balloon[side=top][anchor=start]:after{left:12px}.wm-balloon[side=top]{margin-top:8.4px}.wm-balloon[side=top][anchor=end]:after{position:absolute;display:block;content:"";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;top:-1px;transform:translateY(-6px) rotate(-135deg)}'],encapsulation:2}),t})(),D=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[]]}),t})();var P=n("XNpK"),W=n("EiPp"),_=n("kNiW"),V=n("sFr1");let $=(()=>{class t{constructor(t,e){this.teleport=t,this.template=e}ngOnInit(){this.teleport.activate("toolbar",this.template,{align:this.wmToolbarAlign,gap:this.wmToolbarGap})}ngOnChanges(t){this.ngOnInit()}ngOnDestroy(){this.teleport.clear("toolbar",this.template)}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(W.b),y.Qb(y.O))},t.\u0275dir=y.Lb({type:t,selectors:[["ng-template","wmToolbar",""]],inputs:{wmToolbarAlign:"wmToolbarAlign",wmToolbarGap:"wmToolbarGap"},features:[y.Bb]}),t})(),T=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)}}),t})();n("3wf5"),n("A8Sn");let L=(()=>{class t{constructor(t,e){this.teleport=t,this.template=e}ngOnInit(){this.teleport.activate("footer",this.template)}ngOnDestroy(){this.teleport.clear("footer",this.template)}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(W.b),y.Qb(y.O))},t.\u0275dir=y.Lb({type:t,selectors:[["ng-template","wmFooter",""]]}),t})(),F=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[]]}),t})();var G=n("u8yb"),U=n("pvxE"),E=n("h4JL"),S=n("U9eP"),A=n("lWmb"),Q=n("wSf6"),z=n("JX91"),B=n("UXun"),J=n("lJxs"),N=n("/uUt"),X=n("eIep"),R=n("eYWy"),K=n("1Blm"),q=n("rJgo"),Y=n("iInd"),H=n("Qfjl"),Z=n("VDRc"),tt=n("a/j4"),et=n("BTe0"),nt=n("xS4v"),ot=n("7/R1"),it=n("iELJ"),at=n("n8oj"),rt=n("cpjW");function ct(t,e){1&t&&y.Rb(0,"mat-progress-bar",11)}function st(t,e){if(1&t){const t=y.Xb();y.Wb(0,"div",12),y.Rb(1,"div",13),y.jc(2,"async"),y.jc(3,"async"),y.jc(4,"async"),y.Wb(5,"mat-icon",14),y.ec("click",function(t){return t.stopPropagation()}),y.Ic(6,"expand_more"),y.Vb(),y.Wb(7,"mat-menu",null,15),y.Wb(9,"button",16),y.jc(10,"async"),y.Ic(11),y.Vb(),y.Wb(12,"button",17),y.ec("click",function(){return y.yc(t),y.vc(15).open()}),y.Ic(13),y.Vb(),y.Wb(14,"wm-dialog",18,19),y.ec("closedChange",function(e){y.yc(t);const n=y.ic(2);return e&&n.delete()}),y.Wb(16,"h2",20),y.Wb(17,"b"),y.Ic(18),y.Vb(),y.Vb(),y.Wb(19,"mat-dialog-content",21),y.Ic(20," You're about to "),y.Wb(21,"b"),y.Ic(22,"delete"),y.Vb(),y.Ic(23," this conversation."),y.Rb(24,"br"),y.Ic(25,"Are you sure? "),y.Vb(),y.Wb(26,"mat-dialog-actions",22),y.Wb(27,"button",23),y.Ic(28),y.Vb(),y.Wb(29,"button",24),y.Ic(30),y.Vb(),y.Vb(),y.Vb(),y.Vb(),y.Vb()}if(2&t){const t=y.vc(8),e=y.ic().$implicit,n=y.ic();let o=null,i=null;y.Db(1),y.Ib("unread",n.showUnread&&y.kc(2,15,n.unread$)>0)("skeleton-loading",!y.kc(3,17,n.sender$)),y.pc("wm-emoji-text",null==(o=y.kc(4,19,n.last$))?null:o.body),y.Db(4),y.pc("matMenuTriggerFor",t),y.Db(4),y.qc("routerLink","/@",null==(i=y.kc(10,21,n.sender$))?null:i.userName,""),y.Db(2),y.Jc((null==e.info?null:e.info.label)||"Contact info"),y.Db(2),y.Jc((null==e.delete?null:e.delete.label)||"Delete chat"),y.Db(5),y.Jc((null==e.confirmDelete?null:e.confirmDelete.title)||"Deleting chat"),y.Db(1),y.pc("wm-readme",null==e.confirmDelete?null:e.confirmDelete.message),y.Db(8),y.pc("mat-dialog-close",!1),y.Db(1),y.Jc((null==e.confirmDelete?null:e.confirmDelete.cancel)||"Abort"),y.Db(1),y.pc("mat-dialog-close",!0),y.Db(1),y.Jc((null==e.confirmDelete?null:e.confirmDelete.ok)||"Proceed")}}const lt=function(){return{sameDay:"LT",lastDay:"[Yesterday]",lastWeek:"dddd",sameElse:"L"}};function dt(t,e){if(1&t&&(y.Wb(0,"div",2),y.Wb(1,"div",3),y.jc(2,"async"),y.jc(3,"async"),y.Rb(4,"wm-avatar",4),y.jc(5,"async"),y.jc(6,"async"),y.Vb(),y.Wb(7,"div",5),y.Wb(8,"div",6),y.Wb(9,"div",7),y.jc(10,"async"),y.Ic(11),y.jc(12,"async"),y.jc(13,"async"),y.Vb(),y.Wb(14,"time",8),y.Ic(15),y.jc(16,"calendar"),y.jc(17,"updatedTime"),y.jc(18,"async"),y.Vb(),y.Vb(),y.Gc(19,ct,1,0,"ng-template",null,9,y.Hc),y.Gc(21,st,31,23,"div",10),y.Vb(),y.Vb()),2&t){const t=e.$implicit,n=y.vc(20),o=y.ic();let i=null;y.Db(1),y.pc("matBadge",o.unreadCount(y.kc(2,11,o.unread$)))("matBadgeHidden",!o.showUnread||y.kc(3,13,o.unread$)<=0),y.Db(3),y.Ib("skeleton-loading",!y.kc(5,15,o.sender$)),y.pc("src",null==(i=y.kc(6,17,o.sender$))?null:i.photo),y.Db(5),y.Ib("skeleton-loading",!y.kc(10,19,o.sender$)),y.Db(2),y.Jc(y.kc(12,21,o.sender$)?y.kc(13,23,o.sender$).fullName||t.unknownUser||"Unknown user":""),y.Db(4),y.Jc(y.lc(16,25,y.kc(17,28,y.kc(18,30,o.last$)||o.data),t.timeFormat||y.rc(32,lt))),y.Db(6),y.pc("ngIf",!o.deleting)("ngIfElse",n)}}const bt=function(t){return{with:t}};let ut=(()=>{class t extends K.b{constructor(t,e){super(t),this.user=e,this._deleting=!1,this.deletingChange=new y.o}get id(){return this.data.id}get me(){return this.user.uid}get deleting(){return this._deleting}get unknownUser(){return`unknown-${this.data.id||"0"}`}unreadCount(t){return t>10?"10+":null==t?void 0:t.toString()}set content(t){var e;if(t&&t.id===(null===(e=this.ref)||void 0===e?void 0:e.id))return;this.data=this.unwrap(t),this.data$=this.stream().pipe(Object(z.a)(this.data),Object(B.a)(1)),this.thread$=this.collection("messages");const n=this.data.recipients.find(t=>t!==this.me)||"unknown";this.sender$=this.user.fromUserId(n).pipe(Object(J.a)(t=>t||{userName:this.unknownUser})),this.last$=this.thread$.stream(t=>t.orderBy("created").limitToLast(1)).pipe(Object(J.a)(t=>t[0]),Object(B.a)(1)),this.unread$=this.data$.pipe(Object(J.a)(t=>{var e,n;return null===(n=null===(e=null==t?void 0:t.status)||void 0===e?void 0:e[this.me])||void 0===n?void 0:n.lastRead}),Object(N.a)((t,e)=>!!t&&!!e&&t.isEqual(e)),Object(X.a)(t=>this.thread$.pipe(Object(Q.n)("sender","==",n),Object(Q.g)("created"),Object(Q.l)(t),Object(Q.e)(11),Object(Q.m)(this.db.zone),Object(J.a)(t=>t.length),Object(B.a)(1))))}delete(){return this.deletingChange.emit(this._deleting=!0),this.thread$.wipe(t=>t.where("sender","==",this.me).limit(100)).then(t=>(console.log("Messages deleted",t),this.update({recipients:this.db.arrayRemove(this.me)}).then(()=>this.db.transaction(t=>t.get(this.ref).then(e=>{var n;(null===(n=null==e?void 0:e.recipients)||void 0===n?void 0:n.length)<=0&&t.delete(this.ref)}))))).then(()=>this.deletingChange.emit(this._deleting=!1))}onContextMenu(){var t;return null===(t=this.menuTrigger)||void 0===t||t.openMenu(),!1}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(R.b),y.Qb(A.b))},t.\u0275cmp=y.Kb({type:t,selectors:[["wm-conversation"]],viewQuery:function(t,e){if(1&t&&y.Lc(q.d,1),2&t){let t;y.uc(t=y.fc())&&(e.menuTrigger=t.first)}},hostVars:2,hostBindings:function(t,e){1&t&&y.ec("contextmenu",function(){return e.onContextMenu()}),2&t&&y.Eb("selected",e.highlight)("color",e.color)},inputs:{highlight:"highlight",color:"color",showUnread:"showUnread",content:"content"},outputs:{deletingChange:"deleting"},features:[y.Ab],decls:3,vars:6,consts:[["mat-button","","routerLink",".",3,"queryParams"],["fxLayout","row","fxLayoutAlign","start center",4,"wmContent","wmContentSelect"],["fxLayout","row","fxLayoutAlign","start center"],["fxFlex","0 0 auto","matBadgeSize","small",3,"matBadge","matBadgeHidden"],["color","primary",3,"src"],["fxFlex","1 1 auto","fxLayout","column","fxLayoutAlign","start stretch",1,"content"],["fxLayout","row","fxLayoutGap","8px"],["fxFlex","1 1 auto",1,"name","mat-title","text"],["fxFlex","0 0 auto",1,"time","mat-small"],["deletingProgress",""],["fxLayout","row",4,"ngIf","ngIfElse"],["color","primary","mode","indeterminate",1,"mat-body",2,"height","1em"],["fxLayout","row"],["fxFlex","1 1 auto",1,"last","mat-body","text",3,"wm-emoji-text"],["fxFlex","0 0 auto",1,"menu",3,"matMenuTriggerFor","click"],["menu","matMenu"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",3,"click"],[3,"closedChange"],["confirmDelete",""],["mat-dialog-title",""],[3,"wm-readme"],["align","end"],["mat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(t,e){if(1&t&&(y.Wb(0,"button",0),y.jc(1,"async"),y.Gc(2,dt,22,33,"div",1),y.Vb()),2&t){let t=null;y.pc("queryParams",y.sc(4,bt,null==(t=y.kc(1,2,e.sender$))?null:t.userName)),y.Db(2),y.pc("wmContentSelect","chat.conversation")}},directives:[r.b,Y.h,H.a,Z.e,Z.d,Z.b,s.a,tt.a,Z.f,o.m,et.a,nt.a,a.a,q.d,q.a,q.b,ot.a,it.h,it.e,at.a,it.c,it.d],pipes:[o.b,rt.a,O],styles:["[_nghost-%COMP%]{position:relative;display:block;width:100%}[_nghost-%COMP%]   .mat-button[_ngcontent-%COMP%]{width:100%;text-align:left;padding:8px 16px}[_nghost-%COMP%]   .wm-avatar[_ngcontent-%COMP%]{width:56px;height:56px;margin-right:6px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .unread[_ngcontent-%COMP%]{font-weight:600}[_nghost-%COMP%]   .menu[_ngcontent-%COMP%]{transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}"]}),t})();var mt=n("WIkw");let ht=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[o.c,Y.k,i.a,s.b,r.c,a.b,q.c,et.b,mt.b,k.a,C.a,P.b,b.c,U.a,j]]}),t})();var pt=n("GJmQ"),gt=n("h0Qx");function ft(t,e){if(1&t&&(y.Wb(0,"div"),y.Wb(1,"b"),y.Ic(2),y.jc(3,"async"),y.Vb(),y.Vb()),2&t){const t=y.ic(2);let e=null;y.Db(2),y.Jc(null==(e=y.kc(3,1,t.sender$))?null:e.fullName)}}function yt(t,e){if(1&t&&(y.Wb(0,"span",9),y.Rb(1,"wm-icon",10),y.Wb(2,"span"),y.Ic(3),y.Vb(),y.Vb()),2&t){const t=y.ic().$implicit;y.Db(1),y.pc("icon",(null==t.delete?null:t.delete.icon)||"error_outline"),y.Db(2),y.Jc((null==t.delete?null:t.delete.message)||"This message has been deleted")}}function wt(t,e){if(1&t&&y.Rb(0,"span",11),2&t){const t=y.ic(2);y.pc("wm-emoji-text",null==t.data?null:t.data.body)}}function vt(t,e){if(1&t){const t=y.Xb();y.Ub(0),y.Wb(1,"mat-icon",12),y.Ic(2,"expand_more"),y.Vb(),y.Wb(3,"mat-menu",null,13),y.Wb(5,"button",14),y.ec("click",function(){return y.yc(t),y.ic(2).delete()}),y.Ic(6),y.Vb(),y.Vb(),y.Tb()}if(2&t){const t=y.vc(4),e=y.ic().$implicit;y.Db(1),y.pc("matMenuTriggerFor",t),y.Db(5),y.Jc((null==e.delete?null:e.delete.label)||"Delete message")}}function xt(t,e){if(1&t&&(y.Ub(0),y.Wb(1,"wm-balloon",1),y.Wb(2,"div",2),y.Gc(3,ft,4,3,"div",3),y.Wb(4,"div",4),y.Gc(5,yt,4,2,"span",5),y.jc(6,"async"),y.Gc(7,wt,1,1,"ng-template",null,6,y.Hc),y.Rb(9,"span",7),y.Wb(10,"time",8),y.Ic(11),y.jc(12,"moment"),y.jc(13,"timestamp"),y.Vb(),y.Gc(14,vt,7,2,"ng-container",3),y.Vb(),y.Vb(),y.Vb(),y.Tb()),2&t){const t=e.$implicit,n=y.vc(8),o=y.ic();y.Db(1),y.pc("color",(null==o.data?null:o.data.sender)===o.me?"accent":"primary")("side",(null==o.data?null:o.data.sender)===o.me?"right":"left")("anchor",(null==o.data?null:o.data.sender)!==o.thread?"start":""),y.Db(2),y.pc("ngIf",(null==o.data?null:o.data.sender)!==o.thread),y.Db(2),y.pc("ngIf",y.kc(6,8,o.deleted$))("ngIfElse",n),y.Db(6),y.Jc(y.lc(12,10,y.kc(13,13,null==o.data?null:o.data.created),t.timeFormat||"LT")),y.Db(3),y.pc("ngIf",(null==o.data?null:o.data.sender)===o.me)}}let Ot=(()=>{class t extends K.b{constructor(t,e){super(t),this.user=e,this.dataChange=new y.o}get id(){return this.data.id}get me(){return this.user.uid}set message(t){this.data=this.unwrap(t),this.sender$=this.user.fromUserId(this.data.sender),this.deleted$=this.asObservable().pipe(Object(J.a)(t=>!t.exists),Object(z.a)(!t.exists),Object(pt.a)(t=>!t,!0),Object(N.a)()),this.dataChange.emit(this.data)}onContextMenu(){var t;return null===(t=this.menuTrigger)||void 0===t||t.openMenu(),!1}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(R.b),y.Qb(A.b))},t.\u0275cmp=y.Kb({type:t,selectors:[["wm-message"]],viewQuery:function(t,e){if(1&t&&y.Lc(q.d,1),2&t){let t;y.uc(t=y.fc())&&(e.menuTrigger=t.first)}},hostAttrs:[1,"wm-message"],hostVars:4,hostBindings:function(t,e){1&t&&y.ec("contextmenu",function(){return e.onContextMenu()}),2&t&&y.Ib("in",(null==e.data?null:e.data.sender)!==e.me)("out",(null==e.data?null:e.data.sender)===e.me)},inputs:{thread:"thread",message:"message"},outputs:{dataChange:"data"},features:[y.Ab],decls:1,vars:1,consts:[[4,"wmContent","wmContentSelect"],[1,"mat-elevation-z2",3,"color","side","anchor"],["fxLayout","column","fxLayoutAlign","start stretch","fxLayoutGap","2px"],[4,"ngIf"],["fxLayout","row"],["class","deleted",4,"ngIf","ngIfElse"],["messageBody",""],[1,"spacer"],[1,"time","mat-small"],[1,"deleted"],[3,"icon"],[3,"wm-emoji-text"],[1,"menu",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"]],template:function(t,e){1&t&&y.Gc(0,xt,15,15,"ng-container",0),2&t&&y.pc("wmContentSelect","chat.message")},directives:[H.a,M,Z.e,Z.d,Z.f,o.m,gt.a,nt.a,a.a,q.d,q.a,q.b],pipes:[o.b,rt.c,v],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-flow:row;padding:0 2vw}.in[_nghost-%COMP%]{justify-content:flex-start}.out[_nghost-%COMP%]{justify-content:flex-end}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .deleted[_ngcontent-%COMP%]{opacity:.5;font-style:italic}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{display:inline-block;width:48px}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:5px;bottom:0;opacity:.5}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{position:absolute;right:5px;top:0;background-color:inherit;cursor:pointer;transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}"]}),t})(),jt=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[o.c,i.a,a.b,q.c,mt.b,h.a,D,U.a,j,b.c]]}),t})();var kt=n("o4Yh"),Ct=n("8LU1"),It=n("OWci"),Mt=n("0zyZ"),Dt=n("eyIN"),Pt=n("ZFy/"),Wt=n("0qK6"),_t=n("Q2Ze"),Vt=n("e6WT"),$t=n("nGdH"),Tt=n("8sFK"),Lt=n("gX7t"),Ft=n("H7fF"),Gt=n("XtK9");function Ut(t,e){if(1&t){const t=y.Xb();y.Wb(0,"mat-form-field",8),y.Wb(1,"mat-label"),y.Ic(2),y.Vb(),y.Wb(3,"textarea",9),y.ec("valueChange",function(e){return y.yc(t),y.ic(2).value=e}),y.Ic(4,"      "),y.Vb(),y.Wb(5,"wm-icon",10),y.ec("mousedown",function(){y.yc(t);const e=y.ic(2);return!e.disabled&&e.toggleEmojiKeys()}),y.Vb(),y.Vb()}if(2&t){const t=y.ic().$implicit,e=y.ic();y.Db(2),y.Jc(t.placeholder||"Type a message"),y.Db(1),y.pc("value",e.value)("newline",e.enterMode)("disabled",e.disabled),y.Db(2),y.Ib("color-disabled",e.disabled),y.pc("icon",(null==t.emoji?null:t.emoji.icon)||"insert_emoticon")("matTooltip",(null==t.emoji?null:t.emoji.tooltip)||"Insert an emoji")}}function Et(t,e){if(1&t){const t=y.Xb();y.Wb(0,"mat-form-field",8),y.Wb(1,"mat-label"),y.Ic(2),y.Vb(),y.Wb(3,"wm-emoji-input",11),y.ec("valueChange",function(e){return y.yc(t),y.ic(2).value=e}),y.Vb(),y.Wb(4,"wm-icon",10),y.ec("mousedown",function(){y.yc(t);const e=y.ic(2);return!e.disabled&&e.toggleEmojiKeys()}),y.Vb(),y.Vb()}if(2&t){const t=y.ic().$implicit,e=y.ic();y.Db(2),y.Jc(t.placeholder||"Type a message"),y.Db(1),y.pc("value",e.value)("newline",e.enterMode)("disabled",e.disabled),y.Db(1),y.Ib("color-disabled",e.disabled),y.pc("icon",(null==t.emoji?null:t.emoji.icon)||"insert_emoticon")("matTooltip",(null==t.emoji?null:t.emoji.tooltip)||"Insert an emoji")}}function St(t,e){if(1&t){const t=y.Xb();y.Ub(0),y.Wb(1,"div",1),y.ec("keydown",function(e){return y.yc(t),y.ic().sendOnEnter(e)}),y.Gc(2,Ut,6,8,"mat-form-field",2),y.Gc(3,Et,5,8,"ng-template",null,3,y.Hc),y.Wb(5,"button",4),y.ec("mousedown",function(){return y.yc(t),y.ic().sendNow()}),y.Rb(6,"wm-icon",5),y.Vb(),y.Vb(),y.Wb(7,"mat-expansion-panel",6),y.ec("afterExpand",function(){return y.yc(t),y.ic().expanded.emit()}),y.Wb(8,"wm-emoji-keyboard",7),y.ec("keyPressed",function(e){y.yc(t);const n=y.ic();return!n.disabled&&n.typein(e)}),y.Vb(),y.Vb(),y.Tb()}if(2&t){const t=e.$implicit,n=y.vc(4),o=y.ic();y.Db(2),y.pc("ngIf","native"===o.mode)("ngIfElse",n),y.Db(3),y.pc("disabled",o.disabled||!o.valid),y.Db(1),y.pc("icon",(null==t.send?null:t.send.icon)||"send")("matTooltip",(null==t.send?null:t.send.tooltip)||"Send"),y.Db(2),y.pc("favorites",o.keys)("mode",o.mode)}}let At=(()=>{class t{constructor(t,e){this.utils=t,this.touch=e,this._disabled=!1,this.valueChange=new y.o,this.expanded=new y.o,this.send=new y.o}set value(t){this.valueChange.emit(this._value=t)}get value(){return this._value}set disabled(t){var e;(this._disabled=Object(Ct.c)(t))&&(null===(e=this.emojiKeysPanel)||void 0===e||e.close())}get disabled(){return this._disabled}typein(t){var e;return null===(e=this.typeinAdapter)||void 0===e||e.typein(t),!1}toggleEmojiKeys(){return this.emojiKeysPanel.toggle(),!1}get mode(){return this.utils.emojiMode()}get enterMode(){return this.touch?"always":"shift"}sendOnEnter(t){return this.touch||t.shiftKey||"Enter"!==t.key||this.sendNow()}get valid(){return null===(this.value||"").match(/^\s*$/)}sendNow(){return this.valid&&this.send.emit(this.value),!1}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(Dt.c),y.Qb(It.b))},t.\u0275cmp=y.Kb({type:t,selectors:[["wm-composer"]],viewQuery:function(t,e){if(1&t&&(y.Lc(kt.c,1),y.Lc(Mt.b,1)),2&t){let t;y.uc(t=y.fc())&&(e.emojiKeysPanel=t.first),y.uc(t=y.fc())&&(e.typeinAdapter=t.first)}},hostAttrs:[1,"wm-composer"],inputs:{value:"value",keys:"keys",disabled:"disabled"},outputs:{valueChange:"valueChange",expanded:"expanded",send:"send"},decls:1,vars:1,consts:[[4,"wmContent","wmContentSelect"],["fxLayout","row","fxLayoutAlign","center end",1,"input",3,"keydown"],["appearance","legacy","fxFlex","1 1 auto",4,"ngIf","ngIfElse"],["webMode",""],["mat-icon-button","",3,"disabled","mousedown"],[3,"icon","matTooltip"],["hideToggle","",1,"padding-0","mat-elevation-z0",3,"afterExpand"],[3,"favorites","mode","keyPressed"],["appearance","legacy","fxFlex","1 1 auto"],["matInput","","typein","","cdkTextareaAutosize","","cdkAutosizeMinRows","1",3,"value","newline","disabled","valueChange"],["inline","","matSuffix","",1,"tools",3,"icon","matTooltip","mousedown"],["matEmoji","","typein","",3,"value","newline","disabled","valueChange"]],template:function(t,e){1&t&&y.Gc(0,St,9,7,"ng-container",0),2&t&&y.pc("wmContentSelect","chat.composer")},directives:[H.a,Z.e,Z.d,o.m,r.b,gt.a,Pt.b,kt.c,Wt.a,_t.c,Z.b,_t.g,Vt.b,$t.a,Tt.b,Lt.a,_t.i,Ft.a,Gt.a],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-flow:column;justify-content:center;align-items:stretch;box-sizing:border-box;margin-top:5px}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{margin:0 20px}[_nghost-%COMP%]   .wm-emoji-input[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{word-break:break-all}[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{cursor:pointer;vertical-align:middle}[_nghost-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{margin-bottom:10px}"]}),t})();var Qt=n("UYqx"),zt=n("KRLS"),Bt=n("glvt");let Jt=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[o.c,i.a,r.c,Vt.c,_t.e,kt.b,Pt.c,Qt.b,zt.a,Bt.a,b.c,h.a,Mt.a]]}),t})();var Nt=n("lPMd"),Xt=n("IzEk"),Rt=n("LRne");let Kt=(()=>{class t extends Nt.a{constructor(t,e,n){super(t,"conversations"),this.user=e,this.router=n}get me(){return this.user.uid}canActivate(t,e){var n;const o=t.queryParamMap.get("with");return!(!this.user.auth.authenticated||o==(null===(n=this.user.data)||void 0===n?void 0:n.userName))&&(o?o.startsWith("unknown-")?Object(Rt.a)(!0):this.user.fromUserName(o).pipe(Object(Xt.a)(1),Object(X.a)(t=>{if(!t||t.id===this.me)return Object(Rt.a)(!1);const e=this.ref.doc(this.me<t.id?this.me.concat(t.id):t.id.concat(this.me)),n=this.db.arrayUnion(this.user.uid,t.id);return this.db.transaction(t=>t.snap(e).then(({exists:o})=>(o?t.merge(e,{recipients:n}):t.set(e,{recipients:n}),!0)))})):this.pipe(Object(Q.j)(t=>t.where("recipients","array-contains",this.me).orderBy("updated","desc").limit(1)),Object(Q.d)(),Object(X.a)(t=>{if(t.empty)return Object(Rt.a)(!0);const n=t.docs[0].data().recipients.find(t=>t!=this.me);return this.user.fromUserId(n).pipe(Object(Xt.a)(1),Object(J.a)(n=>{const o=(null==n?void 0:n.userName)||`unknown-${t.docs[0].id}`;return this.router.createUrlTree(e.url.split("/"),{queryParams:{with:o}})}))})))}}return t.\u0275fac=function(e){return new(e||t)(y.ac(R.b),y.ac(A.b),y.ac(Y.g))},t.\u0275prov=y.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var qt=n("FQpF"),Yt=n("pLZG"),Ht=n("wO+i"),Zt=n("3E0/"),te=n("vkgz"),ee=n("1G5W"),ne=n("zP0r"),oe=n("2Vo4"),ie=n("itXk"),ae=n("DwbE"),re=n("j8uH"),ce=n("GS7A");const se="450ms cubic-bezier(0.8, -0.5, 0.2, 1.5)";let le=[Object(ce.o)("pop",[Object(ce.n)(":enter",[Object(ce.m)({transform:"scale(0.5)",opacity:0}),Object(ce.e)(se,Object(ce.m)("*"))]),Object(ce.n)(":leave",Object(ce.e)(se,Object(ce.m)({transform:"scale(0.5)",opacity:0})))])];var de=n("FkMH"),be=n("mx0f"),ue=n("glcp"),me=n("U3RD"),he=n("++Qg"),pe=n("q9NA");function ge(t,e){if(1&t&&y.Rb(0,"wm-icon",13),2&t){const t=y.ic(2).$implicit;y.pc("icon",(null==t.conversation||null==t.conversation.new?null:t.conversation.new.icon)||"add_comment")}}function fe(t,e){if(1&t&&y.Ic(0),2&t){const t=y.ic(2).$implicit;y.Jc((null==t.conversation||null==t.conversation.new?null:t.conversation.new.caption)||"New chat")}}function ye(t,e){if(1&t){const t=y.Xb();y.Wb(0,"wm-conversation",16),y.ec("deleting",function(e){y.yc(t);const n=y.ic(6);return n.onDeleting(e,n.conv.id)})("click",function(){y.yc(t);const e=y.ic(6);return e.browse=!e.browse}),y.Vb()}if(2&t){const t=y.ic(2).ngIf;y.pc("content",t)}}function we(t,e){1&t&&(y.Ub(0),y.Gc(1,ye,1,1,"wm-conversation",15),y.Tb())}function ve(t,e){if(1&t){const t=y.Xb();y.Wb(0,"wm-conversation",17),y.ec("deleting",function(n){y.yc(t);const o=e.$implicit;return y.ic(5).onDeleting(n,o.id)})("click",function(){y.yc(t);const e=y.ic(3).isMobile,n=y.ic(2);return e&&(n.browse=!n.browse)}),y.Vb()}if(2&t){const t=e.$implicit,n=y.ic().ngIf;y.pc("content",t)("highlight",t.id===n.id)("showUnread",t.id!==n.id)}}function xe(t,e){if(1&t&&(y.Ub(0),y.Gc(1,we,2,0,"ng-container",5),y.Gc(2,ve,1,3,"wm-conversation",14),y.jc(3,"async"),y.Tb()),2&t){const t=y.ic(2).isMobile,e=y.ic(2);y.Db(1),y.pc("ngIf",t),y.Db(1),y.pc("ngForOf",y.kc(3,3,e.conversations$))("ngForTrackBy",e.trackById)}}function Oe(t,e){if(1&t&&(y.Gc(0,xe,4,5,"ng-container",5),y.jc(1,"async")),2&t){const t=y.ic(3);y.pc("ngIf",y.kc(1,1,t.activeConversation$))}}function je(t,e){if(1&t){const t=y.Xb();y.Wb(0,"button",9),y.Gc(1,ge,1,1,"wm-icon",10),y.Gc(2,fe,1,1,"ng-template",null,11,y.Hc),y.Vb(),y.Gc(4,Oe,2,3,"ng-template",12),y.jc(5,"async"),y.ec("openedChange",function(e){return y.yc(t),y.ic(2).browse=e})}if(2&t){const t=e.isMobile,n=y.vc(3),o=y.ic().$implicit,i=y.ic();let a=null;y.pc("routerLink",(null==o.conversation||null==o.conversation.new?null:o.conversation.new.link)||"/explore/people"),y.Db(1),y.pc("ngIf",t)("ngIfElse",n),y.Db(3),y.pc("opened",(null==(a=y.kc(5,4,i.conversations$))?null:a.length)>0&&(i.browse||!t))}}function ke(t,e){1&t&&(y.Wb(0,"div",18),y.Rb(1,"mat-spinner",19),y.Vb())}const Ce=function(){return{sameDay:"[Today]",lastDay:"[Yesterday]",lastWeek:"dddd",sameElse:"L"}};function Ie(t,e){if(1&t&&(y.Ub(0),y.Wb(1,"wm-balloon",22),y.Ic(2),y.jc(3,"calendar"),y.jc(4,"createdTime"),y.Vb(),y.Tb()),2&t){const t=y.ic().$implicit,e=y.ic(2).$implicit;y.Db(2),y.Jc(y.lc(3,1,y.kc(4,4,t),(null==e.thread?null:e.thread.timeFormat)||y.rc(6,Ce)))}}function Me(t,e){if(1&t&&(y.Ub(0),y.Gc(1,Ie,5,7,"ng-container",5),y.jc(2,"moment"),y.jc(3,"createdTime"),y.jc(4,"moment"),y.jc(5,"createdTime"),y.Rb(6,"wm-message",21),y.jc(7,"snapshotData"),y.Tb()),2&t){const t=e.$implicit,n=e.index,o=y.ic().ngIf;let i=null;y.Db(1),y.pc("ngIf",0===n||y.lc(2,3,y.kc(3,6,o[n-1]),"D")!==y.lc(4,8,y.kc(5,11,t),"D")),y.Db(5),y.pc("thread",null==(i=y.kc(7,13,o[n-1]))?null:i.sender)("message",t)}}function De(t,e){if(1&t&&(y.Ub(0),y.Gc(1,Me,8,15,"ng-container",20),y.Tb()),2&t){const t=e.ngIf,n=y.ic(2);y.Db(1),y.pc("ngForOf",t)("ngForTrackBy",n.trackById)}}function Pe(t,e){if(1&t){const t=y.Xb();y.Wb(0,"button",24),y.ec("click",function(){return y.yc(t),y.ic(3).scrollToBottom()}),y.Wb(1,"mat-icon"),y.Ic(2,"expand_more"),y.Vb(),y.Vb()}2&t&&y.pc("@pop",void 0)}function We(t,e){if(1&t&&(y.Gc(0,Pe,3,1,"button",23),y.jc(1,"async")),2&t){const t=y.ic(2);y.pc("ngIf",y.kc(1,1,t.scrolled$))}}function _e(t,e){if(1&t){const t=y.Xb();y.Wb(0,"wm-composer",25),y.ec("valueChange",function(e){return y.yc(t),y.ic(2).text=e})("expanded",function(){return y.yc(t),y.ic(2).onKeyboardExpand()})("send",function(e){return y.yc(t),y.ic(2).send(e)}),y.Vb()}if(2&t){const t=y.ic(2);y.pc("value",t.text)("keys",t.keys)("disabled",!t.recipient||t.loading||t.deleting)}}function Ve(t,e){if(1&t&&(y.Wb(0,"wm-dialog",26),y.Wb(1,"h2",27),y.Wb(2,"b"),y.Ic(3),y.Vb(),y.Vb(),y.Wb(4,"mat-dialog-content",28),y.Ic(5," You're about to leave the page without sending the last message. "),y.Vb(),y.Wb(6,"mat-dialog-actions",29),y.Wb(7,"button",30),y.Ic(8),y.Vb(),y.Wb(9,"button",31),y.Ic(10),y.Vb(),y.Vb(),y.Vb()),2&t){const t=e.ngIf,n=y.ic(2);y.pc("dontLeave",!!n.text),y.Db(3),y.Jc(t.title||"Unsent message"),y.Db(1),y.pc("wm-readme",t.message),y.Db(3),y.pc("mat-dialog-close",!1),y.Db(1),y.Jc(t.cancel||"Wait"),y.Db(1),y.pc("mat-dialog-close",!0),y.Db(1),y.Jc(t.ok||"Proceed")}}function $e(t,e){if(1&t&&(y.Ub(0,1),y.Gc(1,je,6,6,"ng-template",2),y.Wb(2,"div",3),y.Gc(3,ke,2,0,"div",4),y.Gc(4,De,2,2,"ng-container",5),y.jc(5,"async"),y.Vb(),y.Gc(6,We,2,3,"ng-template",6),y.Gc(7,_e,1,3,"wm-composer",7),y.Gc(8,Ve,11,7,"wm-dialog",8),y.Tb()),2&t){const t=e.$implicit,n=y.ic();y.Db(3),y.pc("ngIf",n.loading),y.Db(1),y.pc("ngIf",y.kc(5,3,n.messages$)),y.Db(4),y.pc("ngIf",t.canLeave)}}let Te=(()=>{class t extends Nt.a{constructor(t,e,n,o,i,a,r){super(t,"conversations"),this.route=e,this.router=n,this.scroller=o,this.user=i,this.regex=a,this.zone=r,this.reload$=new oe.a(null),this.loading=!0,this.browse=!0,this.deletingCount=0,this.autoScroll=!0,this.stats={"\ud83d\ude02":1,"\ud83d\udc4b\ud83c\udffb":1,"\ud83d\udc4d":1,"\ud83d\udc95":1,"\ud83d\ude4f":1},this.text="",this.recipient="",this.conversations$=this.reload$.pipe(Object(X.a)(()=>this.pipe(Object(Q.n)("recipients","array-contains",this.me),Object(Q.g)("created","desc"),t=>t.pipe(Object(Q.k)(),Object(J.a)(t=>({cursor:t[0],convs:this.sortByUpdated(t,"desc")})),Object(qt.a)(({cursor:e,convs:n})=>t.pipe(Object(Q.c)(e),Object(Q.f)(r),Object(Yt.a)(t=>t.size>0&&!t.metadata.hasPendingWrites),Object(Q.b)(),Object(Xt.a)(1),Object(J.a)(t=>({cursor:t[0],convs:t.concat(n)})))),Object(Ht.a)("convs")),Object(B.a)(1)))),this.conversationId$=e.queryParamMap.pipe(Object(J.a)(t=>t.get("with")||""),Object(N.a)(),Object(Zt.a)(0),Object(X.a)(t=>t.startsWith("unknown-")?(this.recipient="",Object(Rt.a)(t.replace(/^unknown-/,""))):i.fromUserName(t).pipe(Object(Xt.a)(1),Object(J.a)(t=>t?(this.recipient=t.id,this.me<t.id?this.me.concat(t.id):this.recipient.concat(this.me)):this.recipient=""))),Object(B.a)(1)),this.activeConversation$=Object(ie.a)(this.conversations$,this.conversationId$).pipe(Object(J.a)(([t,e])=>(null==t?void 0:t.find(t=>t.id===e))||{}));const c=o.pipe(Object(J.a)(t=>t.top<50),Object(N.a)(),Object(Yt.a)(t=>t),Object(J.a)(()=>20),Object(te.a)(()=>this.loading=!0));this.messages$=this.conversationId$.pipe(Object(J.a)(t=>this.conversation=t&&this.document(t)),Object(J.a)(t=>this.thread=t&&t.collection("messages")),Object(X.a)(t=>t?t.pipe(Object(Q.g)("created"),t=>t.pipe(Object(Q.i)(c),Object(qt.a)(e=>t.pipe(Object(Q.l)(e[e.length-1]),Object(Q.f)(this.db.zone),Object(Yt.a)(t=>t.size>0&&!t.metadata.hasPendingWrites),Object(Q.b)(),Object(Xt.a)(1),Object(J.a)(t=>e.concat(t)))),Object(z.a)([]))):Object(Rt.a)([])),Object(re.f)(r,()=>{this.autoScroll&&this.scrollToBottom(),this.loading=!1}),Object(B.a)(1)),this.scrolled$=o.pipe(Object(J.a)(t=>t.bottom>=50),Object(N.a)(),Object(te.a)(t=>this.autoScroll=!t),Object(re.d)(this.zone))}get deleting(){return this.deletingCount>0}get me(){return this.user.uid}ngAfterViewInit(){this.sub=this.conversationId$.pipe(Object(X.a)(t=>this.fromId(t).pipe(Object(Xt.a)(1))),Object(J.a)(t=>{var e;return null===(e=null==t?void 0:t.status)||void 0===e?void 0:e[this.me]}),Object(te.a)(t=>{console.log("Loading",t),this.stats=(null==t?void 0:t.favorites)||this.stats,this.keys=this.sortFavorites(this.stats)}),Object(qt.a)(t=>this.lastMessage().pipe(Object(ee.a)(this.conversationId$.pipe(Object(ne.a)(1))),Object(J.a)(t=>null==t?void 0:t.created),Object(Yt.a)(e=>!!e&&(!(null==t?void 0:t.lastRead)||e>t.lastRead)),Object(X.a)(t=>{const e={favorites:this.stats,lastRead:t};return console.log("Saving data",e),this.conversation.merge({status:{[this.me]:e}}).then(()=>e)}),Object(Xt.a)(1)))).subscribe()}ngOnDestroy(){this.sub.unsubscribe()}fromId(t){return this.zone.onStable.pipe(Object(Xt.a)(1),Object(X.a)(()=>this.conversationsList.changes.pipe(Object(z.a)(null))),Object(J.a)(()=>this.conversationsList.find(e=>e.id===t)),Object(Yt.a)(t=>!!t),Object(N.a)(void 0,t=>t.id),Object(X.a)(t=>t.data$))}lastMessage(){return this.zone.onStable.pipe(Object(Xt.a)(1),Object(X.a)(()=>this.messagesList.changes.pipe(Object(z.a)(null))),Object(J.a)(()=>{var t;return null===(t=this.messagesList.last)||void 0===t?void 0:t.data}),Object(N.a)())}onDeleting(t,e){this.deletingCount=this.deletingCount+(t?1:-1),this.deletingCount<=0&&(this.text="",this.reload())}reload(){return this.router.navigate(["."],{relativeTo:this.route,replaceUrl:!0}).then(()=>this.reload$.next())}scrollToBottom(){this.scroller.scrollTo({bottom:0})}onKeyboardExpand(){this.autoScroll&&this.scrollToBottom()}send(t){return this.updateFavorites(t),this.thread.add({body:t,sender:this.me,recipient:this.recipient}).then(()=>{this.autoScroll=!0,this.text=""}),!1}sortFavorites(t){return Object.keys(t).sort((e,n)=>t[n]-t[e])}updateFavorites(t){let e,n=[];for(;e=this.regex.exec(t);){const t=e[0];n.findIndex(e=>e===t)<0&&(n.push(e[0]),this.stats[t]=(this.stats[t]||0)+1)}n.length>0&&(this.keys=this.sortFavorites(this.stats))}trackById(t){return t.id}sortByUpdated(t,e){const n="desc"===e?-1:1;return t.sort((t,e)=>{const o=null==t?void 0:t.data().updated;if(!o)return n;const i=null==e?void 0:e.data().updated;return i?i<o?n:i>o?-n:0:-n})}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(R.b),y.Qb(Y.a),y.Qb(Y.g),y.Qb(ae.a),y.Qb(A.b),y.Qb(Dt.b),y.Qb(y.B))},t.\u0275cmp=y.Kb({type:t,selectors:[["wm-chat"]],viewQuery:function(t,e){if(1&t&&(y.Lc(ut,1),y.Lc(Ot,1)),2&t){let t;y.uc(t=y.fc())&&(e.conversationsList=t),y.uc(t=y.fc())&&(e.messagesList=t)}},features:[y.Ab],decls:1,vars:1,consts:[["gtag","chat",4,"wmContent","wmContentSelect"],["gtag","chat"],["wmActionbar",""],["fxFlex","100","fxLayout","column","fxLayoutAlign","end stretch"],["fxLayout","row","fxLayoutAlign","center",4,"ngIf"],[4,"ngIf"],["wmFab","right bottom"],[3,"value","keys","disabled","valueChange","expanded","send",4,"wmFooter"],[3,"dontLeave",4,"ngIf"],["mat-stroked-button","","type.lt-sm","icon","color","primary",3,"routerLink"],[3,"icon",4,"ngIf","ngIfElse"],["newMessage",""],["wmSidenav","","persist","","minWidth","280px","maxWidth","350px",3,"opened","openedChange"],[3,"icon"],["color","primary",3,"content","highlight","showUnread","deleting","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"content","deleting","click",4,"wmToolbar"],[3,"content","deleting","click"],["color","primary",3,"content","highlight","showUnread","deleting","click"],["fxLayout","row","fxLayoutAlign","center"],["mode","indeterminate","diameter","40"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"thread","message"],["fxFlexAlign","center",1,"group-label","mat-elevation-z2"],["mat-mini-fab","","color","primary",3,"click",4,"ngIf"],["mat-mini-fab","","color","primary",3,"click"],[3,"value","keys","disabled","valueChange","expanded","send"],[3,"dontLeave"],["mat-dialog-title",""],[3,"wm-readme"],["align","end"],["mat-button","","color","warn","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","","color","primary",3,"mat-dialog-close"]],template:function(t,e){1&t&&y.Gc(0,$e,9,5,"ng-container",0),2&t&&y.pc("wmContentSelect","chat")},directives:[H.a,de.a,be.a,Z.b,Z.e,Z.d,o.m,ue.a,L,r.b,me.a,Y.h,he.a,gt.a,o.l,$,ut,d.c,Ot,M,Z.a,a.a,At,ot.a,pe.a,it.h,it.e,at.a,it.c,it.d],pipes:[o.b,rt.c,x,w,rt.a],styles:["[_nghost-%COMP%]{position:relative;min-height:100%;width:100%;padding:8px;display:flex;flex-direction:column;box-sizing:border-box}[_nghost-%COMP%]   .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%]{margin-top:12px}[_nghost-%COMP%]   .in[_ngcontent-%COMP%] + .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%] + .out[_ngcontent-%COMP%]{margin-top:2px}[_nghost-%COMP%]   .group-label[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:auto}"],data:{animation:le}}),t})();n("J3Me");const Le=[{path:"",content:["chat","emoji-keys"],component:Te,canActivate:[S.a,A.c,Kt],data:{authGuardPipe:S.d},canDeactivate:[E.a]}];let Fe=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[o.c,i.a,a.b,r.c,c.e,s.b,l.b,d.b,u.a,j,m.a,h.a,p.a,k.a,C.a,D,P.b,W.a,_.a,V.a,T,F,G.a,U.a,E.b,ht,jt,Jt,b.e.forChild(Le)]]}),t})()}}]);