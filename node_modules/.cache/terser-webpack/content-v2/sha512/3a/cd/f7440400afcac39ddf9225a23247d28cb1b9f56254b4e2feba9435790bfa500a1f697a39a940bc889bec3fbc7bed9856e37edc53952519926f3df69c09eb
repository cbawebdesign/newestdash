{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{DE2N:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,\"ChatModule\",function(){return chat_module_ChatModule});var common=__webpack_require__(\"SVse\"),flex_layout=__webpack_require__(\"u9T3\"),icon=__webpack_require__(\"Tj54\"),fesm2015_button=__webpack_require__(\"Dxy4\"),list=__webpack_require__(\"SqCe\"),badge=__webpack_require__(\"8Qe2\"),divider=__webpack_require__(\"BSbQ\"),progress_spinner=__webpack_require__(\"pu8Q\"),src=__webpack_require__(\"g7MM\"),redirect_src=__webpack_require__(\"CSIE\"),gtag_src=__webpack_require__(\"fi6C\"),lib_icon=__webpack_require__(\"txmD\"),lib_button=__webpack_require__(\"uaks\"),document_utils=__webpack_require__(\"mjGE\"),index_cjs=__webpack_require__(\"Wcq6\"),core=__webpack_require__(\"8Y7J\");let pipes_pipe_SnapshotDataPipe=(()=>{class SnapshotDataPipe{transform(value){return value instanceof index_cjs.firestore.DocumentSnapshot?Object(document_utils.b)(value):value}}return SnapshotDataPipe.ɵfac=function(t){return new(t||SnapshotDataPipe)},SnapshotDataPipe.ɵpipe=core.Pb({name:\"snapshotData\",type:SnapshotDataPipe,pure:!0}),SnapshotDataPipe})(),pipes_pipe_TimestampPipe=(()=>{class TimestampPipe{transform(value){return value instanceof index_cjs.firestore.Timestamp?value.toDate():value}}return TimestampPipe.ɵfac=function(t){return new(t||TimestampPipe)},TimestampPipe.ɵpipe=core.Pb({name:\"timestamp\",type:TimestampPipe,pure:!0}),TimestampPipe})(),pipes_pipe_CreatedTimePipe=(()=>{class CreatedTimePipe{transform(value){var _a;const data=value instanceof index_cjs.firestore.DocumentSnapshot?Object(document_utils.b)(value):value;return null===(_a=null==data?void 0:data.created)||void 0===_a?void 0:_a.toDate()}}return CreatedTimePipe.ɵfac=function(t){return new(t||CreatedTimePipe)},CreatedTimePipe.ɵpipe=core.Pb({name:\"createdTime\",type:CreatedTimePipe,pure:!0}),CreatedTimePipe})(),pipes_pipe_UpdatedTimePipe=(()=>{class UpdatedTimePipe{transform(value){var _a;const data=value instanceof index_cjs.firestore.DocumentSnapshot?Object(document_utils.b)(value):value;return null===(_a=(null==data?void 0:data.updated)||(null==data?void 0:data.created))||void 0===_a?void 0:_a.toDate()}}return UpdatedTimePipe.ɵfac=function(t){return new(t||UpdatedTimePipe)},UpdatedTimePipe.ɵpipe=core.Pb({name:\"updatedTime\",type:UpdatedTimePipe,pure:!0}),UpdatedTimePipe})(),pipes_module_PipesModule=(()=>{class PipesModule{}return PipesModule.ɵmod=core.Ob({type:PipesModule}),PipesModule.ɵinj=core.Nb({factory:function(t){return new(t||PipesModule)}}),PipesModule})();var readme_src=__webpack_require__(\"C1VQ\"),avatar=__webpack_require__(\"Entk\");const _c0=[\"*\"];let balloon_component_BalloonComponent=(()=>{class BalloonComponent{}return BalloonComponent.ɵfac=function(t){return new(t||BalloonComponent)},BalloonComponent.ɵcmp=core.Kb({type:BalloonComponent,selectors:[[\"wm-balloon\"]],hostAttrs:[1,\"wm-balloon\"],hostVars:3,hostBindings:function(rf,ctx){2&rf&&core.Eb(\"side\",ctx.side)(\"anchor\",ctx.anchor)(\"color\",ctx.color)},inputs:{side:\"side\",anchor:\"anchor\",color:\"color\"},ngContentSelectors:_c0,decls:2,vars:0,consts:[[1,\"balloon-content\"]],template:function(rf,ctx){1&rf&&(core.oc(),core.Wb(0,\"div\",0),core.nc(1),core.Vb())},styles:['.wm-balloon{position:relative;display:inline-block;border-radius:6px;box-sizing:border-box}.wm-balloon .balloon-content{position:relative;background-color:inherit;border-radius:inherit;padding:12px;overflow:hidden}.wm-balloon[side=bottom][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=bottom][anchor=center]:after,.wm-balloon[side=bottom][anchor=start]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=bottom][anchor=start]:after{left:12px}.wm-balloon[side=bottom]{margin-bottom:8.4px}.wm-balloon[side=bottom][anchor=end]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=left][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=left][anchor=center]:after,.wm-balloon[side=left][anchor=start]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=left][anchor=start]:after{top:12px}.wm-balloon[side=left]{margin-left:8.4px}.wm-balloon[side=left][anchor=end]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=right][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=right][anchor=center]:after,.wm-balloon[side=right][anchor=start]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=right][anchor=start]:after{top:12px}.wm-balloon[side=right]{margin-right:8.4px}.wm-balloon[side=right][anchor=end]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=top][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=top][anchor=center]:after,.wm-balloon[side=top][anchor=start]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;top:-1px;transform:translateY(-6px) rotate(-135deg)}.wm-balloon[side=top][anchor=start]:after{left:12px}.wm-balloon[side=top]{margin-top:8.4px}.wm-balloon[side=top][anchor=end]:after{position:absolute;display:block;content:\"\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;top:-1px;transform:translateY(-6px) rotate(-135deg)}'],encapsulation:2}),BalloonComponent})(),balloon_module_BalloonModule=(()=>{class BalloonModule{}return BalloonModule.ɵmod=core.Ob({type:BalloonModule}),BalloonModule.ɵinj=core.Nb({factory:function(t){return new(t||BalloonModule)},imports:[[]]}),BalloonModule})();var dialog=__webpack_require__(\"XNpK\"),teleport_src=__webpack_require__(\"EiPp\"),actionbar=__webpack_require__(\"kNiW\"),sidenav=__webpack_require__(\"sFr1\");let toolbar_directive_ToolbarDirective=(()=>{class ToolbarDirective{constructor(teleport,template){this.teleport=teleport,this.template=template}ngOnInit(){this.teleport.activate(\"toolbar\",this.template,{align:this.wmToolbarAlign,gap:this.wmToolbarGap})}ngOnChanges(changes){this.ngOnInit()}ngOnDestroy(){this.teleport.clear(\"toolbar\",this.template)}}return ToolbarDirective.ɵfac=function(t){return new(t||ToolbarDirective)(core.Qb(teleport_src.b),core.Qb(core.O))},ToolbarDirective.ɵdir=core.Lb({type:ToolbarDirective,selectors:[[\"ng-template\",\"wmToolbar\",\"\"]],inputs:{wmToolbarAlign:\"wmToolbarAlign\",wmToolbarGap:\"wmToolbarGap\"},features:[core.Bb]}),ToolbarDirective})(),toolbar_module_ToolbarModule=(()=>{class ToolbarModule{}return ToolbarModule.ɵmod=core.Ob({type:ToolbarModule}),ToolbarModule.ɵinj=core.Nb({factory:function(t){return new(t||ToolbarModule)}}),ToolbarModule})();__webpack_require__(\"3wf5\"),__webpack_require__(\"A8Sn\");let sticky_footer_directive_StickyFooterDirective=(()=>{class StickyFooterDirective{constructor(teleport,template){this.teleport=teleport,this.template=template}ngOnInit(){this.teleport.activate(\"footer\",this.template)}ngOnDestroy(){this.teleport.clear(\"footer\",this.template)}}return StickyFooterDirective.ɵfac=function(t){return new(t||StickyFooterDirective)(core.Qb(teleport_src.b),core.Qb(core.O))},StickyFooterDirective.ɵdir=core.Lb({type:StickyFooterDirective,selectors:[[\"ng-template\",\"wmFooter\",\"\"]]}),StickyFooterDirective})(),sticky_footer_module_StickyFooterModule=(()=>{class StickyFooterModule{}return StickyFooterModule.ɵmod=core.Ob({type:StickyFooterModule}),StickyFooterModule.ɵinj=core.Nb({factory:function(t){return new(t||StickyFooterModule)},imports:[[]]}),StickyFooterModule})();var fab=__webpack_require__(\"u8yb\"),moment=__webpack_require__(\"pvxE\"),can_leave=__webpack_require__(\"h4JL\"),auth_guard=__webpack_require__(\"U9eP\"),utils_user=__webpack_require__(\"lWmb\"),operators=__webpack_require__(\"wSf6\"),startWith=__webpack_require__(\"JX91\"),shareReplay=__webpack_require__(\"UXun\"),map=__webpack_require__(\"lJxs\"),distinctUntilChanged=__webpack_require__(\"/uUt\"),switchMap=__webpack_require__(\"eIep\"),database=__webpack_require__(\"eYWy\"),database_document=__webpack_require__(\"1Blm\"),menu=__webpack_require__(\"rJgo\"),fesm2015_router=__webpack_require__(\"iInd\"),content_directive=__webpack_require__(\"Qfjl\"),flex=__webpack_require__(\"VDRc\"),avatar_component=__webpack_require__(\"a/j4\"),progress_bar=__webpack_require__(\"BTe0\"),emoji_text_component=__webpack_require__(\"xS4v\"),dialog_component=__webpack_require__(\"7/R1\"),fesm2015_dialog=__webpack_require__(\"iELJ\"),readme_component=__webpack_require__(\"n8oj\"),moment_pipe=__webpack_require__(\"cpjW\");function Conversation_div_2_ng_template_19_Template(rf,ctx){1&rf&&core.Rb(0,\"mat-progress-bar\",11)}function Conversation_div_2_div_21_Template(rf,ctx){if(1&rf){const _r9=core.Xb();core.Wb(0,\"div\",12),core.Rb(1,\"div\",13),core.jc(2,\"async\"),core.jc(3,\"async\"),core.jc(4,\"async\"),core.Wb(5,\"mat-icon\",14),core.ec(\"click\",function($event){return $event.stopPropagation()}),core.Ic(6,\"expand_more\"),core.Vb(),core.Wb(7,\"mat-menu\",null,15),core.Wb(9,\"button\",16),core.jc(10,\"async\"),core.Ic(11),core.Vb(),core.Wb(12,\"button\",17),core.ec(\"click\",function(){return core.yc(_r9),core.vc(15).open()}),core.Ic(13),core.Vb(),core.Wb(14,\"wm-dialog\",18,19),core.ec(\"closedChange\",function($event){core.yc(_r9);const ctx_r10=core.ic(2);return $event&&ctx_r10.delete()}),core.Wb(16,\"h2\",20),core.Wb(17,\"b\"),core.Ic(18),core.Vb(),core.Vb(),core.Wb(19,\"mat-dialog-content\",21),core.Ic(20,\" You're about to \"),core.Wb(21,\"b\"),core.Ic(22,\"delete\"),core.Vb(),core.Ic(23,\" this conversation.\"),core.Rb(24,\"br\"),core.Ic(25,\"Are you sure? \"),core.Vb(),core.Wb(26,\"mat-dialog-actions\",22),core.Wb(27,\"button\",23),core.Ic(28),core.Vb(),core.Wb(29,\"button\",24),core.Ic(30),core.Vb(),core.Vb(),core.Vb(),core.Vb(),core.Vb()}if(2&rf){const _r5=core.vc(8),msgs_r1=core.ic().$implicit,ctx_r4=core.ic();let tmp_2_0=null,tmp_4_0=null;core.Db(1),core.Ib(\"unread\",ctx_r4.showUnread&&core.kc(2,15,ctx_r4.unread$)>0)(\"skeleton-loading\",!core.kc(3,17,ctx_r4.sender$)),core.pc(\"wm-emoji-text\",null==(tmp_2_0=core.kc(4,19,ctx_r4.last$))?null:tmp_2_0.body),core.Db(4),core.pc(\"matMenuTriggerFor\",_r5),core.Db(4),core.qc(\"routerLink\",\"/@\",null==(tmp_4_0=core.kc(10,21,ctx_r4.sender$))?null:tmp_4_0.userName,\"\"),core.Db(2),core.Jc((null==msgs_r1.info?null:msgs_r1.info.label)||\"Contact info\"),core.Db(2),core.Jc((null==msgs_r1.delete?null:msgs_r1.delete.label)||\"Delete chat\"),core.Db(5),core.Jc((null==msgs_r1.confirmDelete?null:msgs_r1.confirmDelete.title)||\"Deleting chat\"),core.Db(1),core.pc(\"wm-readme\",null==msgs_r1.confirmDelete?null:msgs_r1.confirmDelete.message),core.Db(8),core.pc(\"mat-dialog-close\",!1),core.Db(1),core.Jc((null==msgs_r1.confirmDelete?null:msgs_r1.confirmDelete.cancel)||\"Abort\"),core.Db(1),core.pc(\"mat-dialog-close\",!0),core.Db(1),core.Jc((null==msgs_r1.confirmDelete?null:msgs_r1.confirmDelete.ok)||\"Proceed\")}}const conversation_component_c0=function(){return{sameDay:\"LT\",lastDay:\"[Yesterday]\",lastWeek:\"dddd\",sameElse:\"L\"}};function Conversation_div_2_Template(rf,ctx){if(1&rf&&(core.Wb(0,\"div\",2),core.Wb(1,\"div\",3),core.jc(2,\"async\"),core.jc(3,\"async\"),core.Rb(4,\"wm-avatar\",4),core.jc(5,\"async\"),core.jc(6,\"async\"),core.Vb(),core.Wb(7,\"div\",5),core.Wb(8,\"div\",6),core.Wb(9,\"div\",7),core.jc(10,\"async\"),core.Ic(11),core.jc(12,\"async\"),core.jc(13,\"async\"),core.Vb(),core.Wb(14,\"time\",8),core.Ic(15),core.jc(16,\"calendar\"),core.jc(17,\"updatedTime\"),core.jc(18,\"async\"),core.Vb(),core.Vb(),core.Gc(19,Conversation_div_2_ng_template_19_Template,1,0,\"ng-template\",null,9,core.Hc),core.Gc(21,Conversation_div_2_div_21_Template,31,23,\"div\",10),core.Vb(),core.Vb()),2&rf){const msgs_r1=ctx.$implicit,_r2=core.vc(20),ctx_r0=core.ic();let tmp_3_0=null;core.Db(1),core.pc(\"matBadge\",ctx_r0.unreadCount(core.kc(2,11,ctx_r0.unread$)))(\"matBadgeHidden\",!ctx_r0.showUnread||core.kc(3,13,ctx_r0.unread$)<=0),core.Db(3),core.Ib(\"skeleton-loading\",!core.kc(5,15,ctx_r0.sender$)),core.pc(\"src\",null==(tmp_3_0=core.kc(6,17,ctx_r0.sender$))?null:tmp_3_0.photo),core.Db(5),core.Ib(\"skeleton-loading\",!core.kc(10,19,ctx_r0.sender$)),core.Db(2),core.Jc(core.kc(12,21,ctx_r0.sender$)?core.kc(13,23,ctx_r0.sender$).fullName||msgs_r1.unknownUser||\"Unknown user\":\"\"),core.Db(4),core.Jc(core.lc(16,25,core.kc(17,28,core.kc(18,30,ctx_r0.last$)||ctx_r0.data),msgs_r1.timeFormat||core.rc(32,conversation_component_c0))),core.Db(6),core.pc(\"ngIf\",!ctx_r0.deleting)(\"ngIfElse\",_r2)}}const _c1=function(a0){return{with:a0}};let conversation_component_Conversation=(()=>{class Conversation extends database_document.b{constructor(db,user){super(db),this.user=user,this._deleting=!1,this.deletingChange=new core.o}get id(){return this.data.id}get me(){return this.user.uid}get deleting(){return this._deleting}get unknownUser(){return`unknown-${this.data.id||\"0\"}`}unreadCount(value){return value>10?\"10+\":null==value?void 0:value.toString()}set content(conv){var _a;if(conv&&conv.id===(null===(_a=this.ref)||void 0===_a?void 0:_a.id))return;this.data=this.unwrap(conv),this.data$=this.stream().pipe(Object(startWith.a)(this.data),Object(shareReplay.a)(1)),this.thread$=this.collection(\"messages\");const senderId=this.data.recipients.find(id=>id!==this.me)||\"unknown\";this.sender$=this.user.fromUserId(senderId).pipe(Object(map.a)(data=>data||{userName:this.unknownUser})),this.last$=this.thread$.stream(qf=>qf.orderBy(\"created\").limitToLast(1)).pipe(Object(map.a)(msgs=>msgs[0]),Object(shareReplay.a)(1)),this.unread$=this.data$.pipe(Object(map.a)(data=>{var _a,_b;return null===(_b=null===(_a=null==data?void 0:data.status)||void 0===_a?void 0:_a[this.me])||void 0===_b?void 0:_b.lastRead}),Object(distinctUntilChanged.a)((x,y)=>!!x&&!!y&&x.isEqual(y)),Object(switchMap.a)(lastRead=>this.thread$.pipe(Object(operators.n)(\"sender\",\"==\",senderId),Object(operators.g)(\"created\"),Object(operators.l)(lastRead),Object(operators.e)(11),Object(operators.m)(this.db.zone),Object(map.a)(msgs=>msgs.length),Object(shareReplay.a)(1))))}delete(){return this.deletingChange.emit(this._deleting=!0),this.thread$.wipe(qf=>qf.where(\"sender\",\"==\",this.me).limit(100)).then(count=>(console.log(\"Messages deleted\",count),this.update({recipients:this.db.arrayRemove(this.me)}).then(()=>this.db.transaction(trx=>trx.get(this.ref).then(data=>{var _a;(null===(_a=null==data?void 0:data.recipients)||void 0===_a?void 0:_a.length)<=0&&trx.delete(this.ref)}))))).then(()=>this.deletingChange.emit(this._deleting=!1))}onContextMenu(){var _a;return null===(_a=this.menuTrigger)||void 0===_a||_a.openMenu(),!1}}return Conversation.ɵfac=function(t){return new(t||Conversation)(core.Qb(database.b),core.Qb(utils_user.b))},Conversation.ɵcmp=core.Kb({type:Conversation,selectors:[[\"wm-conversation\"]],viewQuery:function(rf,ctx){if(1&rf&&core.Lc(menu.d,1),2&rf){let _t;core.uc(_t=core.fc())&&(ctx.menuTrigger=_t.first)}},hostVars:2,hostBindings:function(rf,ctx){1&rf&&core.ec(\"contextmenu\",function(){return ctx.onContextMenu()}),2&rf&&core.Eb(\"selected\",ctx.highlight)(\"color\",ctx.color)},inputs:{highlight:\"highlight\",color:\"color\",showUnread:\"showUnread\",content:\"content\"},outputs:{deletingChange:\"deleting\"},features:[core.Ab],decls:3,vars:6,consts:[[\"mat-button\",\"\",\"routerLink\",\".\",3,\"queryParams\"],[\"fxLayout\",\"row\",\"fxLayoutAlign\",\"start center\",4,\"wmContent\",\"wmContentSelect\"],[\"fxLayout\",\"row\",\"fxLayoutAlign\",\"start center\"],[\"fxFlex\",\"0 0 auto\",\"matBadgeSize\",\"small\",3,\"matBadge\",\"matBadgeHidden\"],[\"color\",\"primary\",3,\"src\"],[\"fxFlex\",\"1 1 auto\",\"fxLayout\",\"column\",\"fxLayoutAlign\",\"start stretch\",1,\"content\"],[\"fxLayout\",\"row\",\"fxLayoutGap\",\"8px\"],[\"fxFlex\",\"1 1 auto\",1,\"name\",\"mat-title\",\"text\"],[\"fxFlex\",\"0 0 auto\",1,\"time\",\"mat-small\"],[\"deletingProgress\",\"\"],[\"fxLayout\",\"row\",4,\"ngIf\",\"ngIfElse\"],[\"color\",\"primary\",\"mode\",\"indeterminate\",1,\"mat-body\",2,\"height\",\"1em\"],[\"fxLayout\",\"row\"],[\"fxFlex\",\"1 1 auto\",1,\"last\",\"mat-body\",\"text\",3,\"wm-emoji-text\"],[\"fxFlex\",\"0 0 auto\",1,\"menu\",3,\"matMenuTriggerFor\",\"click\"],[\"menu\",\"matMenu\"],[\"mat-menu-item\",\"\",3,\"routerLink\"],[\"mat-menu-item\",\"\",3,\"click\"],[3,\"closedChange\"],[\"confirmDelete\",\"\"],[\"mat-dialog-title\",\"\"],[3,\"wm-readme\"],[\"align\",\"end\"],[\"mat-button\",\"\",\"color\",\"primary\",\"cdkFocusInitial\",\"\",3,\"mat-dialog-close\"],[\"mat-button\",\"\",\"color\",\"warn\",3,\"mat-dialog-close\"]],template:function(rf,ctx){if(1&rf&&(core.Wb(0,\"button\",0),core.jc(1,\"async\"),core.Gc(2,Conversation_div_2_Template,22,33,\"div\",1),core.Vb()),2&rf){let tmp_0_0=null;core.pc(\"queryParams\",core.sc(4,_c1,null==(tmp_0_0=core.kc(1,2,ctx.sender$))?null:tmp_0_0.userName)),core.Db(2),core.pc(\"wmContentSelect\",\"chat.conversation\")}},directives:[fesm2015_button.b,fesm2015_router.h,content_directive.a,flex.e,flex.d,flex.b,badge.a,avatar_component.a,flex.f,common.m,progress_bar.a,emoji_text_component.a,icon.a,menu.d,menu.a,menu.b,dialog_component.a,fesm2015_dialog.h,fesm2015_dialog.e,readme_component.a,fesm2015_dialog.c,fesm2015_dialog.d],pipes:[common.b,moment_pipe.a,pipes_pipe_UpdatedTimePipe],styles:[\"[_nghost-%COMP%]{position:relative;display:block;width:100%}[_nghost-%COMP%]   .mat-button[_ngcontent-%COMP%]{width:100%;text-align:left;padding:8px 16px}[_nghost-%COMP%]   .wm-avatar[_ngcontent-%COMP%]{width:56px;height:56px;margin-right:6px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .unread[_ngcontent-%COMP%]{font-weight:600}[_nghost-%COMP%]   .menu[_ngcontent-%COMP%]{transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}\"]}),Conversation})();var lib_text=__webpack_require__(\"WIkw\");let conversation_module_ConversationModule=(()=>{class ConversationModule{}return ConversationModule.ɵmod=core.Ob({type:ConversationModule}),ConversationModule.ɵinj=core.Nb({factory:function(t){return new(t||ConversationModule)},imports:[[common.c,fesm2015_router.k,flex_layout.a,badge.b,fesm2015_button.c,icon.b,menu.c,progress_bar.b,lib_text.b,readme_src.a,avatar.a,dialog.b,src.c,moment.a,pipes_module_PipesModule]]}),ConversationModule})();var takeWhile=__webpack_require__(\"GJmQ\"),icon_component=__webpack_require__(\"h0Qx\");function Message_ng_container_0_div_3_Template(rf,ctx){if(1&rf&&(core.Wb(0,\"div\"),core.Wb(1,\"b\"),core.Ic(2),core.jc(3,\"async\"),core.Vb(),core.Vb()),2&rf){const ctx_r2=core.ic(2);let tmp_0_0=null;core.Db(2),core.Jc(null==(tmp_0_0=core.kc(3,1,ctx_r2.sender$))?null:tmp_0_0.fullName)}}function Message_ng_container_0_span_5_Template(rf,ctx){if(1&rf&&(core.Wb(0,\"span\",9),core.Rb(1,\"wm-icon\",10),core.Wb(2,\"span\"),core.Ic(3),core.Vb(),core.Vb()),2&rf){const msgs_r1=core.ic().$implicit;core.Db(1),core.pc(\"icon\",(null==msgs_r1.delete?null:msgs_r1.delete.icon)||\"error_outline\"),core.Db(2),core.Jc((null==msgs_r1.delete?null:msgs_r1.delete.message)||\"This message has been deleted\")}}function Message_ng_container_0_ng_template_7_Template(rf,ctx){if(1&rf&&core.Rb(0,\"span\",11),2&rf){const ctx_r5=core.ic(2);core.pc(\"wm-emoji-text\",null==ctx_r5.data?null:ctx_r5.data.body)}}function Message_ng_container_0_ng_container_14_Template(rf,ctx){if(1&rf){const _r10=core.Xb();core.Ub(0),core.Wb(1,\"mat-icon\",12),core.Ic(2,\"expand_more\"),core.Vb(),core.Wb(3,\"mat-menu\",null,13),core.Wb(5,\"button\",14),core.ec(\"click\",function(){return core.yc(_r10),core.ic(2).delete()}),core.Ic(6),core.Vb(),core.Vb(),core.Tb()}if(2&rf){const _r8=core.vc(4),msgs_r1=core.ic().$implicit;core.Db(1),core.pc(\"matMenuTriggerFor\",_r8),core.Db(5),core.Jc((null==msgs_r1.delete?null:msgs_r1.delete.label)||\"Delete message\")}}function Message_ng_container_0_Template(rf,ctx){if(1&rf&&(core.Ub(0),core.Wb(1,\"wm-balloon\",1),core.Wb(2,\"div\",2),core.Gc(3,Message_ng_container_0_div_3_Template,4,3,\"div\",3),core.Wb(4,\"div\",4),core.Gc(5,Message_ng_container_0_span_5_Template,4,2,\"span\",5),core.jc(6,\"async\"),core.Gc(7,Message_ng_container_0_ng_template_7_Template,1,1,\"ng-template\",null,6,core.Hc),core.Rb(9,\"span\",7),core.Wb(10,\"time\",8),core.Ic(11),core.jc(12,\"moment\"),core.jc(13,\"timestamp\"),core.Vb(),core.Gc(14,Message_ng_container_0_ng_container_14_Template,7,2,\"ng-container\",3),core.Vb(),core.Vb(),core.Vb(),core.Tb()),2&rf){const msgs_r1=ctx.$implicit,_r4=core.vc(8),ctx_r0=core.ic();core.Db(1),core.pc(\"color\",(null==ctx_r0.data?null:ctx_r0.data.sender)===ctx_r0.me?\"accent\":\"primary\")(\"side\",(null==ctx_r0.data?null:ctx_r0.data.sender)===ctx_r0.me?\"right\":\"left\")(\"anchor\",(null==ctx_r0.data?null:ctx_r0.data.sender)!==ctx_r0.thread?\"start\":\"\"),core.Db(2),core.pc(\"ngIf\",(null==ctx_r0.data?null:ctx_r0.data.sender)!==ctx_r0.thread),core.Db(2),core.pc(\"ngIf\",core.kc(6,8,ctx_r0.deleted$))(\"ngIfElse\",_r4),core.Db(6),core.Jc(core.lc(12,10,core.kc(13,13,null==ctx_r0.data?null:ctx_r0.data.created),msgs_r1.timeFormat||\"LT\")),core.Db(3),core.pc(\"ngIf\",(null==ctx_r0.data?null:ctx_r0.data.sender)===ctx_r0.me)}}let message_component_Message=(()=>{class Message extends database_document.b{constructor(db,user){super(db),this.user=user,this.dataChange=new core.o}get id(){return this.data.id}get me(){return this.user.uid}set message(message){this.data=this.unwrap(message),this.sender$=this.user.fromUserId(this.data.sender),this.deleted$=this.asObservable().pipe(Object(map.a)(snap=>!snap.exists),Object(startWith.a)(!message.exists),Object(takeWhile.a)(deleted=>!deleted,!0),Object(distinctUntilChanged.a)()),this.dataChange.emit(this.data)}onContextMenu(){var _a;return null===(_a=this.menuTrigger)||void 0===_a||_a.openMenu(),!1}}return Message.ɵfac=function(t){return new(t||Message)(core.Qb(database.b),core.Qb(utils_user.b))},Message.ɵcmp=core.Kb({type:Message,selectors:[[\"wm-message\"]],viewQuery:function(rf,ctx){if(1&rf&&core.Lc(menu.d,1),2&rf){let _t;core.uc(_t=core.fc())&&(ctx.menuTrigger=_t.first)}},hostAttrs:[1,\"wm-message\"],hostVars:4,hostBindings:function(rf,ctx){1&rf&&core.ec(\"contextmenu\",function(){return ctx.onContextMenu()}),2&rf&&core.Ib(\"in\",(null==ctx.data?null:ctx.data.sender)!==ctx.me)(\"out\",(null==ctx.data?null:ctx.data.sender)===ctx.me)},inputs:{thread:\"thread\",message:\"message\"},outputs:{dataChange:\"data\"},features:[core.Ab],decls:1,vars:1,consts:[[4,\"wmContent\",\"wmContentSelect\"],[1,\"mat-elevation-z2\",3,\"color\",\"side\",\"anchor\"],[\"fxLayout\",\"column\",\"fxLayoutAlign\",\"start stretch\",\"fxLayoutGap\",\"2px\"],[4,\"ngIf\"],[\"fxLayout\",\"row\"],[\"class\",\"deleted\",4,\"ngIf\",\"ngIfElse\"],[\"messageBody\",\"\"],[1,\"spacer\"],[1,\"time\",\"mat-small\"],[1,\"deleted\"],[3,\"icon\"],[3,\"wm-emoji-text\"],[1,\"menu\",3,\"matMenuTriggerFor\"],[\"menu\",\"matMenu\"],[\"mat-menu-item\",\"\",3,\"click\"]],template:function(rf,ctx){1&rf&&core.Gc(0,Message_ng_container_0_Template,15,15,\"ng-container\",0),2&rf&&core.pc(\"wmContentSelect\",\"chat.message\")},directives:[content_directive.a,balloon_component_BalloonComponent,flex.e,flex.d,flex.f,common.m,icon_component.a,emoji_text_component.a,icon.a,menu.d,menu.a,menu.b],pipes:[common.b,moment_pipe.c,pipes_pipe_TimestampPipe],styles:[\"[_nghost-%COMP%]{position:relative;display:flex;flex-flow:row;padding:0 2vw}.in[_nghost-%COMP%]{justify-content:flex-start}.out[_nghost-%COMP%]{justify-content:flex-end}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .deleted[_ngcontent-%COMP%]{opacity:.5;font-style:italic}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{display:inline-block;width:48px}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:5px;bottom:0;opacity:.5}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{position:absolute;right:5px;top:0;background-color:inherit;cursor:pointer;transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}\"]}),Message})(),message_module_MessageModule=(()=>{class MessageModule{}return MessageModule.ɵmod=core.Ob({type:MessageModule}),MessageModule.ɵinj=core.Nb({factory:function(t){return new(t||MessageModule)},imports:[[common.c,flex_layout.a,icon.b,menu.c,lib_text.b,lib_icon.a,balloon_module_BalloonModule,moment.a,pipes_module_PipesModule,src.c]]}),MessageModule})();var expansion=__webpack_require__(\"o4Yh\"),coercion=__webpack_require__(\"8LU1\"),platform=__webpack_require__(\"OWci\"),utils_textarea=__webpack_require__(\"0zyZ\"),lib_utils=__webpack_require__(\"eyIN\"),tooltip=__webpack_require__(\"ZFy/\"),emoji_keyboard_component=__webpack_require__(\"0qK6\"),form_field=__webpack_require__(\"Q2Ze\"),input=__webpack_require__(\"e6WT\"),typein_adapter_directive=__webpack_require__(\"nGdH\"),text_field=__webpack_require__(\"8sFK\"),textarea_newline_directive=__webpack_require__(\"gX7t\"),emoji_input_component=__webpack_require__(\"H7fF\"),emoji_material_directive=__webpack_require__(\"XtK9\");function MessageComposer_ng_container_0_mat_form_field_2_Template(rf,ctx){if(1&rf){const _r6=core.Xb();core.Wb(0,\"mat-form-field\",8),core.Wb(1,\"mat-label\"),core.Ic(2),core.Vb(),core.Wb(3,\"textarea\",9),core.ec(\"valueChange\",function($event){return core.yc(_r6),core.ic(2).value=$event}),core.Ic(4,\"      \"),core.Vb(),core.Wb(5,\"wm-icon\",10),core.ec(\"mousedown\",function(){core.yc(_r6);const ctx_r7=core.ic(2);return!ctx_r7.disabled&&ctx_r7.toggleEmojiKeys()}),core.Vb(),core.Vb()}if(2&rf){const msgs_r1=core.ic().$implicit,ctx_r2=core.ic();core.Db(2),core.Jc(msgs_r1.placeholder||\"Type a message\"),core.Db(1),core.pc(\"value\",ctx_r2.value)(\"newline\",ctx_r2.enterMode)(\"disabled\",ctx_r2.disabled),core.Db(2),core.Ib(\"color-disabled\",ctx_r2.disabled),core.pc(\"icon\",(null==msgs_r1.emoji?null:msgs_r1.emoji.icon)||\"insert_emoticon\")(\"matTooltip\",(null==msgs_r1.emoji?null:msgs_r1.emoji.tooltip)||\"Insert an emoji\")}}function MessageComposer_ng_container_0_ng_template_3_Template(rf,ctx){if(1&rf){const _r10=core.Xb();core.Wb(0,\"mat-form-field\",8),core.Wb(1,\"mat-label\"),core.Ic(2),core.Vb(),core.Wb(3,\"wm-emoji-input\",11),core.ec(\"valueChange\",function($event){return core.yc(_r10),core.ic(2).value=$event}),core.Vb(),core.Wb(4,\"wm-icon\",10),core.ec(\"mousedown\",function(){core.yc(_r10);const ctx_r11=core.ic(2);return!ctx_r11.disabled&&ctx_r11.toggleEmojiKeys()}),core.Vb(),core.Vb()}if(2&rf){const msgs_r1=core.ic().$implicit,ctx_r4=core.ic();core.Db(2),core.Jc(msgs_r1.placeholder||\"Type a message\"),core.Db(1),core.pc(\"value\",ctx_r4.value)(\"newline\",ctx_r4.enterMode)(\"disabled\",ctx_r4.disabled),core.Db(1),core.Ib(\"color-disabled\",ctx_r4.disabled),core.pc(\"icon\",(null==msgs_r1.emoji?null:msgs_r1.emoji.icon)||\"insert_emoticon\")(\"matTooltip\",(null==msgs_r1.emoji?null:msgs_r1.emoji.tooltip)||\"Insert an emoji\")}}function MessageComposer_ng_container_0_Template(rf,ctx){if(1&rf){const _r14=core.Xb();core.Ub(0),core.Wb(1,\"div\",1),core.ec(\"keydown\",function($event){return core.yc(_r14),core.ic().sendOnEnter($event)}),core.Gc(2,MessageComposer_ng_container_0_mat_form_field_2_Template,6,8,\"mat-form-field\",2),core.Gc(3,MessageComposer_ng_container_0_ng_template_3_Template,5,8,\"ng-template\",null,3,core.Hc),core.Wb(5,\"button\",4),core.ec(\"mousedown\",function(){return core.yc(_r14),core.ic().sendNow()}),core.Rb(6,\"wm-icon\",5),core.Vb(),core.Vb(),core.Wb(7,\"mat-expansion-panel\",6),core.ec(\"afterExpand\",function(){return core.yc(_r14),core.ic().expanded.emit()}),core.Wb(8,\"wm-emoji-keyboard\",7),core.ec(\"keyPressed\",function($event){core.yc(_r14);const ctx_r17=core.ic();return!ctx_r17.disabled&&ctx_r17.typein($event)}),core.Vb(),core.Vb(),core.Tb()}if(2&rf){const msgs_r1=ctx.$implicit,_r3=core.vc(4),ctx_r0=core.ic();core.Db(2),core.pc(\"ngIf\",\"native\"===ctx_r0.mode)(\"ngIfElse\",_r3),core.Db(3),core.pc(\"disabled\",ctx_r0.disabled||!ctx_r0.valid),core.Db(1),core.pc(\"icon\",(null==msgs_r1.send?null:msgs_r1.send.icon)||\"send\")(\"matTooltip\",(null==msgs_r1.send?null:msgs_r1.send.tooltip)||\"Send\"),core.Db(2),core.pc(\"favorites\",ctx_r0.keys)(\"mode\",ctx_r0.mode)}}let composer_component_MessageComposer=(()=>{class MessageComposer{constructor(utils,touch){this.utils=utils,this.touch=touch,this._disabled=!1,this.valueChange=new core.o,this.expanded=new core.o,this.send=new core.o}set value(value){this.valueChange.emit(this._value=value)}get value(){return this._value}set disabled(value){var _a;(this._disabled=Object(coercion.c)(value))&&(null===(_a=this.emojiKeysPanel)||void 0===_a||_a.close())}get disabled(){return this._disabled}typein(key){var _a;return null===(_a=this.typeinAdapter)||void 0===_a||_a.typein(key),!1}toggleEmojiKeys(){return this.emojiKeysPanel.toggle(),!1}get mode(){return this.utils.emojiMode()}get enterMode(){return this.touch?\"always\":\"shift\"}sendOnEnter(ev){return this.touch||ev.shiftKey||\"Enter\"!==ev.key||this.sendNow()}get valid(){return null===(this.value||\"\").match(/^\\s*$/)}sendNow(){return this.valid&&this.send.emit(this.value),!1}}return MessageComposer.ɵfac=function(t){return new(t||MessageComposer)(core.Qb(lib_utils.c),core.Qb(platform.b))},MessageComposer.ɵcmp=core.Kb({type:MessageComposer,selectors:[[\"wm-composer\"]],viewQuery:function(rf,ctx){if(1&rf&&(core.Lc(expansion.c,1),core.Lc(utils_textarea.b,1)),2&rf){let _t;core.uc(_t=core.fc())&&(ctx.emojiKeysPanel=_t.first),core.uc(_t=core.fc())&&(ctx.typeinAdapter=_t.first)}},hostAttrs:[1,\"wm-composer\"],inputs:{value:\"value\",keys:\"keys\",disabled:\"disabled\"},outputs:{valueChange:\"valueChange\",expanded:\"expanded\",send:\"send\"},decls:1,vars:1,consts:[[4,\"wmContent\",\"wmContentSelect\"],[\"fxLayout\",\"row\",\"fxLayoutAlign\",\"center end\",1,\"input\",3,\"keydown\"],[\"appearance\",\"legacy\",\"fxFlex\",\"1 1 auto\",4,\"ngIf\",\"ngIfElse\"],[\"webMode\",\"\"],[\"mat-icon-button\",\"\",3,\"disabled\",\"mousedown\"],[3,\"icon\",\"matTooltip\"],[\"hideToggle\",\"\",1,\"padding-0\",\"mat-elevation-z0\",3,\"afterExpand\"],[3,\"favorites\",\"mode\",\"keyPressed\"],[\"appearance\",\"legacy\",\"fxFlex\",\"1 1 auto\"],[\"matInput\",\"\",\"typein\",\"\",\"cdkTextareaAutosize\",\"\",\"cdkAutosizeMinRows\",\"1\",3,\"value\",\"newline\",\"disabled\",\"valueChange\"],[\"inline\",\"\",\"matSuffix\",\"\",1,\"tools\",3,\"icon\",\"matTooltip\",\"mousedown\"],[\"matEmoji\",\"\",\"typein\",\"\",3,\"value\",\"newline\",\"disabled\",\"valueChange\"]],template:function(rf,ctx){1&rf&&core.Gc(0,MessageComposer_ng_container_0_Template,9,7,\"ng-container\",0),2&rf&&core.pc(\"wmContentSelect\",\"chat.composer\")},directives:[content_directive.a,flex.e,flex.d,common.m,fesm2015_button.b,icon_component.a,tooltip.b,expansion.c,emoji_keyboard_component.a,form_field.c,flex.b,form_field.g,input.b,typein_adapter_directive.a,text_field.b,textarea_newline_directive.a,form_field.i,emoji_input_component.a,emoji_material_directive.a],styles:[\"[_nghost-%COMP%]{position:relative;display:flex;flex-flow:column;justify-content:center;align-items:stretch;box-sizing:border-box;margin-top:5px}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{margin:0 20px}[_nghost-%COMP%]   .wm-emoji-input[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{word-break:break-all}[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{cursor:pointer;vertical-align:middle}[_nghost-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{margin-bottom:10px}\"]}),MessageComposer})();var lib_input=__webpack_require__(\"UYqx\"),material=__webpack_require__(\"KRLS\"),emoji_keyboard_src=__webpack_require__(\"glvt\");let composer_module_ComposerModule=(()=>{class ComposerModule{}return ComposerModule.ɵmod=core.Ob({type:ComposerModule}),ComposerModule.ɵinj=core.Nb({factory:function(t){return new(t||ComposerModule)},imports:[[common.c,flex_layout.a,fesm2015_button.c,input.c,form_field.e,expansion.b,tooltip.c,lib_input.b,material.a,emoji_keyboard_src.a,src.c,lib_icon.a,utils_textarea.a]]}),ComposerModule})();var collection=__webpack_require__(\"lPMd\"),take=__webpack_require__(\"IzEk\"),of=__webpack_require__(\"LRne\");let chat_service_ChatService=(()=>{class ChatService extends collection.a{constructor(db,user,router){super(db,\"conversations\"),this.user=user,this.router=router}get me(){return this.user.uid}canActivate(route,state){var _a;const userName=route.queryParamMap.get(\"with\");return!(!this.user.auth.authenticated||userName==(null===(_a=this.user.data)||void 0===_a?void 0:_a.userName))&&(userName?userName.startsWith(\"unknown-\")?Object(of.a)(!0):this.user.fromUserName(userName).pipe(Object(take.a)(1),Object(switchMap.a)(user=>{if(!user||user.id===this.me)return Object(of.a)(!1);const ref=this.ref.doc(this.me<user.id?this.me.concat(user.id):user.id.concat(this.me)),recipients=this.db.arrayUnion(this.user.uid,user.id);return this.db.transaction(trx=>trx.snap(ref).then(({exists:exists})=>(exists?trx.merge(ref,{recipients:recipients}):trx.set(ref,{recipients:recipients}),!0)))})):this.pipe(Object(operators.j)(qf=>qf.where(\"recipients\",\"array-contains\",this.me).orderBy(\"updated\",\"desc\").limit(1)),Object(operators.d)(),Object(switchMap.a)(snap=>{if(snap.empty)return Object(of.a)(!0);const sender=snap.docs[0].data().recipients.find(recipient=>recipient!=this.me);return this.user.fromUserId(sender).pipe(Object(take.a)(1),Object(map.a)(user=>{const userName=(null==user?void 0:user.userName)||`unknown-${snap.docs[0].id}`;return this.router.createUrlTree(state.url.split(\"/\"),{queryParams:{with:userName}})}))})))}}return ChatService.ɵfac=function(t){return new(t||ChatService)(core.ac(database.b),core.ac(utils_user.b),core.ac(fesm2015_router.g))},ChatService.ɵprov=core.Mb({token:ChatService,factory:ChatService.ɵfac,providedIn:\"root\"}),ChatService})();var expand=__webpack_require__(\"FQpF\"),filter=__webpack_require__(\"pLZG\"),pluck=__webpack_require__(\"wO+i\"),delay=__webpack_require__(\"3E0/\"),tap=__webpack_require__(\"vkgz\"),takeUntil=__webpack_require__(\"1G5W\"),skip=__webpack_require__(\"zP0r\"),BehaviorSubject=__webpack_require__(\"2Vo4\"),combineLatest=__webpack_require__(\"itXk\"),scrolling=__webpack_require__(\"DwbE\"),rxjs_src=__webpack_require__(\"j8uH\"),animations=__webpack_require__(\"GS7A\");const $timing=\"450ms cubic-bezier(0.8, -0.5, 0.2, 1.5)\";let $animations=[Object(animations.o)(\"pop\",[Object(animations.n)(\":enter\",[Object(animations.m)({transform:\"scale(0.5)\",opacity:0}),Object(animations.e)($timing,Object(animations.m)(\"*\"))]),Object(animations.n)(\":leave\",Object(animations.e)($timing,Object(animations.m)({transform:\"scale(0.5)\",opacity:0})))])];var gtag_directive=__webpack_require__(\"FkMH\"),actionbar_directive=__webpack_require__(\"mx0f\"),fab_directive=__webpack_require__(\"glcp\"),button_media_changer_directive=__webpack_require__(\"U3RD\"),sidenav_directive=__webpack_require__(\"++Qg\"),can_leave_directive=__webpack_require__(\"q9NA\");function ChatComponent_ng_container_0_ng_template_1_wm_icon_1_Template(rf,ctx){if(1&rf&&core.Rb(0,\"wm-icon\",13),2&rf){const msgs_r1=core.ic(2).$implicit;core.pc(\"icon\",(null==msgs_r1.conversation||null==msgs_r1.conversation.new?null:msgs_r1.conversation.new.icon)||\"add_comment\")}}function ChatComponent_ng_container_0_ng_template_1_ng_template_2_Template(rf,ctx){if(1&rf&&core.Ic(0),2&rf){const msgs_r1=core.ic(2).$implicit;core.Jc((null==msgs_r1.conversation||null==msgs_r1.conversation.new?null:msgs_r1.conversation.new.caption)||\"New chat\")}}function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_wm_conversation_1_Template(rf,ctx){if(1&rf){const _r21=core.Xb();core.Wb(0,\"wm-conversation\",16),core.ec(\"deleting\",function($event){core.yc(_r21);const ctx_r20=core.ic(6);return ctx_r20.onDeleting($event,ctx_r20.conv.id)})(\"click\",function(){core.yc(_r21);const ctx_r22=core.ic(6);return ctx_r22.browse=!ctx_r22.browse}),core.Vb()}if(2&rf){const activeConversation_r16=core.ic(2).ngIf;core.pc(\"content\",activeConversation_r16)}}function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_Template(rf,ctx){1&rf&&(core.Ub(0),core.Gc(1,ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_wm_conversation_1_Template,1,1,\"wm-conversation\",15),core.Tb())}function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_wm_conversation_2_Template(rf,ctx){if(1&rf){const _r26=core.Xb();core.Wb(0,\"wm-conversation\",17),core.ec(\"deleting\",function($event){core.yc(_r26);const conv_r24=ctx.$implicit;return core.ic(5).onDeleting($event,conv_r24.id)})(\"click\",function(){core.yc(_r26);const mobile_r8=core.ic(3).isMobile,ctx_r27=core.ic(2);return mobile_r8&&(ctx_r27.browse=!ctx_r27.browse)}),core.Vb()}if(2&rf){const conv_r24=ctx.$implicit,activeConversation_r16=core.ic().ngIf;core.pc(\"content\",conv_r24)(\"highlight\",conv_r24.id===activeConversation_r16.id)(\"showUnread\",conv_r24.id!==activeConversation_r16.id)}}function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_Template(rf,ctx){if(1&rf&&(core.Ub(0),core.Gc(1,ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_Template,2,0,\"ng-container\",5),core.Gc(2,ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_wm_conversation_2_Template,1,3,\"wm-conversation\",14),core.jc(3,\"async\"),core.Tb()),2&rf){const mobile_r8=core.ic(2).isMobile,ctx_r15=core.ic(2);core.Db(1),core.pc(\"ngIf\",mobile_r8),core.Db(1),core.pc(\"ngForOf\",core.kc(3,3,ctx_r15.conversations$))(\"ngForTrackBy\",ctx_r15.trackById)}}function ChatComponent_ng_container_0_ng_template_1_ng_template_4_Template(rf,ctx){if(1&rf&&(core.Gc(0,ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_Template,4,5,\"ng-container\",5),core.jc(1,\"async\")),2&rf){const ctx_r12=core.ic(3);core.pc(\"ngIf\",core.kc(1,1,ctx_r12.activeConversation$))}}function ChatComponent_ng_container_0_ng_template_1_Template(rf,ctx){if(1&rf){const _r32=core.Xb();core.Wb(0,\"button\",9),core.Gc(1,ChatComponent_ng_container_0_ng_template_1_wm_icon_1_Template,1,1,\"wm-icon\",10),core.Gc(2,ChatComponent_ng_container_0_ng_template_1_ng_template_2_Template,1,1,\"ng-template\",null,11,core.Hc),core.Vb(),core.Gc(4,ChatComponent_ng_container_0_ng_template_1_ng_template_4_Template,2,3,\"ng-template\",12),core.jc(5,\"async\"),core.ec(\"openedChange\",function($event){return core.yc(_r32),core.ic(2).browse=$event})}if(2&rf){const mobile_r8=ctx.isMobile,_r10=core.vc(3),msgs_r1=core.ic().$implicit,ctx_r2=core.ic();let tmp_3_0=null;core.pc(\"routerLink\",(null==msgs_r1.conversation||null==msgs_r1.conversation.new?null:msgs_r1.conversation.new.link)||\"/explore/people\"),core.Db(1),core.pc(\"ngIf\",mobile_r8)(\"ngIfElse\",_r10),core.Db(3),core.pc(\"opened\",(null==(tmp_3_0=core.kc(5,4,ctx_r2.conversations$))?null:tmp_3_0.length)>0&&(ctx_r2.browse||!mobile_r8))}}function ChatComponent_ng_container_0_div_3_Template(rf,ctx){1&rf&&(core.Wb(0,\"div\",18),core.Rb(1,\"mat-spinner\",19),core.Vb())}const chat_component_c0=function(){return{sameDay:\"[Today]\",lastDay:\"[Yesterday]\",lastWeek:\"dddd\",sameElse:\"L\"}};function ChatComponent_ng_container_0_ng_container_4_ng_container_1_ng_container_1_Template(rf,ctx){if(1&rf&&(core.Ub(0),core.Wb(1,\"wm-balloon\",22),core.Ic(2),core.jc(3,\"calendar\"),core.jc(4,\"createdTime\"),core.Vb(),core.Tb()),2&rf){const msg_r36=core.ic().$implicit,msgs_r1=core.ic(2).$implicit;core.Db(2),core.Jc(core.lc(3,1,core.kc(4,4,msg_r36),(null==msgs_r1.thread?null:msgs_r1.thread.timeFormat)||core.rc(6,chat_component_c0)))}}function ChatComponent_ng_container_0_ng_container_4_ng_container_1_Template(rf,ctx){if(1&rf&&(core.Ub(0),core.Gc(1,ChatComponent_ng_container_0_ng_container_4_ng_container_1_ng_container_1_Template,5,7,\"ng-container\",5),core.jc(2,\"moment\"),core.jc(3,\"createdTime\"),core.jc(4,\"moment\"),core.jc(5,\"createdTime\"),core.Rb(6,\"wm-message\",21),core.jc(7,\"snapshotData\"),core.Tb()),2&rf){const msg_r36=ctx.$implicit,i_r37=ctx.index,messages_r34=core.ic().ngIf;let tmp_1_0=null;core.Db(1),core.pc(\"ngIf\",0===i_r37||core.lc(2,3,core.kc(3,6,messages_r34[i_r37-1]),\"D\")!==core.lc(4,8,core.kc(5,11,msg_r36),\"D\")),core.Db(5),core.pc(\"thread\",null==(tmp_1_0=core.kc(7,13,messages_r34[i_r37-1]))?null:tmp_1_0.sender)(\"message\",msg_r36)}}function ChatComponent_ng_container_0_ng_container_4_Template(rf,ctx){if(1&rf&&(core.Ub(0),core.Gc(1,ChatComponent_ng_container_0_ng_container_4_ng_container_1_Template,8,15,\"ng-container\",20),core.Tb()),2&rf){const messages_r34=ctx.ngIf,ctx_r4=core.ic(2);core.Db(1),core.pc(\"ngForOf\",messages_r34)(\"ngForTrackBy\",ctx_r4.trackById)}}function ChatComponent_ng_container_0_ng_template_6_button_0_Template(rf,ctx){if(1&rf){const _r44=core.Xb();core.Wb(0,\"button\",24),core.ec(\"click\",function(){return core.yc(_r44),core.ic(3).scrollToBottom()}),core.Wb(1,\"mat-icon\"),core.Ic(2,\"expand_more\"),core.Vb(),core.Vb()}2&rf&&core.pc(\"@pop\",void 0)}function ChatComponent_ng_container_0_ng_template_6_Template(rf,ctx){if(1&rf&&(core.Gc(0,ChatComponent_ng_container_0_ng_template_6_button_0_Template,3,1,\"button\",23),core.jc(1,\"async\")),2&rf){const ctx_r5=core.ic(2);core.pc(\"ngIf\",core.kc(1,1,ctx_r5.scrolled$))}}function ChatComponent_ng_container_0_wm_composer_7_Template(rf,ctx){if(1&rf){const _r46=core.Xb();core.Wb(0,\"wm-composer\",25),core.ec(\"valueChange\",function($event){return core.yc(_r46),core.ic(2).text=$event})(\"expanded\",function(){return core.yc(_r46),core.ic(2).onKeyboardExpand()})(\"send\",function($event){return core.yc(_r46),core.ic(2).send($event)}),core.Vb()}if(2&rf){const ctx_r6=core.ic(2);core.pc(\"value\",ctx_r6.text)(\"keys\",ctx_r6.keys)(\"disabled\",!ctx_r6.recipient||ctx_r6.loading||ctx_r6.deleting)}}function ChatComponent_ng_container_0_wm_dialog_8_Template(rf,ctx){if(1&rf&&(core.Wb(0,\"wm-dialog\",26),core.Wb(1,\"h2\",27),core.Wb(2,\"b\"),core.Ic(3),core.Vb(),core.Vb(),core.Wb(4,\"mat-dialog-content\",28),core.Ic(5,\" You're about to leave the page without sending the last message. \"),core.Vb(),core.Wb(6,\"mat-dialog-actions\",29),core.Wb(7,\"button\",30),core.Ic(8),core.Vb(),core.Wb(9,\"button\",31),core.Ic(10),core.Vb(),core.Vb(),core.Vb()),2&rf){const leave_r49=ctx.ngIf,ctx_r7=core.ic(2);core.pc(\"dontLeave\",!!ctx_r7.text),core.Db(3),core.Jc(leave_r49.title||\"Unsent message\"),core.Db(1),core.pc(\"wm-readme\",leave_r49.message),core.Db(3),core.pc(\"mat-dialog-close\",!1),core.Db(1),core.Jc(leave_r49.cancel||\"Wait\"),core.Db(1),core.pc(\"mat-dialog-close\",!0),core.Db(1),core.Jc(leave_r49.ok||\"Proceed\")}}function ChatComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(core.Ub(0,1),core.Gc(1,ChatComponent_ng_container_0_ng_template_1_Template,6,6,\"ng-template\",2),core.Wb(2,\"div\",3),core.Gc(3,ChatComponent_ng_container_0_div_3_Template,2,0,\"div\",4),core.Gc(4,ChatComponent_ng_container_0_ng_container_4_Template,2,2,\"ng-container\",5),core.jc(5,\"async\"),core.Vb(),core.Gc(6,ChatComponent_ng_container_0_ng_template_6_Template,2,3,\"ng-template\",6),core.Gc(7,ChatComponent_ng_container_0_wm_composer_7_Template,1,3,\"wm-composer\",7),core.Gc(8,ChatComponent_ng_container_0_wm_dialog_8_Template,11,7,\"wm-dialog\",8),core.Tb()),2&rf){const msgs_r1=ctx.$implicit,ctx_r0=core.ic();core.Db(3),core.pc(\"ngIf\",ctx_r0.loading),core.Db(1),core.pc(\"ngIf\",core.kc(5,3,ctx_r0.messages$)),core.Db(4),core.pc(\"ngIf\",msgs_r1.canLeave)}}let chat_component_ChatComponent=(()=>{class ChatComponent extends collection.a{constructor(db,route,router,scroller,user,regex,zone){super(db,\"conversations\"),this.route=route,this.router=router,this.scroller=scroller,this.user=user,this.regex=regex,this.zone=zone,this.reload$=new BehaviorSubject.a(null),this.loading=!0,this.browse=!0,this.deletingCount=0,this.autoScroll=!0,this.stats={\"😂\":1,\"👋🏻\":1,\"👍\":1,\"💕\":1,\"🙏\":1},this.text=\"\",this.recipient=\"\",this.conversations$=this.reload$.pipe(Object(switchMap.a)(()=>this.pipe(Object(operators.n)(\"recipients\",\"array-contains\",this.me),Object(operators.g)(\"created\",\"desc\"),source=>source.pipe(Object(operators.k)(),Object(map.a)(convs=>({cursor:convs[0],convs:this.sortByUpdated(convs,\"desc\")})),Object(expand.a)(({cursor:cursor,convs:convs})=>source.pipe(Object(operators.c)(cursor),Object(operators.f)(zone),Object(filter.a)(snap=>snap.size>0&&!snap.metadata.hasPendingWrites),Object(operators.b)(),Object(take.a)(1),Object(map.a)(latest=>({cursor:latest[0],convs:latest.concat(convs)})))),Object(pluck.a)(\"convs\")),Object(shareReplay.a)(1)))),this.conversationId$=route.queryParamMap.pipe(Object(map.a)(params=>params.get(\"with\")||\"\"),Object(distinctUntilChanged.a)(),Object(delay.a)(0),Object(switchMap.a)(userName=>userName.startsWith(\"unknown-\")?(this.recipient=\"\",Object(of.a)(userName.replace(/^unknown-/,\"\"))):user.fromUserName(userName).pipe(Object(take.a)(1),Object(map.a)(user=>user?(this.recipient=user.id,this.me<user.id?this.me.concat(user.id):this.recipient.concat(this.me)):this.recipient=\"\"))),Object(shareReplay.a)(1)),this.activeConversation$=Object(combineLatest.a)(this.conversations$,this.conversationId$).pipe(Object(map.a)(([convs,id])=>(null==convs?void 0:convs.find(conv=>conv.id===id))||{}));const more$=scroller.pipe(Object(map.a)(scroll=>scroll.top<50),Object(distinctUntilChanged.a)(),Object(filter.a)(value=>value),Object(map.a)(()=>20),Object(tap.a)(()=>this.loading=!0));this.messages$=this.conversationId$.pipe(Object(map.a)(id=>this.conversation=id&&this.document(id)),Object(map.a)(conv=>this.thread=conv&&conv.collection(\"messages\")),Object(switchMap.a)(thread=>thread?thread.pipe(Object(operators.g)(\"created\"),source=>source.pipe(Object(operators.i)(more$),Object(expand.a)(paged=>source.pipe(Object(operators.l)(paged[paged.length-1]),Object(operators.f)(this.db.zone),Object(filter.a)(snap=>snap.size>0&&!snap.metadata.hasPendingWrites),Object(operators.b)(),Object(take.a)(1),Object(map.a)(latest=>paged.concat(latest)))),Object(startWith.a)([]))):Object(of.a)([])),Object(rxjs_src.f)(zone,()=>{this.autoScroll&&this.scrollToBottom(),this.loading=!1}),Object(shareReplay.a)(1)),this.scrolled$=scroller.pipe(Object(map.a)(scroll=>scroll.bottom>=50),Object(distinctUntilChanged.a)(),Object(tap.a)(scrolled=>this.autoScroll=!scrolled),Object(rxjs_src.d)(this.zone))}get deleting(){return this.deletingCount>0}get me(){return this.user.uid}ngAfterViewInit(){this.sub=this.conversationId$.pipe(Object(switchMap.a)(id=>this.fromId(id).pipe(Object(take.a)(1))),Object(map.a)(data=>{var _a;return null===(_a=null==data?void 0:data.status)||void 0===_a?void 0:_a[this.me]}),Object(tap.a)(status=>{console.log(\"Loading\",status),this.stats=(null==status?void 0:status.favorites)||this.stats,this.keys=this.sortFavorites(this.stats)}),Object(expand.a)(status=>this.lastMessage().pipe(Object(takeUntil.a)(this.conversationId$.pipe(Object(skip.a)(1))),Object(map.a)(msg=>null==msg?void 0:msg.created),Object(filter.a)(created=>!!created&&(!(null==status?void 0:status.lastRead)||created>status.lastRead)),Object(switchMap.a)(lastRead=>{const newStatus={favorites:this.stats,lastRead:lastRead};return console.log(\"Saving data\",newStatus),this.conversation.merge({status:{[this.me]:newStatus}}).then(()=>newStatus)}),Object(take.a)(1)))).subscribe()}ngOnDestroy(){this.sub.unsubscribe()}fromId(id){return this.zone.onStable.pipe(Object(take.a)(1),Object(switchMap.a)(()=>this.conversationsList.changes.pipe(Object(startWith.a)(null))),Object(map.a)(()=>this.conversationsList.find(conv=>conv.id===id)),Object(filter.a)(conv=>!!conv),Object(distinctUntilChanged.a)(void 0,conv=>conv.id),Object(switchMap.a)(conv=>conv.data$))}lastMessage(){return this.zone.onStable.pipe(Object(take.a)(1),Object(switchMap.a)(()=>this.messagesList.changes.pipe(Object(startWith.a)(null))),Object(map.a)(()=>{var _a;return null===(_a=this.messagesList.last)||void 0===_a?void 0:_a.data}),Object(distinctUntilChanged.a)())}onDeleting(flag,id){this.deletingCount=this.deletingCount+(flag?1:-1),this.deletingCount<=0&&(this.text=\"\",this.reload())}reload(){return this.router.navigate([\".\"],{relativeTo:this.route,replaceUrl:!0}).then(()=>this.reload$.next())}scrollToBottom(){this.scroller.scrollTo({bottom:0})}onKeyboardExpand(){this.autoScroll&&this.scrollToBottom()}send(body){return this.updateFavorites(body),this.thread.add({body:body,sender:this.me,recipient:this.recipient}).then(()=>{this.autoScroll=!0,this.text=\"\"}),!1}sortFavorites(stats){return Object.keys(stats).sort((a,b)=>stats[b]-stats[a])}updateFavorites(body){let match,emojis=[];for(;match=this.regex.exec(body);){const key=match[0];emojis.findIndex(emoji=>emoji===key)<0&&(emojis.push(match[0]),this.stats[key]=(this.stats[key]||0)+1)}emojis.length>0&&(this.keys=this.sortFavorites(this.stats))}trackById(data){return data.id}sortByUpdated(data,dir){const _dir=\"desc\"===dir?-1:1;return data.sort((a,b)=>{const aDate=null==a?void 0:a.data().updated;if(!aDate)return _dir;const bDate=null==b?void 0:b.data().updated;return bDate?bDate<aDate?_dir:bDate>aDate?-_dir:0:-_dir})}}return ChatComponent.ɵfac=function(t){return new(t||ChatComponent)(core.Qb(database.b),core.Qb(fesm2015_router.a),core.Qb(fesm2015_router.g),core.Qb(scrolling.a),core.Qb(utils_user.b),core.Qb(lib_utils.b),core.Qb(core.B))},ChatComponent.ɵcmp=core.Kb({type:ChatComponent,selectors:[[\"wm-chat\"]],viewQuery:function(rf,ctx){if(1&rf&&(core.Lc(conversation_component_Conversation,1),core.Lc(message_component_Message,1)),2&rf){let _t;core.uc(_t=core.fc())&&(ctx.conversationsList=_t),core.uc(_t=core.fc())&&(ctx.messagesList=_t)}},features:[core.Ab],decls:1,vars:1,consts:[[\"gtag\",\"chat\",4,\"wmContent\",\"wmContentSelect\"],[\"gtag\",\"chat\"],[\"wmActionbar\",\"\"],[\"fxFlex\",\"100\",\"fxLayout\",\"column\",\"fxLayoutAlign\",\"end stretch\"],[\"fxLayout\",\"row\",\"fxLayoutAlign\",\"center\",4,\"ngIf\"],[4,\"ngIf\"],[\"wmFab\",\"right bottom\"],[3,\"value\",\"keys\",\"disabled\",\"valueChange\",\"expanded\",\"send\",4,\"wmFooter\"],[3,\"dontLeave\",4,\"ngIf\"],[\"mat-stroked-button\",\"\",\"type.lt-sm\",\"icon\",\"color\",\"primary\",3,\"routerLink\"],[3,\"icon\",4,\"ngIf\",\"ngIfElse\"],[\"newMessage\",\"\"],[\"wmSidenav\",\"\",\"persist\",\"\",\"minWidth\",\"280px\",\"maxWidth\",\"350px\",3,\"opened\",\"openedChange\"],[3,\"icon\"],[\"color\",\"primary\",3,\"content\",\"highlight\",\"showUnread\",\"deleting\",\"click\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"content\",\"deleting\",\"click\",4,\"wmToolbar\"],[3,\"content\",\"deleting\",\"click\"],[\"color\",\"primary\",3,\"content\",\"highlight\",\"showUnread\",\"deleting\",\"click\"],[\"fxLayout\",\"row\",\"fxLayoutAlign\",\"center\"],[\"mode\",\"indeterminate\",\"diameter\",\"40\"],[4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"thread\",\"message\"],[\"fxFlexAlign\",\"center\",1,\"group-label\",\"mat-elevation-z2\"],[\"mat-mini-fab\",\"\",\"color\",\"primary\",3,\"click\",4,\"ngIf\"],[\"mat-mini-fab\",\"\",\"color\",\"primary\",3,\"click\"],[3,\"value\",\"keys\",\"disabled\",\"valueChange\",\"expanded\",\"send\"],[3,\"dontLeave\"],[\"mat-dialog-title\",\"\"],[3,\"wm-readme\"],[\"align\",\"end\"],[\"mat-button\",\"\",\"color\",\"warn\",\"cdkFocusInitial\",\"\",3,\"mat-dialog-close\"],[\"mat-button\",\"\",\"color\",\"primary\",3,\"mat-dialog-close\"]],template:function(rf,ctx){1&rf&&core.Gc(0,ChatComponent_ng_container_0_Template,9,5,\"ng-container\",0),2&rf&&core.pc(\"wmContentSelect\",\"chat\")},directives:[content_directive.a,gtag_directive.a,actionbar_directive.a,flex.b,flex.e,flex.d,common.m,fab_directive.a,sticky_footer_directive_StickyFooterDirective,fesm2015_button.b,button_media_changer_directive.a,fesm2015_router.h,sidenav_directive.a,icon_component.a,common.l,toolbar_directive_ToolbarDirective,conversation_component_Conversation,progress_spinner.c,message_component_Message,balloon_component_BalloonComponent,flex.a,icon.a,composer_component_MessageComposer,dialog_component.a,can_leave_directive.a,fesm2015_dialog.h,fesm2015_dialog.e,readme_component.a,fesm2015_dialog.c,fesm2015_dialog.d],pipes:[common.b,moment_pipe.c,pipes_pipe_CreatedTimePipe,pipes_pipe_SnapshotDataPipe,moment_pipe.a],styles:[\"[_nghost-%COMP%]{position:relative;min-height:100%;width:100%;padding:8px;display:flex;flex-direction:column;box-sizing:border-box}[_nghost-%COMP%]   .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%]{margin-top:12px}[_nghost-%COMP%]   .in[_ngcontent-%COMP%] + .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%] + .out[_ngcontent-%COMP%]{margin-top:2px}[_nghost-%COMP%]   .group-label[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:auto}\"],data:{animation:$animations}}),ChatComponent})();__webpack_require__(\"J3Me\");const routes=[{path:\"\",content:[\"chat\",\"emoji-keys\"],component:chat_component_ChatComponent,canActivate:[auth_guard.a,utils_user.c,chat_service_ChatService],data:{authGuardPipe:auth_guard.d},canDeactivate:[can_leave.a]}];let chat_module_ChatModule=(()=>{class ChatModule{}return ChatModule.ɵmod=core.Ob({type:ChatModule}),ChatModule.ɵinj=core.Nb({factory:function(t){return new(t||ChatModule)},imports:[[common.c,flex_layout.a,icon.b,fesm2015_button.c,list.e,badge.b,divider.b,progress_spinner.b,redirect_src.a,pipes_module_PipesModule,gtag_src.a,lib_icon.a,lib_button.a,readme_src.a,avatar.a,balloon_module_BalloonModule,dialog.b,teleport_src.a,actionbar.a,sidenav.a,toolbar_module_ToolbarModule,sticky_footer_module_StickyFooterModule,fab.a,moment.a,can_leave.b,conversation_module_ConversationModule,message_module_MessageModule,composer_module_ComposerModule,src.e.forChild(routes)]]}),ChatModule})()}}]);","name":"24-es2015.4b4e9154355a1aaf3a73.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[24],{\n\n/***/ \"DE2N\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"ChatModule\", function() { return /* binding */ chat_module_ChatModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/fesm2015/common.js\nvar common = __webpack_require__(\"SVse\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/flex-layout/esm2015/flex-layout.js + 1 modules\nvar flex_layout = __webpack_require__(\"u9T3\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/icon.js\nvar icon = __webpack_require__(\"Tj54\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/button.js\nvar fesm2015_button = __webpack_require__(\"Dxy4\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/list.js\nvar list = __webpack_require__(\"SqCe\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/badge.js\nvar badge = __webpack_require__(\"8Qe2\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/divider.js\nvar divider = __webpack_require__(\"BSbQ\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/progress-spinner.js\nvar progress_spinner = __webpack_require__(\"pu8Q\");\n\n// EXTERNAL MODULE: ./content/src/index.ts + 1 modules\nvar src = __webpack_require__(\"g7MM\");\n\n// EXTERNAL MODULE: ./redirect/src/index.ts + 1 modules\nvar redirect_src = __webpack_require__(\"CSIE\");\n\n// EXTERNAL MODULE: ./gtag/src/index.ts + 1 modules\nvar gtag_src = __webpack_require__(\"fi6C\");\n\n// EXTERNAL MODULE: ./elements/src/lib/icon/index.ts + 1 modules\nvar lib_icon = __webpack_require__(\"txmD\");\n\n// EXTERNAL MODULE: ./elements/src/lib/button/index.ts + 1 modules\nvar lib_button = __webpack_require__(\"uaks\");\n\n// EXTERNAL MODULE: ./connect/src/lib/database/document/utils.ts\nvar document_utils = __webpack_require__(\"mjGE\");\n\n// EXTERNAL MODULE: ./node_modules/firebase/app/dist/index.cjs.js\nvar index_cjs = __webpack_require__(\"Wcq6\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/fesm2015/core.js\nvar core = __webpack_require__(\"8Y7J\");\n\n// CONCATENATED MODULE: ./connect/src/lib/database/pipes/pipes.pipe.ts\n\n\n\nlet pipes_pipe_SnapshotDataPipe = /*@__PURE__*/ (() => {\n    class SnapshotDataPipe {\n        transform(value) {\n            return value instanceof index_cjs[\"firestore\"].DocumentSnapshot ? Object(document_utils[\"b\" /* mapSnaphotData */])(value) : value;\n        }\n    }\n    SnapshotDataPipe.ɵfac = function SnapshotDataPipe_Factory(t) { return new (t || SnapshotDataPipe)(); };\n    SnapshotDataPipe.ɵpipe = core[\"Pb\" /* ɵɵdefinePipe */]({ name: \"snapshotData\", type: SnapshotDataPipe, pure: true });\n    return SnapshotDataPipe;\n})();\nlet pipes_pipe_TimestampPipe = /*@__PURE__*/ (() => {\n    class TimestampPipe {\n        transform(value) {\n            return value instanceof index_cjs[\"firestore\"].Timestamp ? value.toDate() : value;\n        }\n    }\n    TimestampPipe.ɵfac = function TimestampPipe_Factory(t) { return new (t || TimestampPipe)(); };\n    TimestampPipe.ɵpipe = core[\"Pb\" /* ɵɵdefinePipe */]({ name: \"timestamp\", type: TimestampPipe, pure: true });\n    return TimestampPipe;\n})();\nlet pipes_pipe_CreatedTimePipe = /*@__PURE__*/ (() => {\n    class CreatedTimePipe {\n        transform(value) {\n            var _a;\n            const data = value instanceof index_cjs[\"firestore\"].DocumentSnapshot ? Object(document_utils[\"b\" /* mapSnaphotData */])(value) : value;\n            return (_a = data === null || data === void 0 ? void 0 : data.created) === null || _a === void 0 ? void 0 : _a.toDate();\n        }\n    }\n    CreatedTimePipe.ɵfac = function CreatedTimePipe_Factory(t) { return new (t || CreatedTimePipe)(); };\n    CreatedTimePipe.ɵpipe = core[\"Pb\" /* ɵɵdefinePipe */]({ name: \"createdTime\", type: CreatedTimePipe, pure: true });\n    return CreatedTimePipe;\n})();\nlet pipes_pipe_UpdatedTimePipe = /*@__PURE__*/ (() => {\n    class UpdatedTimePipe {\n        transform(value) {\n            var _a;\n            const data = value instanceof index_cjs[\"firestore\"].DocumentSnapshot ? Object(document_utils[\"b\" /* mapSnaphotData */])(value) : value;\n            return (_a = ((data === null || data === void 0 ? void 0 : data.updated) || (data === null || data === void 0 ? void 0 : data.created))) === null || _a === void 0 ? void 0 : _a.toDate();\n        }\n    }\n    UpdatedTimePipe.ɵfac = function UpdatedTimePipe_Factory(t) { return new (t || UpdatedTimePipe)(); };\n    UpdatedTimePipe.ɵpipe = core[\"Pb\" /* ɵɵdefinePipe */]({ name: \"updatedTime\", type: UpdatedTimePipe, pure: true });\n    return UpdatedTimePipe;\n})();\n\n// CONCATENATED MODULE: ./connect/src/lib/database/pipes/pipes.module.ts\n\nlet pipes_module_PipesModule = /*@__PURE__*/ (() => {\n    class PipesModule {\n    }\n    PipesModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: PipesModule });\n    PipesModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function PipesModule_Factory(t) { return new (t || PipesModule)(); } });\n    return PipesModule;\n})();\n\n// CONCATENATED MODULE: ./connect/src/lib/database/pipes/index.ts\n\n\n\n// EXTERNAL MODULE: ./readme/src/index.ts + 2 modules\nvar readme_src = __webpack_require__(\"C1VQ\");\n\n// EXTERNAL MODULE: ./elements/src/lib/avatar/index.ts + 1 modules\nvar avatar = __webpack_require__(\"Entk\");\n\n// CONCATENATED MODULE: ./elements/src/lib/balloon/balloon.component.ts\n\nconst _c0 = [\"*\"];\nlet balloon_component_BalloonComponent = /*@__PURE__*/ (() => {\n    class BalloonComponent {\n    }\n    BalloonComponent.ɵfac = function BalloonComponent_Factory(t) { return new (t || BalloonComponent)(); };\n    BalloonComponent.ɵcmp = core[\"Kb\" /* ɵɵdefineComponent */]({ type: BalloonComponent, selectors: [[\"wm-balloon\"]], hostAttrs: [1, \"wm-balloon\"], hostVars: 3, hostBindings: function BalloonComponent_HostBindings(rf, ctx) {\n            if (rf & 2) {\n                core[\"Eb\" /* ɵɵattribute */](\"side\", ctx.side)(\"anchor\", ctx.anchor)(\"color\", ctx.color);\n            }\n        }, inputs: { side: \"side\", anchor: \"anchor\", color: \"color\" }, ngContentSelectors: _c0, decls: 2, vars: 0, consts: [[1, \"balloon-content\"]], template: function BalloonComponent_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"oc\" /* ɵɵprojectionDef */]();\n                core[\"Wb\" /* ɵɵelementStart */](0, \"div\", 0);\n                core[\"nc\" /* ɵɵprojection */](1);\n                core[\"Vb\" /* ɵɵelementEnd */]();\n            }\n        }, styles: [\".wm-balloon{position:relative;display:inline-block;border-radius:6px;box-sizing:border-box}.wm-balloon .balloon-content{position:relative;background-color:inherit;border-radius:inherit;padding:12px;overflow:hidden}.wm-balloon[side=bottom][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=bottom][anchor=center]:after,.wm-balloon[side=bottom][anchor=start]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=bottom][anchor=start]:after{left:12px}.wm-balloon[side=bottom]{margin-bottom:8.4px}.wm-balloon[side=bottom][anchor=end]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;bottom:-1px;transform:translateY(6px) rotate(45deg)}.wm-balloon[side=left][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=left][anchor=center]:after,.wm-balloon[side=left][anchor=start]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=left][anchor=start]:after{top:12px}.wm-balloon[side=left]{margin-left:8.4px}.wm-balloon[side=left][anchor=end]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;left:-1px;transform:translateX(-6px) rotate(135deg)}.wm-balloon[side=right][anchor=center]:after{top:calc(50% - 6px)}.wm-balloon[side=right][anchor=center]:after,.wm-balloon[side=right][anchor=start]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=right][anchor=start]:after{top:12px}.wm-balloon[side=right]{margin-right:8.4px}.wm-balloon[side=right][anchor=end]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;bottom:12px;right:-1px;transform:translateX(6px) rotate(-45deg)}.wm-balloon[side=top][anchor=center]:after{left:calc(50% - 6px)}.wm-balloon[side=top][anchor=center]:after,.wm-balloon[side=top][anchor=start]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;top:-1px;transform:translateY(-6px) rotate(-135deg)}.wm-balloon[side=top][anchor=start]:after{left:12px}.wm-balloon[side=top]{margin-top:8.4px}.wm-balloon[side=top][anchor=end]:after{position:absolute;display:block;content:\\\"\\\";width:12px;height:12px;transform-origin:50% 50%;border-width:inherit;border-color:inherit;border-right-style:inherit;border-bottom-style:inherit;border-top-style:none;border-left-style:none;background-color:inherit;box-sizing:border-box;right:12px;top:-1px;transform:translateY(-6px) rotate(-135deg)}\"], encapsulation: 2 });\n    return BalloonComponent;\n})();\n\n// CONCATENATED MODULE: ./elements/src/lib/balloon/balloon.module.ts\n\nlet balloon_module_BalloonModule = /*@__PURE__*/ (() => {\n    class BalloonModule {\n    }\n    BalloonModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: BalloonModule });\n    BalloonModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function BalloonModule_Factory(t) { return new (t || BalloonModule)(); }, imports: [[]] });\n    return BalloonModule;\n})();\n\n// CONCATENATED MODULE: ./elements/src/lib/balloon/index.ts\n\n\n\n// EXTERNAL MODULE: ./elements/src/lib/dialog/index.ts + 1 modules\nvar dialog = __webpack_require__(\"XNpK\");\n\n// EXTERNAL MODULE: ./teleport/src/index.ts + 3 modules\nvar teleport_src = __webpack_require__(\"EiPp\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/actionbar/index.ts + 1 modules\nvar actionbar = __webpack_require__(\"kNiW\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/sidenav/index.ts + 1 modules\nvar sidenav = __webpack_require__(\"sFr1\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/navigator/toolbar/toolbar.directive.ts\n\n\n\n\nlet toolbar_directive_ToolbarDirective = /*@__PURE__*/ (() => {\n    class ToolbarDirective {\n        constructor(teleport, template) {\n            this.teleport = teleport;\n            this.template = template;\n        }\n        // Activates the toolbar portal\n        ngOnInit() {\n            this.teleport.activate('toolbar', this.template, {\n                align: this.wmToolbarAlign,\n                gap: this.wmToolbarGap\n            });\n        }\n        // Refreshes on input change\n        ngOnChanges(changes) { this.ngOnInit(); }\n        // Releases the portal when done\n        ngOnDestroy() { this.teleport.clear('toolbar', this.template); }\n    }\n    ToolbarDirective.ɵfac = function ToolbarDirective_Factory(t) { return new (t || ToolbarDirective)(core[\"Qb\" /* ɵɵdirectiveInject */](teleport_src[\"b\" /* TeleportService */]), core[\"Qb\" /* ɵɵdirectiveInject */](core[\"O\" /* TemplateRef */])); };\n    ToolbarDirective.ɵdir = core[\"Lb\" /* ɵɵdefineDirective */]({ type: ToolbarDirective, selectors: [[\"ng-template\", \"wmToolbar\", \"\"]], inputs: { wmToolbarAlign: \"wmToolbarAlign\", wmToolbarGap: \"wmToolbarGap\" }, features: [core[\"Bb\" /* ɵɵNgOnChangesFeature */]] });\n    return ToolbarDirective;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/navigator/toolbar/toolbar.module.ts\n\nlet toolbar_module_ToolbarModule = /*@__PURE__*/ (() => {\n    class ToolbarModule {\n    }\n    ToolbarModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: ToolbarModule });\n    ToolbarModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function ToolbarModule_Factory(t) { return new (t || ToolbarModule)(); } });\n    return ToolbarModule;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/navigator/toolbar/index.ts\n\n\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/footer/footer.component.ts\nvar footer_component = __webpack_require__(\"3wf5\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/footer/footer.module.ts\nvar footer_module = __webpack_require__(\"A8Sn\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/navigator/footer/sticky-footer.directive.ts\n\n\n\n\nlet sticky_footer_directive_StickyFooterDirective = /*@__PURE__*/ (() => {\n    class StickyFooterDirective {\n        constructor(teleport, template) {\n            this.teleport = teleport;\n            this.template = template;\n        }\n        // Teleports the template to the 'footer' portal\n        ngOnInit() { this.teleport.activate('footer', this.template); }\n        // Clears the 'footer' portal\n        ngOnDestroy() { this.teleport.clear('footer', this.template); }\n    }\n    StickyFooterDirective.ɵfac = function StickyFooterDirective_Factory(t) { return new (t || StickyFooterDirective)(core[\"Qb\" /* ɵɵdirectiveInject */](teleport_src[\"b\" /* TeleportService */]), core[\"Qb\" /* ɵɵdirectiveInject */](core[\"O\" /* TemplateRef */])); };\n    StickyFooterDirective.ɵdir = core[\"Lb\" /* ɵɵdefineDirective */]({ type: StickyFooterDirective, selectors: [[\"ng-template\", \"wmFooter\", \"\"]] });\n    return StickyFooterDirective;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/navigator/footer/sticky-footer.module.ts\n\nlet sticky_footer_module_StickyFooterModule = /*@__PURE__*/ (() => {\n    class StickyFooterModule {\n    }\n    StickyFooterModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: StickyFooterModule });\n    StickyFooterModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function StickyFooterModule_Factory(t) { return new (t || StickyFooterModule)(); }, imports: [[\n            //TeleportModule\n            ]] });\n    return StickyFooterModule;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/navigator/footer/index.ts\n\n\n\n\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/fab/index.ts + 1 modules\nvar fab = __webpack_require__(\"u8yb\");\n\n// EXTERNAL MODULE: ./pipes/src/lib/moment/index.ts + 1 modules\nvar moment = __webpack_require__(\"pvxE\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/can-leave/index.ts + 1 modules\nvar can_leave = __webpack_require__(\"h4JL\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/auth-guard/index.ts + 2 modules\nvar auth_guard = __webpack_require__(\"U9eP\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/user/index.ts + 5 modules\nvar utils_user = __webpack_require__(\"lWmb\");\n\n// EXTERNAL MODULE: ./connect/src/lib/database/collection/operators.ts + 1 modules\nvar operators = __webpack_require__(\"wSf6\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/startWith.js\nvar startWith = __webpack_require__(\"JX91\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/shareReplay.js\nvar shareReplay = __webpack_require__(\"UXun\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/map.js\nvar map = __webpack_require__(\"lJxs\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/distinctUntilChanged.js\nvar distinctUntilChanged = __webpack_require__(\"/uUt\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/switchMap.js\nvar switchMap = __webpack_require__(\"eIep\");\n\n// EXTERNAL MODULE: ./connect/src/lib/database/index.ts + 6 modules\nvar database = __webpack_require__(\"eYWy\");\n\n// EXTERNAL MODULE: ./connect/src/lib/database/document/index.ts + 4 modules\nvar database_document = __webpack_require__(\"1Blm\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/menu.js\nvar menu = __webpack_require__(\"rJgo\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/fesm2015/router.js + 1 modules\nvar fesm2015_router = __webpack_require__(\"iInd\");\n\n// EXTERNAL MODULE: ./content/src/lib/streamer/content.directive.ts\nvar content_directive = __webpack_require__(\"Qfjl\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/flex-layout/esm2015/flex.js\nvar flex = __webpack_require__(\"VDRc\");\n\n// EXTERNAL MODULE: ./elements/src/lib/avatar/avatar.component.ts + 1 modules\nvar avatar_component = __webpack_require__(\"a/j4\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/progress-bar.js\nvar progress_bar = __webpack_require__(\"BTe0\");\n\n// EXTERNAL MODULE: ./emoji/src/lib/text/emoji-text.component.ts\nvar emoji_text_component = __webpack_require__(\"xS4v\");\n\n// EXTERNAL MODULE: ./elements/src/lib/dialog/dialog.component.ts\nvar dialog_component = __webpack_require__(\"7/R1\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/dialog.js\nvar fesm2015_dialog = __webpack_require__(\"iELJ\");\n\n// EXTERNAL MODULE: ./readme/src/lib/readme.component.ts\nvar readme_component = __webpack_require__(\"n8oj\");\n\n// EXTERNAL MODULE: ./pipes/src/lib/moment/moment.pipe.ts\nvar moment_pipe = __webpack_require__(\"cpjW\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/conversation/conversation.component.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction Conversation_div_2_ng_template_19_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Rb\" /* ɵɵelement */](0, \"mat-progress-bar\", 11);\n    }\n}\nfunction Conversation_div_2_div_21_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r9 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"div\", 12);\n        core[\"Rb\" /* ɵɵelement */](1, \"div\", 13);\n        core[\"jc\" /* ɵɵpipe */](2, \"async\");\n        core[\"jc\" /* ɵɵpipe */](3, \"async\");\n        core[\"jc\" /* ɵɵpipe */](4, \"async\");\n        core[\"Wb\" /* ɵɵelementStart */](5, \"mat-icon\", 14);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function Conversation_div_2_div_21_Template_mat_icon_click_5_listener($event) { return $event.stopPropagation(); });\n        core[\"Ic\" /* ɵɵtext */](6, \"expand_more\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](7, \"mat-menu\", null, 15);\n        core[\"Wb\" /* ɵɵelementStart */](9, \"button\", 16);\n        core[\"jc\" /* ɵɵpipe */](10, \"async\");\n        core[\"Ic\" /* ɵɵtext */](11);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](12, \"button\", 17);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function Conversation_div_2_div_21_Template_button_click_12_listener() { core[\"yc\" /* ɵɵrestoreView */](_r9); const _r6 = core[\"vc\" /* ɵɵreference */](15); return _r6.open(); });\n        core[\"Ic\" /* ɵɵtext */](13);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](14, \"wm-dialog\", 18, 19);\n        core[\"ec\" /* ɵɵlistener */](\"closedChange\", function Conversation_div_2_div_21_Template_wm_dialog_closedChange_14_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r9); const ctx_r10 = core[\"ic\" /* ɵɵnextContext */](2); return $event && ctx_r10.delete(); });\n        core[\"Wb\" /* ɵɵelementStart */](16, \"h2\", 20);\n        core[\"Wb\" /* ɵɵelementStart */](17, \"b\");\n        core[\"Ic\" /* ɵɵtext */](18);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](19, \"mat-dialog-content\", 21);\n        core[\"Ic\" /* ɵɵtext */](20, \" You're about to \");\n        core[\"Wb\" /* ɵɵelementStart */](21, \"b\");\n        core[\"Ic\" /* ɵɵtext */](22, \"delete\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Ic\" /* ɵɵtext */](23, \" this conversation.\");\n        core[\"Rb\" /* ɵɵelement */](24, \"br\");\n        core[\"Ic\" /* ɵɵtext */](25, \"Are you sure? \");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](26, \"mat-dialog-actions\", 22);\n        core[\"Wb\" /* ɵɵelementStart */](27, \"button\", 23);\n        core[\"Ic\" /* ɵɵtext */](28);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](29, \"button\", 24);\n        core[\"Ic\" /* ɵɵtext */](30);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const _r5 = core[\"vc\" /* ɵɵreference */](8);\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r4 = core[\"ic\" /* ɵɵnextContext */]();\n        let tmp_2_0 = null;\n        let tmp_4_0 = null;\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"Ib\" /* ɵɵclassProp */](\"unread\", ctx_r4.showUnread && core[\"kc\" /* ɵɵpipeBind1 */](2, 15, ctx_r4.unread$) > 0)(\"skeleton-loading\", !core[\"kc\" /* ɵɵpipeBind1 */](3, 17, ctx_r4.sender$));\n        core[\"pc\" /* ɵɵproperty */](\"wm-emoji-text\", (tmp_2_0 = core[\"kc\" /* ɵɵpipeBind1 */](4, 19, ctx_r4.last$)) == null ? null : tmp_2_0.body);\n        core[\"Db\" /* ɵɵadvance */](4);\n        core[\"pc\" /* ɵɵproperty */](\"matMenuTriggerFor\", _r5);\n        core[\"Db\" /* ɵɵadvance */](4);\n        core[\"qc\" /* ɵɵpropertyInterpolate1 */](\"routerLink\", \"/@\", (tmp_4_0 = core[\"kc\" /* ɵɵpipeBind1 */](10, 21, ctx_r4.sender$)) == null ? null : tmp_4_0.userName, \"\");\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.info == null ? null : msgs_r1.info.label) || \"Contact info\");\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.delete == null ? null : msgs_r1.delete.label) || \"Delete chat\");\n        core[\"Db\" /* ɵɵadvance */](5);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.confirmDelete == null ? null : msgs_r1.confirmDelete.title) || \"Deleting chat\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"wm-readme\", msgs_r1.confirmDelete == null ? null : msgs_r1.confirmDelete.message);\n        core[\"Db\" /* ɵɵadvance */](8);\n        core[\"pc\" /* ɵɵproperty */](\"mat-dialog-close\", false);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.confirmDelete == null ? null : msgs_r1.confirmDelete.cancel) || \"Abort\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"mat-dialog-close\", true);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.confirmDelete == null ? null : msgs_r1.confirmDelete.ok) || \"Proceed\");\n    }\n}\nconst conversation_component_c0 = function () { return { sameDay: \"LT\", lastDay: \"[Yesterday]\", lastWeek: \"dddd\", sameElse: \"L\" }; };\nfunction Conversation_div_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Wb\" /* ɵɵelementStart */](0, \"div\", 2);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"div\", 3);\n        core[\"jc\" /* ɵɵpipe */](2, \"async\");\n        core[\"jc\" /* ɵɵpipe */](3, \"async\");\n        core[\"Rb\" /* ɵɵelement */](4, \"wm-avatar\", 4);\n        core[\"jc\" /* ɵɵpipe */](5, \"async\");\n        core[\"jc\" /* ɵɵpipe */](6, \"async\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](7, \"div\", 5);\n        core[\"Wb\" /* ɵɵelementStart */](8, \"div\", 6);\n        core[\"Wb\" /* ɵɵelementStart */](9, \"div\", 7);\n        core[\"jc\" /* ɵɵpipe */](10, \"async\");\n        core[\"Ic\" /* ɵɵtext */](11);\n        core[\"jc\" /* ɵɵpipe */](12, \"async\");\n        core[\"jc\" /* ɵɵpipe */](13, \"async\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](14, \"time\", 8);\n        core[\"Ic\" /* ɵɵtext */](15);\n        core[\"jc\" /* ɵɵpipe */](16, \"calendar\");\n        core[\"jc\" /* ɵɵpipe */](17, \"updatedTime\");\n        core[\"jc\" /* ɵɵpipe */](18, \"async\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Gc\" /* ɵɵtemplate */](19, Conversation_div_2_ng_template_19_Template, 1, 0, \"ng-template\", null, 9, core[\"Hc\" /* ɵɵtemplateRefExtractor */]);\n        core[\"Gc\" /* ɵɵtemplate */](21, Conversation_div_2_div_21_Template, 31, 23, \"div\", 10);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = ctx.$implicit;\n        const _r2 = core[\"vc\" /* ɵɵreference */](20);\n        const ctx_r0 = core[\"ic\" /* ɵɵnextContext */]();\n        let tmp_3_0 = null;\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"matBadge\", ctx_r0.unreadCount(core[\"kc\" /* ɵɵpipeBind1 */](2, 11, ctx_r0.unread$)))(\"matBadgeHidden\", !ctx_r0.showUnread || core[\"kc\" /* ɵɵpipeBind1 */](3, 13, ctx_r0.unread$) <= 0);\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"Ib\" /* ɵɵclassProp */](\"skeleton-loading\", !core[\"kc\" /* ɵɵpipeBind1 */](5, 15, ctx_r0.sender$));\n        core[\"pc\" /* ɵɵproperty */](\"src\", (tmp_3_0 = core[\"kc\" /* ɵɵpipeBind1 */](6, 17, ctx_r0.sender$)) == null ? null : tmp_3_0.photo);\n        core[\"Db\" /* ɵɵadvance */](5);\n        core[\"Ib\" /* ɵɵclassProp */](\"skeleton-loading\", !core[\"kc\" /* ɵɵpipeBind1 */](10, 19, ctx_r0.sender$));\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */](core[\"kc\" /* ɵɵpipeBind1 */](12, 21, ctx_r0.sender$) ? core[\"kc\" /* ɵɵpipeBind1 */](13, 23, ctx_r0.sender$).fullName || msgs_r1.unknownUser || \"Unknown user\" : \"\");\n        core[\"Db\" /* ɵɵadvance */](4);\n        core[\"Jc\" /* ɵɵtextInterpolate */](core[\"lc\" /* ɵɵpipeBind2 */](16, 25, core[\"kc\" /* ɵɵpipeBind1 */](17, 28, core[\"kc\" /* ɵɵpipeBind1 */](18, 30, ctx_r0.last$) || ctx_r0.data), msgs_r1.timeFormat || core[\"rc\" /* ɵɵpureFunction0 */](32, conversation_component_c0)));\n        core[\"Db\" /* ɵɵadvance */](6);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", !ctx_r0.deleting)(\"ngIfElse\", _r2);\n    }\n}\nconst _c1 = function (a0) { return { with: a0 }; };\nlet conversation_component_Conversation = /*@__PURE__*/ (() => {\n    class Conversation extends database_document[\"b\" /* DatabaseDocument */] {\n        constructor(db, user) {\n            super(db);\n            this.user = user;\n            this._deleting = false;\n            this.deletingChange = new core[\"o\" /* EventEmitter */]();\n        }\n        /** The conversation id */\n        get id() { return this.data.id; }\n        /** The current user's id */\n        get me() { return this.user.uid; }\n        get deleting() { return this._deleting; }\n        /** Computes the unknown user id appending the conversation id */\n        get unknownUser() { return `unknown-${this.data.id || '0'}`; }\n        /** Returns the unread count label */\n        unreadCount(value) {\n            return value > 10 ? '10+' : value === null || value === void 0 ? void 0 : value.toString();\n        }\n        set content(conv) {\n            var _a;\n            // Skips useless changes\n            if (conv && conv.id === ((_a = this.ref) === null || _a === void 0 ? void 0 : _a.id)) {\n                return;\n            }\n            // Unwraps the document data from the snapshot\n            this.data = this.unwrap(conv);\n            // Streams new data as an observable\n            this.data$ = this.stream().pipe(Object(startWith[\"a\" /* startWith */])(this.data), Object(shareReplay[\"a\" /* shareReplay */])(1));\n            // The conversation's messages thread\n            this.thread$ = this.collection('messages');\n            // Assumes the sender being the first recipient differing from the current user\n            const senderId = this.data.recipients.find(id => id !== this.me) || 'unknown';\n            // Resolves the sender user profile falling back to an unknown userName including the conversation id\n            this.sender$ = this.user.fromUserId(senderId).pipe(Object(map[\"a\" /* map */])(data => data || { userName: this.unknownUser }));\n            // Resolves the last message in the thread\n            this.last$ = this.thread$.stream(qf => qf.orderBy('created').limitToLast(1)).pipe(\n            // Gets the last message\n            Object(map[\"a\" /* map */])(msgs => msgs[0]), \n            // Shares the same result to multiple subscribers\n            Object(shareReplay[\"a\" /* shareReplay */])(1));\n            // Resolves the unread messages count up to 10+ unread messages\n            this.unread$ = this.data$.pipe(\n            // Streams the conversation data getting the user's specific lastRead timestamp that will be used as a cursor\n            Object(map[\"a\" /* map */])(data => { var _a, _b; return (_b = (_a = data === null || data === void 0 ? void 0 : data.status) === null || _a === void 0 ? void 0 : _a[this.me]) === null || _b === void 0 ? void 0 : _b.lastRead; }), \n            // Filters unchanged values\n            Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])((x, y) => !!x && !!y && x.isEqual(y)), \n            // Streams the messages...\n            Object(switchMap[\"a\" /* switchMap */])(lastRead => this.thread$.pipe(\n            // Selects sender messages after the lastRead timestamp up to 11 messages\n            Object(operators[\"n\" /* where */])('sender', '==', senderId), Object(operators[\"g\" /* orderBy */])('created'), Object(operators[\"l\" /* startAfter */])(lastRead), Object(operators[\"e\" /* limit */])(11), Object(operators[\"m\" /* stream */])(this.db.zone), \n            // Turns the results lenght into the unread counter\n            Object(map[\"a\" /* map */])(msgs => msgs.length), \n            // Shares the same result to all subscribers\n            Object(shareReplay[\"a\" /* shareReplay */])(1))));\n        }\n        delete() {\n            // Notifies the beginning of the process.\n            this.deletingChange.emit(this._deleting = true);\n            // Starts by wiping messages in batches of 100\n            return this.thread$.wipe(qf => qf.where('sender', '==', this.me).limit(100)).then(count => {\n                console.log('Messages deleted', count);\n                // Atomically remove my id from the recipients array\n                return this.update({ recipients: this.db.arrayRemove(this.me) }).then(() => {\n                    // Attempts to delete the conversation within a transaction\n                    return this.db.transaction(trx => {\n                        // Gets the conversartion data first\n                        return trx.get(this.ref).then(data => {\n                            var _a;\n                            // Deletes the conversation whenever the recipients array is empty\n                            if (((_a = data === null || data === void 0 ? void 0 : data.recipients) === null || _a === void 0 ? void 0 : _a.length) <= 0) {\n                                trx.delete(this.ref);\n                            }\n                        });\n                    });\n                });\n                // At last, reports the deletion completed\n            }).then(() => this.deletingChange.emit(this._deleting = false));\n        }\n        onContextMenu() {\n            var _a;\n            // Opens the menu on contextmenu event  \n            (_a = this.menuTrigger) === null || _a === void 0 ? void 0 : _a.openMenu();\n            // Prevents default\n            return false;\n        }\n    }\n    Conversation.ɵfac = function Conversation_Factory(t) { return new (t || Conversation)(core[\"Qb\" /* ɵɵdirectiveInject */](database[\"b\" /* DatabaseService */]), core[\"Qb\" /* ɵɵdirectiveInject */](utils_user[\"b\" /* UserProfile */])); };\n    Conversation.ɵcmp = core[\"Kb\" /* ɵɵdefineComponent */]({ type: Conversation, selectors: [[\"wm-conversation\"]], viewQuery: function Conversation_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"Lc\" /* ɵɵviewQuery */](menu[\"d\" /* MatMenuTrigger */], 1);\n            }\n            if (rf & 2) {\n                let _t;\n                core[\"uc\" /* ɵɵqueryRefresh */](_t = core[\"fc\" /* ɵɵloadQuery */]()) && (ctx.menuTrigger = _t.first);\n            }\n        }, hostVars: 2, hostBindings: function Conversation_HostBindings(rf, ctx) {\n            if (rf & 1) {\n                core[\"ec\" /* ɵɵlistener */](\"contextmenu\", function Conversation_contextmenu_HostBindingHandler() { return ctx.onContextMenu(); });\n            }\n            if (rf & 2) {\n                core[\"Eb\" /* ɵɵattribute */](\"selected\", ctx.highlight)(\"color\", ctx.color);\n            }\n        }, inputs: { highlight: \"highlight\", color: \"color\", showUnread: \"showUnread\", content: \"content\" }, outputs: { deletingChange: \"deleting\" }, features: [core[\"Ab\" /* ɵɵInheritDefinitionFeature */]], decls: 3, vars: 6, consts: [[\"mat-button\", \"\", \"routerLink\", \".\", 3, \"queryParams\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"start center\", 4, \"wmContent\", \"wmContentSelect\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"start center\"], [\"fxFlex\", \"0 0 auto\", \"matBadgeSize\", \"small\", 3, \"matBadge\", \"matBadgeHidden\"], [\"color\", \"primary\", 3, \"src\"], [\"fxFlex\", \"1 1 auto\", \"fxLayout\", \"column\", \"fxLayoutAlign\", \"start stretch\", 1, \"content\"], [\"fxLayout\", \"row\", \"fxLayoutGap\", \"8px\"], [\"fxFlex\", \"1 1 auto\", 1, \"name\", \"mat-title\", \"text\"], [\"fxFlex\", \"0 0 auto\", 1, \"time\", \"mat-small\"], [\"deletingProgress\", \"\"], [\"fxLayout\", \"row\", 4, \"ngIf\", \"ngIfElse\"], [\"color\", \"primary\", \"mode\", \"indeterminate\", 1, \"mat-body\", 2, \"height\", \"1em\"], [\"fxLayout\", \"row\"], [\"fxFlex\", \"1 1 auto\", 1, \"last\", \"mat-body\", \"text\", 3, \"wm-emoji-text\"], [\"fxFlex\", \"0 0 auto\", 1, \"menu\", 3, \"matMenuTriggerFor\", \"click\"], [\"menu\", \"matMenu\"], [\"mat-menu-item\", \"\", 3, \"routerLink\"], [\"mat-menu-item\", \"\", 3, \"click\"], [3, \"closedChange\"], [\"confirmDelete\", \"\"], [\"mat-dialog-title\", \"\"], [3, \"wm-readme\"], [\"align\", \"end\"], [\"mat-button\", \"\", \"color\", \"primary\", \"cdkFocusInitial\", \"\", 3, \"mat-dialog-close\"], [\"mat-button\", \"\", \"color\", \"warn\", 3, \"mat-dialog-close\"]], template: function Conversation_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Wb\" /* ɵɵelementStart */](0, \"button\", 0);\n                core[\"jc\" /* ɵɵpipe */](1, \"async\");\n                core[\"Gc\" /* ɵɵtemplate */](2, Conversation_div_2_Template, 22, 33, \"div\", 1);\n                core[\"Vb\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                let tmp_0_0 = null;\n                core[\"pc\" /* ɵɵproperty */](\"queryParams\", core[\"sc\" /* ɵɵpureFunction1 */](4, _c1, (tmp_0_0 = core[\"kc\" /* ɵɵpipeBind1 */](1, 2, ctx.sender$)) == null ? null : tmp_0_0.userName));\n                core[\"Db\" /* ɵɵadvance */](2);\n                core[\"pc\" /* ɵɵproperty */](\"wmContentSelect\", \"chat.conversation\");\n            }\n        }, directives: [fesm2015_button[\"b\" /* MatButton */], fesm2015_router[\"h\" /* RouterLink */], content_directive[\"a\" /* ContentDirective */], flex[\"e\" /* DefaultLayoutDirective */], flex[\"d\" /* DefaultLayoutAlignDirective */], flex[\"b\" /* DefaultFlexDirective */], badge[\"a\" /* MatBadge */], avatar_component[\"a\" /* AvatarComponent */], flex[\"f\" /* DefaultLayoutGapDirective */], common[\"m\" /* NgIf */], progress_bar[\"a\" /* MatProgressBar */], emoji_text_component[\"a\" /* EmojiText */], icon[\"a\" /* MatIcon */], menu[\"d\" /* MatMenuTrigger */], menu[\"a\" /* MatMenu */], menu[\"b\" /* MatMenuItem */], dialog_component[\"a\" /* DialogComponent */], fesm2015_dialog[\"h\" /* MatDialogTitle */], fesm2015_dialog[\"e\" /* MatDialogContent */], readme_component[\"a\" /* ReadmeComponent */], fesm2015_dialog[\"c\" /* MatDialogActions */], fesm2015_dialog[\"d\" /* MatDialogClose */]], pipes: [common[\"b\" /* AsyncPipe */], moment_pipe[\"a\" /* CalendarPipe */], pipes_pipe_UpdatedTimePipe], styles: [\"[_nghost-%COMP%]{position:relative;display:block;width:100%}[_nghost-%COMP%]   .mat-button[_ngcontent-%COMP%]{width:100%;text-align:left;padding:8px 16px}[_nghost-%COMP%]   .wm-avatar[_ngcontent-%COMP%]{width:56px;height:56px;margin-right:6px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .last[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .unread[_ngcontent-%COMP%]{font-weight:600}[_nghost-%COMP%]   .menu[_ngcontent-%COMP%]{transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}\"] });\n    return Conversation;\n})();\n\n// EXTERNAL MODULE: ./emoji/src/lib/text/index.ts + 1 modules\nvar lib_text = __webpack_require__(\"WIkw\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/conversation/conversation.module.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nlet conversation_module_ConversationModule = /*@__PURE__*/ (() => {\n    class ConversationModule {\n    }\n    ConversationModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: ConversationModule });\n    ConversationModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function ConversationModule_Factory(t) { return new (t || ConversationModule)(); }, imports: [[\n                common[\"c\" /* CommonModule */],\n                fesm2015_router[\"k\" /* RouterModule */],\n                flex_layout[\"a\" /* FlexLayoutModule */],\n                badge[\"b\" /* MatBadgeModule */],\n                fesm2015_button[\"c\" /* MatButtonModule */],\n                icon[\"b\" /* MatIconModule */],\n                menu[\"c\" /* MatMenuModule */],\n                progress_bar[\"b\" /* MatProgressBarModule */],\n                lib_text[\"b\" /* EmojiTextModule */],\n                readme_src[\"a\" /* ReadmeModule */],\n                avatar[\"a\" /* AvatarModule */],\n                dialog[\"b\" /* DialogModule */],\n                src[\"c\" /* ContentModule */],\n                moment[\"a\" /* MomentPipesModule */],\n                pipes_module_PipesModule\n            ]] });\n    return ConversationModule;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/conversation/index.ts\n\n\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/takeWhile.js\nvar takeWhile = __webpack_require__(\"GJmQ\");\n\n// EXTERNAL MODULE: ./elements/src/lib/icon/icon.component.ts\nvar icon_component = __webpack_require__(\"h0Qx\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/message/message.component.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction Message_ng_container_0_div_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Wb\" /* ɵɵelementStart */](0, \"div\");\n        core[\"Wb\" /* ɵɵelementStart */](1, \"b\");\n        core[\"Ic\" /* ɵɵtext */](2);\n        core[\"jc\" /* ɵɵpipe */](3, \"async\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r2 = core[\"ic\" /* ɵɵnextContext */](2);\n        let tmp_0_0 = null;\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((tmp_0_0 = core[\"kc\" /* ɵɵpipeBind1 */](3, 1, ctx_r2.sender$)) == null ? null : tmp_0_0.fullName);\n    }\n}\nfunction Message_ng_container_0_span_5_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Wb\" /* ɵɵelementStart */](0, \"span\", 9);\n        core[\"Rb\" /* ɵɵelement */](1, \"wm-icon\", 10);\n        core[\"Wb\" /* ɵɵelementStart */](2, \"span\");\n        core[\"Ic\" /* ɵɵtext */](3);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"icon\", (msgs_r1.delete == null ? null : msgs_r1.delete.icon) || \"error_outline\");\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.delete == null ? null : msgs_r1.delete.message) || \"This message has been deleted\");\n    }\n}\nfunction Message_ng_container_0_ng_template_7_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Rb\" /* ɵɵelement */](0, \"span\", 11);\n    }\n    if (rf & 2) {\n        const ctx_r5 = core[\"ic\" /* ɵɵnextContext */](2);\n        core[\"pc\" /* ɵɵproperty */](\"wm-emoji-text\", ctx_r5.data == null ? null : ctx_r5.data.body);\n    }\n}\nfunction Message_ng_container_0_ng_container_14_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r10 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"mat-icon\", 12);\n        core[\"Ic\" /* ɵɵtext */](2, \"expand_more\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](3, \"mat-menu\", null, 13);\n        core[\"Wb\" /* ɵɵelementStart */](5, \"button\", 14);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function Message_ng_container_0_ng_container_14_Template_button_click_5_listener() { core[\"yc\" /* ɵɵrestoreView */](_r10); const ctx_r9 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r9.delete(); });\n        core[\"Ic\" /* ɵɵtext */](6);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const _r8 = core[\"vc\" /* ɵɵreference */](4);\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"matMenuTriggerFor\", _r8);\n        core[\"Db\" /* ɵɵadvance */](5);\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.delete == null ? null : msgs_r1.delete.label) || \"Delete message\");\n    }\n}\nfunction Message_ng_container_0_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"wm-balloon\", 1);\n        core[\"Wb\" /* ɵɵelementStart */](2, \"div\", 2);\n        core[\"Gc\" /* ɵɵtemplate */](3, Message_ng_container_0_div_3_Template, 4, 3, \"div\", 3);\n        core[\"Wb\" /* ɵɵelementStart */](4, \"div\", 4);\n        core[\"Gc\" /* ɵɵtemplate */](5, Message_ng_container_0_span_5_Template, 4, 2, \"span\", 5);\n        core[\"jc\" /* ɵɵpipe */](6, \"async\");\n        core[\"Gc\" /* ɵɵtemplate */](7, Message_ng_container_0_ng_template_7_Template, 1, 1, \"ng-template\", null, 6, core[\"Hc\" /* ɵɵtemplateRefExtractor */]);\n        core[\"Rb\" /* ɵɵelement */](9, \"span\", 7);\n        core[\"Wb\" /* ɵɵelementStart */](10, \"time\", 8);\n        core[\"Ic\" /* ɵɵtext */](11);\n        core[\"jc\" /* ɵɵpipe */](12, \"moment\");\n        core[\"jc\" /* ɵɵpipe */](13, \"timestamp\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Gc\" /* ɵɵtemplate */](14, Message_ng_container_0_ng_container_14_Template, 7, 2, \"ng-container\", 3);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = ctx.$implicit;\n        const _r4 = core[\"vc\" /* ɵɵreference */](8);\n        const ctx_r0 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"color\", (ctx_r0.data == null ? null : ctx_r0.data.sender) === ctx_r0.me ? \"accent\" : \"primary\")(\"side\", (ctx_r0.data == null ? null : ctx_r0.data.sender) === ctx_r0.me ? \"right\" : \"left\")(\"anchor\", (ctx_r0.data == null ? null : ctx_r0.data.sender) !== ctx_r0.thread ? \"start\" : \"\");\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", (ctx_r0.data == null ? null : ctx_r0.data.sender) !== ctx_r0.thread);\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", core[\"kc\" /* ɵɵpipeBind1 */](6, 8, ctx_r0.deleted$))(\"ngIfElse\", _r4);\n        core[\"Db\" /* ɵɵadvance */](6);\n        core[\"Jc\" /* ɵɵtextInterpolate */](core[\"lc\" /* ɵɵpipeBind2 */](12, 10, core[\"kc\" /* ɵɵpipeBind1 */](13, 13, ctx_r0.data == null ? null : ctx_r0.data.created), msgs_r1.timeFormat || \"LT\"));\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", (ctx_r0.data == null ? null : ctx_r0.data.sender) === ctx_r0.me);\n    }\n}\n/** Chat message component */\nlet message_component_Message = /*@__PURE__*/ (() => {\n    class Message extends database_document[\"b\" /* DatabaseDocument */] {\n        constructor(db, user) {\n            super(db);\n            this.user = user;\n            /** Emits the unwrapped message data */\n            this.dataChange = new core[\"o\" /* EventEmitter */]();\n        }\n        /** The conversation id */\n        get id() { return this.data.id; }\n        /** The current user's id */\n        get me() { return this.user.uid; }\n        /** Message snaphot */\n        set message(message) {\n            // Unwraps the snapshot\n            this.data = this.unwrap(message);\n            // Resolve the sender data\n            this.sender$ = this.user.fromUserId(this.data.sender);\n            // Creates an observable to monitor this document deletion across devices.\n            this.deleted$ = this.asObservable().pipe(\n            // Monitors the exists flag      \n            Object(map[\"a\" /* map */])(snap => !snap.exists), Object(startWith[\"a\" /* startWith */])(!message.exists), \n            // Filters for changes and completes when deleted\n            Object(takeWhile[\"a\" /* takeWhile */])(deleted => !deleted, true), Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])());\n            // Emits the data payload\n            this.dataChange.emit(this.data);\n        }\n        onContextMenu() {\n            var _a;\n            // Opens the menu on contextmenu event  \n            (_a = this.menuTrigger) === null || _a === void 0 ? void 0 : _a.openMenu();\n            // Prevents default\n            return false;\n        }\n    }\n    Message.ɵfac = function Message_Factory(t) { return new (t || Message)(core[\"Qb\" /* ɵɵdirectiveInject */](database[\"b\" /* DatabaseService */]), core[\"Qb\" /* ɵɵdirectiveInject */](utils_user[\"b\" /* UserProfile */])); };\n    Message.ɵcmp = core[\"Kb\" /* ɵɵdefineComponent */]({ type: Message, selectors: [[\"wm-message\"]], viewQuery: function Message_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"Lc\" /* ɵɵviewQuery */](menu[\"d\" /* MatMenuTrigger */], 1);\n            }\n            if (rf & 2) {\n                let _t;\n                core[\"uc\" /* ɵɵqueryRefresh */](_t = core[\"fc\" /* ɵɵloadQuery */]()) && (ctx.menuTrigger = _t.first);\n            }\n        }, hostAttrs: [1, \"wm-message\"], hostVars: 4, hostBindings: function Message_HostBindings(rf, ctx) {\n            if (rf & 1) {\n                core[\"ec\" /* ɵɵlistener */](\"contextmenu\", function Message_contextmenu_HostBindingHandler() { return ctx.onContextMenu(); });\n            }\n            if (rf & 2) {\n                core[\"Ib\" /* ɵɵclassProp */](\"in\", (ctx.data == null ? null : ctx.data.sender) !== ctx.me)(\"out\", (ctx.data == null ? null : ctx.data.sender) === ctx.me);\n            }\n        }, inputs: { thread: \"thread\", message: \"message\" }, outputs: { dataChange: \"data\" }, features: [core[\"Ab\" /* ɵɵInheritDefinitionFeature */]], decls: 1, vars: 1, consts: [[4, \"wmContent\", \"wmContentSelect\"], [1, \"mat-elevation-z2\", 3, \"color\", \"side\", \"anchor\"], [\"fxLayout\", \"column\", \"fxLayoutAlign\", \"start stretch\", \"fxLayoutGap\", \"2px\"], [4, \"ngIf\"], [\"fxLayout\", \"row\"], [\"class\", \"deleted\", 4, \"ngIf\", \"ngIfElse\"], [\"messageBody\", \"\"], [1, \"spacer\"], [1, \"time\", \"mat-small\"], [1, \"deleted\"], [3, \"icon\"], [3, \"wm-emoji-text\"], [1, \"menu\", 3, \"matMenuTriggerFor\"], [\"menu\", \"matMenu\"], [\"mat-menu-item\", \"\", 3, \"click\"]], template: function Message_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Gc\" /* ɵɵtemplate */](0, Message_ng_container_0_Template, 15, 15, \"ng-container\", 0);\n            }\n            if (rf & 2) {\n                core[\"pc\" /* ɵɵproperty */](\"wmContentSelect\", \"chat.message\");\n            }\n        }, directives: [content_directive[\"a\" /* ContentDirective */], balloon_component_BalloonComponent, flex[\"e\" /* DefaultLayoutDirective */], flex[\"d\" /* DefaultLayoutAlignDirective */], flex[\"f\" /* DefaultLayoutGapDirective */], common[\"m\" /* NgIf */], icon_component[\"a\" /* IconComponent */], emoji_text_component[\"a\" /* EmojiText */], icon[\"a\" /* MatIcon */], menu[\"d\" /* MatMenuTrigger */], menu[\"a\" /* MatMenu */], menu[\"b\" /* MatMenuItem */]], pipes: [common[\"b\" /* AsyncPipe */], moment_pipe[\"c\" /* MomentPipe */], pipes_pipe_TimestampPipe], styles: [\"[_nghost-%COMP%]{position:relative;display:flex;flex-flow:row;padding:0 2vw}.in[_nghost-%COMP%]{justify-content:flex-start}.out[_nghost-%COMP%]{justify-content:flex-end}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .deleted[_ngcontent-%COMP%]{opacity:.5;font-style:italic}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{display:inline-block;width:48px}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{position:absolute;right:5px;bottom:0;opacity:.5}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{position:absolute;right:5px;top:0;background-color:inherit;cursor:pointer;transform:translateX(100%);transition:transform .1s ease-in-out}[_nghost-%COMP%]   .wm-balloon[_ngcontent-%COMP%]:hover   .menu[_ngcontent-%COMP%]{transform:translateX(0)}\"] });\n    return Message;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/message/message.module.ts\n\n\n\n\n\n\n\n\n\n\n\nlet message_module_MessageModule = /*@__PURE__*/ (() => {\n    class MessageModule {\n    }\n    MessageModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: MessageModule });\n    MessageModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function MessageModule_Factory(t) { return new (t || MessageModule)(); }, imports: [[\n                common[\"c\" /* CommonModule */],\n                flex_layout[\"a\" /* FlexLayoutModule */],\n                icon[\"b\" /* MatIconModule */],\n                menu[\"c\" /* MatMenuModule */],\n                lib_text[\"b\" /* EmojiTextModule */],\n                lib_icon[\"a\" /* IconModule */],\n                balloon_module_BalloonModule,\n                moment[\"a\" /* MomentPipesModule */],\n                pipes_module_PipesModule,\n                src[\"c\" /* ContentModule */]\n            ]] });\n    return MessageModule;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/message/index.ts\n\n\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/expansion.js + 1 modules\nvar expansion = __webpack_require__(\"o4Yh\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/cdk/fesm2015/coercion.js\nvar coercion = __webpack_require__(\"8LU1\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/platform/index.ts + 5 modules\nvar platform = __webpack_require__(\"OWci\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/textarea/index.ts + 3 modules\nvar utils_textarea = __webpack_require__(\"0zyZ\");\n\n// EXTERNAL MODULE: ./emoji/src/lib/utils/index.ts + 2 modules\nvar lib_utils = __webpack_require__(\"eyIN\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/tooltip.js + 1 modules\nvar tooltip = __webpack_require__(\"ZFy/\");\n\n// EXTERNAL MODULE: ./emoji-keyboard/src/lib/emoji-keyboard.component.ts + 1 modules\nvar emoji_keyboard_component = __webpack_require__(\"0qK6\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/form-field.js\nvar form_field = __webpack_require__(\"Q2Ze\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/fesm2015/input.js\nvar input = __webpack_require__(\"e6WT\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/textarea/typein-adapter/typein-adapter.directive.ts\nvar typein_adapter_directive = __webpack_require__(\"nGdH\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/cdk/fesm2015/text-field.js\nvar text_field = __webpack_require__(\"8sFK\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/textarea/textarea-newline/textarea-newline.directive.ts\nvar textarea_newline_directive = __webpack_require__(\"gX7t\");\n\n// EXTERNAL MODULE: ./emoji/src/lib/input/emoji-input.component.ts\nvar emoji_input_component = __webpack_require__(\"H7fF\");\n\n// EXTERNAL MODULE: ./emoji/src/lib/material/emoji-material.directive.ts\nvar emoji_material_directive = __webpack_require__(\"XtK9\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/composer/composer.component.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction MessageComposer_ng_container_0_mat_form_field_2_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r6 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"mat-form-field\", 8);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"mat-label\");\n        core[\"Ic\" /* ɵɵtext */](2);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](3, \"textarea\", 9);\n        core[\"ec\" /* ɵɵlistener */](\"valueChange\", function MessageComposer_ng_container_0_mat_form_field_2_Template_textarea_valueChange_3_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r6); const ctx_r5 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r5.value = $event; });\n        core[\"Ic\" /* ɵɵtext */](4, \"      \");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](5, \"wm-icon\", 10);\n        core[\"ec\" /* ɵɵlistener */](\"mousedown\", function MessageComposer_ng_container_0_mat_form_field_2_Template_wm_icon_mousedown_5_listener() { core[\"yc\" /* ɵɵrestoreView */](_r6); const ctx_r7 = core[\"ic\" /* ɵɵnextContext */](2); return !ctx_r7.disabled && ctx_r7.toggleEmojiKeys(); });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r2 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */](msgs_r1.placeholder || \"Type a message\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"value\", ctx_r2.value)(\"newline\", ctx_r2.enterMode)(\"disabled\", ctx_r2.disabled);\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Ib\" /* ɵɵclassProp */](\"color-disabled\", ctx_r2.disabled);\n        core[\"pc\" /* ɵɵproperty */](\"icon\", (msgs_r1.emoji == null ? null : msgs_r1.emoji.icon) || \"insert_emoticon\")(\"matTooltip\", (msgs_r1.emoji == null ? null : msgs_r1.emoji.tooltip) || \"Insert an emoji\");\n    }\n}\nfunction MessageComposer_ng_container_0_ng_template_3_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r10 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"mat-form-field\", 8);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"mat-label\");\n        core[\"Ic\" /* ɵɵtext */](2);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](3, \"wm-emoji-input\", 11);\n        core[\"ec\" /* ɵɵlistener */](\"valueChange\", function MessageComposer_ng_container_0_ng_template_3_Template_wm_emoji_input_valueChange_3_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r10); const ctx_r9 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r9.value = $event; });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](4, \"wm-icon\", 10);\n        core[\"ec\" /* ɵɵlistener */](\"mousedown\", function MessageComposer_ng_container_0_ng_template_3_Template_wm_icon_mousedown_4_listener() { core[\"yc\" /* ɵɵrestoreView */](_r10); const ctx_r11 = core[\"ic\" /* ɵɵnextContext */](2); return !ctx_r11.disabled && ctx_r11.toggleEmojiKeys(); });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r4 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */](msgs_r1.placeholder || \"Type a message\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"value\", ctx_r4.value)(\"newline\", ctx_r4.enterMode)(\"disabled\", ctx_r4.disabled);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"Ib\" /* ɵɵclassProp */](\"color-disabled\", ctx_r4.disabled);\n        core[\"pc\" /* ɵɵproperty */](\"icon\", (msgs_r1.emoji == null ? null : msgs_r1.emoji.icon) || \"insert_emoticon\")(\"matTooltip\", (msgs_r1.emoji == null ? null : msgs_r1.emoji.tooltip) || \"Insert an emoji\");\n    }\n}\nfunction MessageComposer_ng_container_0_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r14 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"div\", 1);\n        core[\"ec\" /* ɵɵlistener */](\"keydown\", function MessageComposer_ng_container_0_Template_div_keydown_1_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r14); const ctx_r13 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r13.sendOnEnter($event); });\n        core[\"Gc\" /* ɵɵtemplate */](2, MessageComposer_ng_container_0_mat_form_field_2_Template, 6, 8, \"mat-form-field\", 2);\n        core[\"Gc\" /* ɵɵtemplate */](3, MessageComposer_ng_container_0_ng_template_3_Template, 5, 8, \"ng-template\", null, 3, core[\"Hc\" /* ɵɵtemplateRefExtractor */]);\n        core[\"Wb\" /* ɵɵelementStart */](5, \"button\", 4);\n        core[\"ec\" /* ɵɵlistener */](\"mousedown\", function MessageComposer_ng_container_0_Template_button_mousedown_5_listener() { core[\"yc\" /* ɵɵrestoreView */](_r14); const ctx_r15 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r15.sendNow(); });\n        core[\"Rb\" /* ɵɵelement */](6, \"wm-icon\", 5);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](7, \"mat-expansion-panel\", 6);\n        core[\"ec\" /* ɵɵlistener */](\"afterExpand\", function MessageComposer_ng_container_0_Template_mat_expansion_panel_afterExpand_7_listener() { core[\"yc\" /* ɵɵrestoreView */](_r14); const ctx_r16 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r16.expanded.emit(); });\n        core[\"Wb\" /* ɵɵelementStart */](8, \"wm-emoji-keyboard\", 7);\n        core[\"ec\" /* ɵɵlistener */](\"keyPressed\", function MessageComposer_ng_container_0_Template_wm_emoji_keyboard_keyPressed_8_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r14); const ctx_r17 = core[\"ic\" /* ɵɵnextContext */](); return !ctx_r17.disabled && ctx_r17.typein($event); });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = ctx.$implicit;\n        const _r3 = core[\"vc\" /* ɵɵreference */](4);\n        const ctx_r0 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.mode === \"native\")(\"ngIfElse\", _r3);\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"pc\" /* ɵɵproperty */](\"disabled\", ctx_r0.disabled || !ctx_r0.valid);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"icon\", (msgs_r1.send == null ? null : msgs_r1.send.icon) || \"send\")(\"matTooltip\", (msgs_r1.send == null ? null : msgs_r1.send.tooltip) || \"Send\");\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"pc\" /* ɵɵproperty */](\"favorites\", ctx_r0.keys)(\"mode\", ctx_r0.mode);\n    }\n}\nlet composer_component_MessageComposer = /*@__PURE__*/ (() => {\n    class MessageComposer {\n        constructor(utils, touch) {\n            this.utils = utils;\n            this.touch = touch;\n            this._disabled = false;\n            /** Value changes event */\n            this.valueChange = new core[\"o\" /* EventEmitter */]();\n            /** Keyboard expanded event */\n            this.expanded = new core[\"o\" /* EventEmitter */]();\n            /** Send message event */\n            this.send = new core[\"o\" /* EventEmitter */]();\n        }\n        /** Input value */\n        set value(value) { this.valueChange.emit(this._value = value); }\n        get value() { return this._value; }\n        /** Disables the composer */\n        set disabled(value) {\n            var _a;\n            if (this._disabled = Object(coercion[\"c\" /* coerceBooleanProperty */])(value)) {\n                // Force the panel closing when disabled\n                (_a = this.emojiKeysPanel) === null || _a === void 0 ? void 0 : _a.close();\n            }\n        }\n        get disabled() { return this._disabled; }\n        /** Types in the input the specified key */\n        typein(key) {\n            var _a;\n            // Uses the TypeInAdapter to insert the key at the current cursr position preventing default to avoid losing focus\n            return (_a = this.typeinAdapter) === null || _a === void 0 ? void 0 : _a.typein(key), false;\n        }\n        /** Toggles emoji keyboard on/off */\n        toggleEmojiKeys() {\n            // Prevents default to avoid loosing focus (mousedown)\n            return this.emojiKeysPanel.toggle(), false;\n        }\n        /** Returns the globally used emoji mode */\n        get mode() {\n            // Use the very same emoji mode from EmojiSupportModule\n            return this.utils.emojiMode();\n        }\n        /** Selectes how inputs respond to 'Enter' key. */\n        get enterMode() {\n            // Always insert a newline when running on touch enabled devices.\n            // Require the 'Shift' key otherwise.\n            return this.touch ? 'always' : 'shift';\n        }\n        /** Sends the message on 'Enter' */\n        sendOnEnter(ev) {\n            // Sends on 'Enter' only on non-touch enabled devices\n            return (this.touch || ev.shiftKey || ev.key !== 'Enter') || this.sendNow();\n        }\n        get valid() {\n            return (this.value || '').match(/^\\s*$/) === null;\n        }\n        /** Sends the message emitting the relevant event */\n        sendNow() {\n            this.valid && this.send.emit(this.value);\n            return false;\n        }\n    }\n    MessageComposer.ɵfac = function MessageComposer_Factory(t) { return new (t || MessageComposer)(core[\"Qb\" /* ɵɵdirectiveInject */](lib_utils[\"c\" /* EmojiUtils */]), core[\"Qb\" /* ɵɵdirectiveInject */](platform[\"b\" /* HasTouchScreen */])); };\n    MessageComposer.ɵcmp = core[\"Kb\" /* ɵɵdefineComponent */]({ type: MessageComposer, selectors: [[\"wm-composer\"]], viewQuery: function MessageComposer_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"Lc\" /* ɵɵviewQuery */](expansion[\"c\" /* MatExpansionPanel */], 1);\n                core[\"Lc\" /* ɵɵviewQuery */](utils_textarea[\"b\" /* TypeinAdapter */], 1);\n            }\n            if (rf & 2) {\n                let _t;\n                core[\"uc\" /* ɵɵqueryRefresh */](_t = core[\"fc\" /* ɵɵloadQuery */]()) && (ctx.emojiKeysPanel = _t.first);\n                core[\"uc\" /* ɵɵqueryRefresh */](_t = core[\"fc\" /* ɵɵloadQuery */]()) && (ctx.typeinAdapter = _t.first);\n            }\n        }, hostAttrs: [1, \"wm-composer\"], inputs: { value: \"value\", keys: \"keys\", disabled: \"disabled\" }, outputs: { valueChange: \"valueChange\", expanded: \"expanded\", send: \"send\" }, decls: 1, vars: 1, consts: [[4, \"wmContent\", \"wmContentSelect\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"center end\", 1, \"input\", 3, \"keydown\"], [\"appearance\", \"legacy\", \"fxFlex\", \"1 1 auto\", 4, \"ngIf\", \"ngIfElse\"], [\"webMode\", \"\"], [\"mat-icon-button\", \"\", 3, \"disabled\", \"mousedown\"], [3, \"icon\", \"matTooltip\"], [\"hideToggle\", \"\", 1, \"padding-0\", \"mat-elevation-z0\", 3, \"afterExpand\"], [3, \"favorites\", \"mode\", \"keyPressed\"], [\"appearance\", \"legacy\", \"fxFlex\", \"1 1 auto\"], [\"matInput\", \"\", \"typein\", \"\", \"cdkTextareaAutosize\", \"\", \"cdkAutosizeMinRows\", \"1\", 3, \"value\", \"newline\", \"disabled\", \"valueChange\"], [\"inline\", \"\", \"matSuffix\", \"\", 1, \"tools\", 3, \"icon\", \"matTooltip\", \"mousedown\"], [\"matEmoji\", \"\", \"typein\", \"\", 3, \"value\", \"newline\", \"disabled\", \"valueChange\"]], template: function MessageComposer_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Gc\" /* ɵɵtemplate */](0, MessageComposer_ng_container_0_Template, 9, 7, \"ng-container\", 0);\n            }\n            if (rf & 2) {\n                core[\"pc\" /* ɵɵproperty */](\"wmContentSelect\", \"chat.composer\");\n            }\n        }, directives: [content_directive[\"a\" /* ContentDirective */], flex[\"e\" /* DefaultLayoutDirective */], flex[\"d\" /* DefaultLayoutAlignDirective */], common[\"m\" /* NgIf */], fesm2015_button[\"b\" /* MatButton */], icon_component[\"a\" /* IconComponent */], tooltip[\"b\" /* MatTooltip */], expansion[\"c\" /* MatExpansionPanel */], emoji_keyboard_component[\"a\" /* EmojiKeyboardComponent */], form_field[\"c\" /* MatFormField */], flex[\"b\" /* DefaultFlexDirective */], form_field[\"g\" /* MatLabel */], input[\"b\" /* MatInput */], typein_adapter_directive[\"a\" /* TypeinAdapter */], text_field[\"b\" /* CdkTextareaAutosize */], textarea_newline_directive[\"a\" /* TextareaNewline */], form_field[\"i\" /* MatSuffix */], emoji_input_component[\"a\" /* EmojiInput */], emoji_material_directive[\"a\" /* EmojiMaterial */]], styles: [\"[_nghost-%COMP%]{position:relative;display:flex;flex-flow:column;justify-content:center;align-items:stretch;box-sizing:border-box;margin-top:5px}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{margin:0 20px}[_nghost-%COMP%]   .wm-emoji-input[_ngcontent-%COMP%], [_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{word-break:break-all}[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{cursor:pointer;vertical-align:middle}[_nghost-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{margin-bottom:10px}\"] });\n    return MessageComposer;\n})();\n\n// EXTERNAL MODULE: ./emoji/src/lib/input/index.ts + 1 modules\nvar lib_input = __webpack_require__(\"UYqx\");\n\n// EXTERNAL MODULE: ./emoji/src/lib/material/index.ts + 1 modules\nvar material = __webpack_require__(\"KRLS\");\n\n// EXTERNAL MODULE: ./emoji-keyboard/src/index.ts + 1 modules\nvar emoji_keyboard_src = __webpack_require__(\"glvt\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/composer/composer.module.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nlet composer_module_ComposerModule = /*@__PURE__*/ (() => {\n    class ComposerModule {\n    }\n    ComposerModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: ComposerModule });\n    ComposerModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function ComposerModule_Factory(t) { return new (t || ComposerModule)(); }, imports: [[\n                common[\"c\" /* CommonModule */],\n                flex_layout[\"a\" /* FlexLayoutModule */],\n                fesm2015_button[\"c\" /* MatButtonModule */],\n                input[\"c\" /* MatInputModule */],\n                form_field[\"e\" /* MatFormFieldModule */],\n                expansion[\"b\" /* MatExpansionModule */],\n                tooltip[\"c\" /* MatTooltipModule */],\n                lib_input[\"b\" /* EmojiInputModule */],\n                material[\"a\" /* EmojiMaterialModule */],\n                emoji_keyboard_src[\"a\" /* EmojiKeyboardModule */],\n                src[\"c\" /* ContentModule */],\n                lib_icon[\"a\" /* IconModule */],\n                utils_textarea[\"a\" /* TextareaModule */]\n            ]] });\n    return ComposerModule;\n})();\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/composer/index.ts\n\n\n\n// EXTERNAL MODULE: ./connect/src/lib/database/collection/index.ts + 4 modules\nvar collection = __webpack_require__(\"lPMd\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/take.js\nvar take = __webpack_require__(\"IzEk\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/observable/of.js\nvar of = __webpack_require__(\"LRne\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/chat.service.ts\n\n\n\n\n\n\n\n\n\n\n\n/** Redirects to the latest conversation, if any */\nlet chat_service_ChatService = /*@__PURE__*/ (() => {\n    class ChatService extends collection[\"a\" /* DatabaseCollection */] {\n        constructor(db, user, router) {\n            super(db, 'conversations');\n            this.user = user;\n            this.router = router;\n        }\n        get me() { return this.user.uid; }\n        canActivate(route, state) {\n            var _a;\n            // Gets the requested recipient to chat to, if any\n            const userName = route.queryParamMap.get('with');\n            // Prevents starting up a conversation on wrong conditions\n            if (!this.user.auth.authenticated || userName == ((_a = this.user.data) === null || _a === void 0 ? void 0 : _a.userName)) {\n                return false;\n            }\n            // Initiate a conversation with the requested user\n            if (userName) {\n                // Skip unknown users. This may be a result of:\n                // 1. a deleted conversation (where the user has been removed from the recipients)\n                // 2. a conversation with a user that no longer exists\n                if (userName.startsWith('unknown-')) {\n                    return Object(of[\"a\" /* of */])(true);\n                }\n                // Resolves the user from the @username next\n                return this.user.fromUserName(userName).pipe(Object(take[\"a\" /* take */])(1), Object(switchMap[\"a\" /* switchMap */])(user => {\n                    // Prevents initiating a chat with non existing users or myself\n                    if (!user || user.id === this.me) {\n                        return Object(of[\"a\" /* of */])(false);\n                    }\n                    // Computes the path for the requested conversation\n                    const ref = this.ref.doc(this.me < user.id ? this.me.concat(user.id) : user.id.concat(this.me));\n                    // Uses an array union to fill in the recipients array atomically\n                    const recipients = this.db.arrayUnion(this.user.uid, user.id);\n                    // Runs a transaction to verify the converstion exists\n                    return this.db.transaction(trx => {\n                        // Read the conversation first\n                        return trx.snap(ref).then(({ exists }) => {\n                            // Ensures the recipients contains both sender and receiver.\n                            // This is needed since the exisiting conversarion may contain only one party (or none if we are in the middle of a deletion).\n                            // Using an array union with a merge ensure the array preserves the original values while the missing ones will be appended.\n                            if (exists) {\n                                trx.merge(ref, { recipients });\n                            }\n                            // ... or creates the conversatin from scratch\n                            else {\n                                trx.set(ref, { recipients });\n                            }\n                            // Returns true for the routing to proceed\n                            return true;\n                        });\n                    });\n                }));\n            }\n            // Resolves the last user we talked to otherwise...\n            return this.pipe(\n            // Gets the last conversation we updated\n            Object(operators[\"j\" /* query */])(qf => qf.where('recipients', 'array-contains', this.me).orderBy('updated', 'desc').limit(1)), Object(operators[\"d\" /* get */])(), \n            // Switches to the sender\n            Object(switchMap[\"a\" /* switchMap */])(snap => {\n                // Simply go throught when no conversation found\n                if (snap.empty) {\n                    return Object(of[\"a\" /* of */])(true);\n                }\n                // Gets the document data\n                const data = snap.docs[0].data();\n                // Seeks for the sender id among recipients\n                const sender = data.recipients.find(recipient => recipient != this.me);\n                // Resolves the user from the sender id. At this point the sender might be null as a result of a conversatrion\n                // partially deleted by the other party.\n                return this.user.fromUserId(sender).pipe(Object(take[\"a\" /* take */])(1), Object(map[\"a\" /* map */])(user => {\n                    // Gets the @username falling back to the unknown user when missing\n                    const userName = (user === null || user === void 0 ? void 0 : user.userName) || `unknown-${snap.docs[0].id}`;\n                    // Redirects to the very same route including the user name this time\n                    return this.router.createUrlTree(state.url.split('/'), {\n                        queryParams: {\n                            with: userName\n                        }\n                    });\n                }));\n            }));\n        }\n    }\n    ChatService.ɵfac = function ChatService_Factory(t) { return new (t || ChatService)(core[\"ac\" /* ɵɵinject */](database[\"b\" /* DatabaseService */]), core[\"ac\" /* ɵɵinject */](utils_user[\"b\" /* UserProfile */]), core[\"ac\" /* ɵɵinject */](fesm2015_router[\"g\" /* Router */])); };\n    ChatService.ɵprov = core[\"Mb\" /* ɵɵdefineInjectable */]({ token: ChatService, factory: ChatService.ɵfac, providedIn: 'root' });\n    return ChatService;\n})();\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/expand.js\nvar expand = __webpack_require__(\"FQpF\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/filter.js\nvar filter = __webpack_require__(\"pLZG\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/pluck.js\nvar pluck = __webpack_require__(\"wO+i\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/delay.js + 1 modules\nvar delay = __webpack_require__(\"3E0/\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/tap.js + 1 modules\nvar tap = __webpack_require__(\"vkgz\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/takeUntil.js\nvar takeUntil = __webpack_require__(\"1G5W\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/skip.js\nvar skip = __webpack_require__(\"zP0r\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/BehaviorSubject.js\nvar BehaviorSubject = __webpack_require__(\"2Vo4\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/observable/combineLatest.js\nvar combineLatest = __webpack_require__(\"itXk\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/scrolling/index.ts + 2 modules\nvar scrolling = __webpack_require__(\"DwbE\");\n\n// EXTERNAL MODULE: ./rxjs/src/index.ts + 6 modules\nvar rxjs_src = __webpack_require__(\"j8uH\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/animations/fesm2015/animations.js\nvar animations = __webpack_require__(\"GS7A\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/chat.animations.ts\n\nconst $timing = '450ms cubic-bezier(0.8, -0.5, 0.2, 1.5)';\nlet $animations = [\n    Object(animations[\"o\" /* trigger */])('pop', [\n        Object(animations[\"n\" /* transition */])(':enter', [\n            Object(animations[\"m\" /* style */])({ transform: 'scale(0.5)', opacity: 0 }),\n            Object(animations[\"e\" /* animate */])($timing, Object(animations[\"m\" /* style */])('*'))\n        ]),\n        Object(animations[\"n\" /* transition */])(':leave', Object(animations[\"e\" /* animate */])($timing, Object(animations[\"m\" /* style */])({ transform: 'scale(0.5)', opacity: 0 })))\n    ])\n];\n\n// EXTERNAL MODULE: ./gtag/src/lib/gtag.directive.ts\nvar gtag_directive = __webpack_require__(\"FkMH\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/actionbar/actionbar.directive.ts\nvar actionbar_directive = __webpack_require__(\"mx0f\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/fab/fab.directive.ts\nvar fab_directive = __webpack_require__(\"glcp\");\n\n// EXTERNAL MODULE: ./elements/src/lib/button/button-media-changer.directive.ts\nvar button_media_changer_directive = __webpack_require__(\"U3RD\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/navigator/sidenav/sidenav.directive.ts\nvar sidenav_directive = __webpack_require__(\"++Qg\");\n\n// EXTERNAL MODULE: ./wizdm/src/app/utils/can-leave/can-leave.directive.ts\nvar can_leave_directive = __webpack_require__(\"q9NA\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/chat.component.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction ChatComponent_ng_container_0_ng_template_1_wm_icon_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Rb\" /* ɵɵelement */](0, \"wm-icon\", 13);\n    }\n    if (rf & 2) {\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */](2).$implicit;\n        core[\"pc\" /* ɵɵproperty */](\"icon\", (msgs_r1.conversation == null ? null : msgs_r1.conversation.new == null ? null : msgs_r1.conversation.new.icon) || \"add_comment\");\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_ng_template_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ic\" /* ɵɵtext */](0);\n    }\n    if (rf & 2) {\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */](2).$implicit;\n        core[\"Jc\" /* ɵɵtextInterpolate */]((msgs_r1.conversation == null ? null : msgs_r1.conversation.new == null ? null : msgs_r1.conversation.new.caption) || \"New chat\");\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_wm_conversation_1_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r21 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"wm-conversation\", 16);\n        core[\"ec\" /* ɵɵlistener */](\"deleting\", function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_wm_conversation_1_Template_wm_conversation_deleting_0_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r21); const ctx_r20 = core[\"ic\" /* ɵɵnextContext */](6); return ctx_r20.onDeleting($event, ctx_r20.conv.id); })(\"click\", function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_wm_conversation_1_Template_wm_conversation_click_0_listener() { core[\"yc\" /* ɵɵrestoreView */](_r21); const ctx_r22 = core[\"ic\" /* ɵɵnextContext */](6); return ctx_r22.browse = !ctx_r22.browse; });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const activeConversation_r16 = core[\"ic\" /* ɵɵnextContext */](2).ngIf;\n        core[\"pc\" /* ɵɵproperty */](\"content\", activeConversation_r16);\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Gc\" /* ɵɵtemplate */](1, ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_wm_conversation_1_Template, 1, 1, \"wm-conversation\", 15);\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_wm_conversation_2_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r26 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"wm-conversation\", 17);\n        core[\"ec\" /* ɵɵlistener */](\"deleting\", function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_wm_conversation_2_Template_wm_conversation_deleting_0_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r26); const conv_r24 = ctx.$implicit; const ctx_r25 = core[\"ic\" /* ɵɵnextContext */](5); return ctx_r25.onDeleting($event, conv_r24.id); })(\"click\", function ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_wm_conversation_2_Template_wm_conversation_click_0_listener() { core[\"yc\" /* ɵɵrestoreView */](_r26); const mobile_r8 = core[\"ic\" /* ɵɵnextContext */](3).isMobile; const ctx_r27 = core[\"ic\" /* ɵɵnextContext */](2); return mobile_r8 && (ctx_r27.browse = !ctx_r27.browse); });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const conv_r24 = ctx.$implicit;\n        const activeConversation_r16 = core[\"ic\" /* ɵɵnextContext */]().ngIf;\n        core[\"pc\" /* ɵɵproperty */](\"content\", conv_r24)(\"highlight\", conv_r24.id === activeConversation_r16.id)(\"showUnread\", conv_r24.id !== activeConversation_r16.id);\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Gc\" /* ɵɵtemplate */](1, ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_ng_container_1_Template, 2, 0, \"ng-container\", 5);\n        core[\"Gc\" /* ɵɵtemplate */](2, ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_wm_conversation_2_Template, 1, 3, \"wm-conversation\", 14);\n        core[\"jc\" /* ɵɵpipe */](3, \"async\");\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const mobile_r8 = core[\"ic\" /* ɵɵnextContext */](2).isMobile;\n        const ctx_r15 = core[\"ic\" /* ɵɵnextContext */](2);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", mobile_r8);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"ngForOf\", core[\"kc\" /* ɵɵpipeBind1 */](3, 3, ctx_r15.conversations$))(\"ngForTrackBy\", ctx_r15.trackById);\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_ng_template_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Gc\" /* ɵɵtemplate */](0, ChatComponent_ng_container_0_ng_template_1_ng_template_4_ng_container_0_Template, 4, 5, \"ng-container\", 5);\n        core[\"jc\" /* ɵɵpipe */](1, \"async\");\n    }\n    if (rf & 2) {\n        const ctx_r12 = core[\"ic\" /* ɵɵnextContext */](3);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", core[\"kc\" /* ɵɵpipeBind1 */](1, 1, ctx_r12.activeConversation$));\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_1_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r32 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"button\", 9);\n        core[\"Gc\" /* ɵɵtemplate */](1, ChatComponent_ng_container_0_ng_template_1_wm_icon_1_Template, 1, 1, \"wm-icon\", 10);\n        core[\"Gc\" /* ɵɵtemplate */](2, ChatComponent_ng_container_0_ng_template_1_ng_template_2_Template, 1, 1, \"ng-template\", null, 11, core[\"Hc\" /* ɵɵtemplateRefExtractor */]);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Gc\" /* ɵɵtemplate */](4, ChatComponent_ng_container_0_ng_template_1_ng_template_4_Template, 2, 3, \"ng-template\", 12);\n        core[\"jc\" /* ɵɵpipe */](5, \"async\");\n        core[\"ec\" /* ɵɵlistener */](\"openedChange\", function ChatComponent_ng_container_0_ng_template_1_Template_ng_template_openedChange_4_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r32); const ctx_r31 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r31.browse = $event; });\n    }\n    if (rf & 2) {\n        const mobile_r8 = ctx.isMobile;\n        const _r10 = core[\"vc\" /* ɵɵreference */](3);\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r2 = core[\"ic\" /* ɵɵnextContext */]();\n        let tmp_3_0 = null;\n        core[\"pc\" /* ɵɵproperty */](\"routerLink\", (msgs_r1.conversation == null ? null : msgs_r1.conversation.new == null ? null : msgs_r1.conversation.new.link) || \"/explore/people\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", mobile_r8)(\"ngIfElse\", _r10);\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"pc\" /* ɵɵproperty */](\"opened\", ((tmp_3_0 = core[\"kc\" /* ɵɵpipeBind1 */](5, 4, ctx_r2.conversations$)) == null ? null : tmp_3_0.length) > 0 && (ctx_r2.browse || !mobile_r8));\n    }\n}\nfunction ChatComponent_ng_container_0_div_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Wb\" /* ɵɵelementStart */](0, \"div\", 18);\n        core[\"Rb\" /* ɵɵelement */](1, \"mat-spinner\", 19);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n}\nconst chat_component_c0 = function () { return { sameDay: \"[Today]\", lastDay: \"[Yesterday]\", lastWeek: \"dddd\", sameElse: \"L\" }; };\nfunction ChatComponent_ng_container_0_ng_container_4_ng_container_1_ng_container_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"wm-balloon\", 22);\n        core[\"Ic\" /* ɵɵtext */](2);\n        core[\"jc\" /* ɵɵpipe */](3, \"calendar\");\n        core[\"jc\" /* ɵɵpipe */](4, \"createdTime\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const msg_r36 = core[\"ic\" /* ɵɵnextContext */]().$implicit;\n        const msgs_r1 = core[\"ic\" /* ɵɵnextContext */](2).$implicit;\n        core[\"Db\" /* ɵɵadvance */](2);\n        core[\"Jc\" /* ɵɵtextInterpolate */](core[\"lc\" /* ɵɵpipeBind2 */](3, 1, core[\"kc\" /* ɵɵpipeBind1 */](4, 4, msg_r36), (msgs_r1.thread == null ? null : msgs_r1.thread.timeFormat) || core[\"rc\" /* ɵɵpureFunction0 */](6, chat_component_c0)));\n    }\n}\nfunction ChatComponent_ng_container_0_ng_container_4_ng_container_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Gc\" /* ɵɵtemplate */](1, ChatComponent_ng_container_0_ng_container_4_ng_container_1_ng_container_1_Template, 5, 7, \"ng-container\", 5);\n        core[\"jc\" /* ɵɵpipe */](2, \"moment\");\n        core[\"jc\" /* ɵɵpipe */](3, \"createdTime\");\n        core[\"jc\" /* ɵɵpipe */](4, \"moment\");\n        core[\"jc\" /* ɵɵpipe */](5, \"createdTime\");\n        core[\"Rb\" /* ɵɵelement */](6, \"wm-message\", 21);\n        core[\"jc\" /* ɵɵpipe */](7, \"snapshotData\");\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const msg_r36 = ctx.$implicit;\n        const i_r37 = ctx.index;\n        const messages_r34 = core[\"ic\" /* ɵɵnextContext */]().ngIf;\n        let tmp_1_0 = null;\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", i_r37 === 0 || core[\"lc\" /* ɵɵpipeBind2 */](2, 3, core[\"kc\" /* ɵɵpipeBind1 */](3, 6, messages_r34[i_r37 - 1]), \"D\") !== core[\"lc\" /* ɵɵpipeBind2 */](4, 8, core[\"kc\" /* ɵɵpipeBind1 */](5, 11, msg_r36), \"D\"));\n        core[\"Db\" /* ɵɵadvance */](5);\n        core[\"pc\" /* ɵɵproperty */](\"thread\", (tmp_1_0 = core[\"kc\" /* ɵɵpipeBind1 */](7, 13, messages_r34[i_r37 - 1])) == null ? null : tmp_1_0.sender)(\"message\", msg_r36);\n    }\n}\nfunction ChatComponent_ng_container_0_ng_container_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0);\n        core[\"Gc\" /* ɵɵtemplate */](1, ChatComponent_ng_container_0_ng_container_4_ng_container_1_Template, 8, 15, \"ng-container\", 20);\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const messages_r34 = ctx.ngIf;\n        const ctx_r4 = core[\"ic\" /* ɵɵnextContext */](2);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"ngForOf\", messages_r34)(\"ngForTrackBy\", ctx_r4.trackById);\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_6_button_0_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r44 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"button\", 24);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function ChatComponent_ng_container_0_ng_template_6_button_0_Template_button_click_0_listener() { core[\"yc\" /* ɵɵrestoreView */](_r44); const ctx_r43 = core[\"ic\" /* ɵɵnextContext */](3); return ctx_r43.scrollToBottom(); });\n        core[\"Wb\" /* ɵɵelementStart */](1, \"mat-icon\");\n        core[\"Ic\" /* ɵɵtext */](2, \"expand_more\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"pc\" /* ɵɵproperty */](\"@pop\", undefined);\n    }\n}\nfunction ChatComponent_ng_container_0_ng_template_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Gc\" /* ɵɵtemplate */](0, ChatComponent_ng_container_0_ng_template_6_button_0_Template, 3, 1, \"button\", 23);\n        core[\"jc\" /* ɵɵpipe */](1, \"async\");\n    }\n    if (rf & 2) {\n        const ctx_r5 = core[\"ic\" /* ɵɵnextContext */](2);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", core[\"kc\" /* ɵɵpipeBind1 */](1, 1, ctx_r5.scrolled$));\n    }\n}\nfunction ChatComponent_ng_container_0_wm_composer_7_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r46 = core[\"Xb\" /* ɵɵgetCurrentView */]();\n        core[\"Wb\" /* ɵɵelementStart */](0, \"wm-composer\", 25);\n        core[\"ec\" /* ɵɵlistener */](\"valueChange\", function ChatComponent_ng_container_0_wm_composer_7_Template_wm_composer_valueChange_0_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r46); const ctx_r45 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r45.text = $event; })(\"expanded\", function ChatComponent_ng_container_0_wm_composer_7_Template_wm_composer_expanded_0_listener() { core[\"yc\" /* ɵɵrestoreView */](_r46); const ctx_r47 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r47.onKeyboardExpand(); })(\"send\", function ChatComponent_ng_container_0_wm_composer_7_Template_wm_composer_send_0_listener($event) { core[\"yc\" /* ɵɵrestoreView */](_r46); const ctx_r48 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r48.send($event); });\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r6 = core[\"ic\" /* ɵɵnextContext */](2);\n        core[\"pc\" /* ɵɵproperty */](\"value\", ctx_r6.text)(\"keys\", ctx_r6.keys)(\"disabled\", !ctx_r6.recipient || ctx_r6.loading || ctx_r6.deleting);\n    }\n}\nfunction ChatComponent_ng_container_0_wm_dialog_8_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Wb\" /* ɵɵelementStart */](0, \"wm-dialog\", 26);\n        core[\"Wb\" /* ɵɵelementStart */](1, \"h2\", 27);\n        core[\"Wb\" /* ɵɵelementStart */](2, \"b\");\n        core[\"Ic\" /* ɵɵtext */](3);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](4, \"mat-dialog-content\", 28);\n        core[\"Ic\" /* ɵɵtext */](5, \" You're about to leave the page without sending the last message. \");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](6, \"mat-dialog-actions\", 29);\n        core[\"Wb\" /* ɵɵelementStart */](7, \"button\", 30);\n        core[\"Ic\" /* ɵɵtext */](8);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Wb\" /* ɵɵelementStart */](9, \"button\", 31);\n        core[\"Ic\" /* ɵɵtext */](10);\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Vb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const leave_r49 = ctx.ngIf;\n        const ctx_r7 = core[\"ic\" /* ɵɵnextContext */](2);\n        core[\"pc\" /* ɵɵproperty */](\"dontLeave\", !!ctx_r7.text);\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"Jc\" /* ɵɵtextInterpolate */](leave_r49.title || \"Unsent message\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"wm-readme\", leave_r49.message);\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"pc\" /* ɵɵproperty */](\"mat-dialog-close\", false);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"Jc\" /* ɵɵtextInterpolate */](leave_r49.cancel || \"Wait\");\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"mat-dialog-close\", true);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"Jc\" /* ɵɵtextInterpolate */](leave_r49.ok || \"Proceed\");\n    }\n}\nfunction ChatComponent_ng_container_0_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementContainerStart */](0, 1);\n        core[\"Gc\" /* ɵɵtemplate */](1, ChatComponent_ng_container_0_ng_template_1_Template, 6, 6, \"ng-template\", 2);\n        core[\"Wb\" /* ɵɵelementStart */](2, \"div\", 3);\n        core[\"Gc\" /* ɵɵtemplate */](3, ChatComponent_ng_container_0_div_3_Template, 2, 0, \"div\", 4);\n        core[\"Gc\" /* ɵɵtemplate */](4, ChatComponent_ng_container_0_ng_container_4_Template, 2, 2, \"ng-container\", 5);\n        core[\"jc\" /* ɵɵpipe */](5, \"async\");\n        core[\"Vb\" /* ɵɵelementEnd */]();\n        core[\"Gc\" /* ɵɵtemplate */](6, ChatComponent_ng_container_0_ng_template_6_Template, 2, 3, \"ng-template\", 6);\n        core[\"Gc\" /* ɵɵtemplate */](7, ChatComponent_ng_container_0_wm_composer_7_Template, 1, 3, \"wm-composer\", 7);\n        core[\"Gc\" /* ɵɵtemplate */](8, ChatComponent_ng_container_0_wm_dialog_8_Template, 11, 7, \"wm-dialog\", 8);\n        core[\"Tb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const msgs_r1 = ctx.$implicit;\n        const ctx_r0 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Db\" /* ɵɵadvance */](3);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.loading);\n        core[\"Db\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", core[\"kc\" /* ɵɵpipeBind1 */](5, 3, ctx_r0.messages$));\n        core[\"Db\" /* ɵɵadvance */](4);\n        core[\"pc\" /* ɵɵproperty */](\"ngIf\", msgs_r1.canLeave);\n    }\n}\nlet chat_component_ChatComponent = /*@__PURE__*/ (() => {\n    class ChatComponent extends collection[\"a\" /* DatabaseCollection */] {\n        constructor(db, route, router, scroller, user, regex, zone) {\n            super(db, 'conversations');\n            this.route = route;\n            this.router = router;\n            this.scroller = scroller;\n            this.user = user;\n            this.regex = regex;\n            this.zone = zone;\n            this.reload$ = new BehaviorSubject[\"a\" /* BehaviorSubject */](null);\n            this.loading = true;\n            this.browse = true;\n            this.deletingCount = 0;\n            this.autoScroll = true;\n            // Keys\n            this.stats = { \"😂\": 1, \"👋🏻\": 1, \"👍\": 1, \"💕\": 1, \"🙏\": 1 };\n            this.text = \"\";\n            this.recipient = '';\n            // Lists all my active conversations\n            this.conversations$ = this.reload$.pipe(Object(switchMap[\"a\" /* switchMap */])(() => this.pipe(\n            // Selects all the conversations where recipients[] contains my user's id\n            Object(operators[\"n\" /* where */])('recipients', 'array-contains', this.me), Object(operators[\"g\" /* orderBy */])('created', 'desc'), \n            // Combines existing conversations with new comers\n            source => source.pipe(\n            // Gets the list of existing conversations and sort them by updated value. \n            // Note: we set the cursor apart to avoid messing up with the following queries \n            // since the conversation array will be shuffled\n            Object(operators[\"k\" /* snap */])(), Object(map[\"a\" /* map */])(convs => ({ cursor: convs[0], convs: this.sortByUpdated(convs, 'desc') })), \n            // Appends new comers to the top of the list\n            Object(expand[\"a\" /* expand */])(({ cursor, convs }) => source.pipe(\n            // Filters out the existing conversation to minimize reads\n            Object(operators[\"c\" /* endBefore */])(cursor), \n            // Listens to new conversations\n            Object(operators[\"f\" /* onSnapshot */])(zone), \n            // Filters out unwanted emissions.\n            // Note: we exclude snapshots with pending writes to make sure timestamps are up to date\n            Object(filter[\"a\" /* filter */])(snap => snap.size > 0 && !snap.metadata.hasPendingWrites), \n            // Gets the new documents when available\n            Object(operators[\"b\" /* docs */])(), Object(take[\"a\" /* take */])(1), \n            // Prepends the new comers to the existing ones\n            Object(map[\"a\" /* map */])(latest => ({ cursor: latest[0], convs: latest.concat(convs) })))), \n            // Gets rid of the cursor\n            Object(pluck[\"a\" /* pluck */])('convs')), \n            // Replays to all subscribers\n            Object(shareReplay[\"a\" /* shareReplay */])(1))));\n            // Resolves the current conversation id from the query parameter\n            this.conversationId$ = route.queryParamMap.pipe(\n            // Extracts the @username from the route\n            Object(map[\"a\" /* map */])(params => params.get('with') || ''), Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])(), Object(delay[\"a\" /* delay */])(0), \n            // Resolves the user, if any\n            Object(switchMap[\"a\" /* switchMap */])(userName => {\n                // Catches an unknown user first. This may be a result of:\n                // 1. a deleted conversation (where the user has been removed from the recipients)\n                // 2. a conversation with a user that no longer exists\n                if (userName.startsWith('unknown-')) {\n                    // Resets the recipient\n                    this.recipient = '';\n                    // Returns the original conversation id\n                    return Object(of[\"a\" /* of */])(userName.replace(/^unknown-/, ''));\n                }\n                // Go on with a known user\n                return user.fromUserName(userName).pipe(Object(take[\"a\" /* take */])(1), Object(map[\"a\" /* map */])(user => {\n                    // Skips unexisting users\n                    if (!user) {\n                        return this.recipient = '';\n                    }\n                    // Tracks the new recipient id\n                    this.recipient = user.id;\n                    // Computes the path for the requested conversation otherwise\n                    return (this.me < user.id ? this.me.concat(user.id) : this.recipient.concat(this.me));\n                }));\n            }), \n            // Filters unchanged values and replays to all subscribers\n            Object(shareReplay[\"a\" /* shareReplay */])(1));\n            // Resolves the active conversation\n            this.activeConversation$ = Object(combineLatest[\"a\" /* combineLatest */])(this.conversations$, this.conversationId$).pipe(Object(map[\"a\" /* map */])(([convs, id]) => (convs === null || convs === void 0 ? void 0 : convs.find(conv => conv.id === id)) || {}));\n            // Paging observalbe to load the previous messages while scrolling up\n            const more$ = scroller.pipe(\n            // Triggers the previous page when approaching the top\n            Object(map[\"a\" /* map */])(scroll => scroll.top < 50), \n            // Filters for truthfull changes\n            Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])(), Object(filter[\"a\" /* filter */])(value => value), \n            // Asks for the next 20 messages\n            Object(map[\"a\" /* map */])(() => 20), \n            // Shows the loading spinner every page\n            Object(tap[\"a\" /* tap */])(() => this.loading = true));\n            // Streams up to page size messages from the selected conversation\n            this.messages$ = this.conversationId$.pipe(\n            // Stores the curernt conversation\n            Object(map[\"a\" /* map */])(id => this.conversation = id && this.document(id)), \n            // Gets the message thread\n            Object(map[\"a\" /* map */])(conv => this.thread = conv && conv.collection('messages')), \n            // Loads messages from the thread ordered by creation time\n            Object(switchMap[\"a\" /* switchMap */])(thread => thread ? thread.pipe(Object(operators[\"g\" /* orderBy */])('created'), \n            // Combines existing messages with new ones\n            source => source.pipe(\n            // Let's start by paging some existing messages\n            Object(operators[\"i\" /* pageReverse */])(more$), \n            // Perpare to append new coming messages\n            Object(expand[\"a\" /* expand */])(paged => source.pipe(\n            // Excludes existing messages\n            Object(operators[\"l\" /* startAfter */])(paged[paged.length - 1]), \n            // Listens for updates\n            Object(operators[\"f\" /* onSnapshot */])(this.db.zone), \n            // Filters out unwanted emissions\n            Object(filter[\"a\" /* filter */])(snap => snap.size > 0 && !snap.metadata.hasPendingWrites), \n            // Gets the new messages and completes\n            Object(operators[\"b\" /* docs */])(), Object(take[\"a\" /* take */])(1), \n            // Appends the new messages to the list\n            Object(map[\"a\" /* map */])(latest => paged.concat(latest)))), \n            // Always starts with an empty array to clear up messages when loading a new conversation\n            Object(startWith[\"a\" /* startWith */])([]))\n            // Reverts to an empty array when no conversation is selected\n            ) : Object(of[\"a\" /* of */])([])), \n            // When done loading....\n            Object(rxjs_src[\"f\" /* zoneStable */])(zone, () => {\n                // Scrolls for the last message to be visible  \n                this.autoScroll && this.scrollToBottom();\n                // Hides the loading spinner\n                this.loading = false;\n            }), \n            // Replays to all subscribers\n            Object(shareReplay[\"a\" /* shareReplay */])(1));\n            /** Builds an observable telling if the view has been scrolled */\n            this.scrolled$ = scroller.pipe(\n            // Measure the scrolling distance from the bottom \n            Object(map[\"a\" /* map */])(scroll => scroll.bottom >= 50), \n            // Distincts the value on changes only\n            Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])(), \n            // Enables/disables the autoScroll accordingly\n            Object(tap[\"a\" /* tap */])(scrolled => this.autoScroll = !scrolled), \n            // Run within angular zone\n            Object(rxjs_src[\"d\" /* runInZone */])(this.zone));\n        }\n        get deleting() { return this.deletingCount > 0; }\n        get me() { return this.user.uid; }\n        ngAfterViewInit() {\n            // Syncronizes the status saved withing the selected conversation keeping track of the \n            // last read message timestamp for unread counting purposes\n            this.sub = this.conversationId$.pipe(\n            // Gets the latest status value from the actiev conversation\n            Object(switchMap[\"a\" /* switchMap */])(id => this.fromId(id).pipe(Object(take[\"a\" /* take */])(1))), Object(map[\"a\" /* map */])(data => { var _a; return (_a = data === null || data === void 0 ? void 0 : data.status) === null || _a === void 0 ? void 0 : _a[this.me]; }), \n            // Loads the status from the active conversation\n            Object(tap[\"a\" /* tap */])(status => {\n                // Debug\n                console.log('Loading', status);\n                // Gets the emoji usage stats from the conversation\n                this.stats = (status === null || status === void 0 ? void 0 : status.favorites) || this.stats;\n                // Updates the favorites emoji based on the new stat\n                this.keys = this.sortFavorites(this.stats);\n            }), \n            // Expands on the last message\n            Object(expand[\"a\" /* expand */])(status => this.lastMessage().pipe(\n            // Stops saving new data when switching to another conversation\n            Object(takeUntil[\"a\" /* takeUntil */])(this.conversationId$.pipe(Object(skip[\"a\" /* skip */])(1))), \n            // Extracts the last message timestamp\n            Object(map[\"a\" /* map */])(msg => msg === null || msg === void 0 ? void 0 : msg.created), \n            // Ensures saving only updated data\n            Object(filter[\"a\" /* filter */])(created => !!created && (!(status === null || status === void 0 ? void 0 : status.lastRead) || (created > status.lastRead))), \n            // Saves the new data\n            Object(switchMap[\"a\" /* switchMap */])(lastRead => {\n                // Prepares a new status object saving the lastRead timestamp and the conversation favorites\n                const newStatus = { favorites: this.stats, lastRead };\n                // Debug\n                console.log('Saving data', newStatus);\n                // Saves the new data returning the new value for the next recursion\n                return this.conversation.merge({ status: { [this.me]: newStatus } })\n                    .then(() => newStatus);\n            }), \n            // Completes the emission\n            Object(take[\"a\" /* take */])(1)))).subscribe();\n        }\n        // Disposes of the subscriptions\n        ngOnDestroy() { this.sub.unsubscribe(); }\n        /** Returns the requested conversation observable provided the id falls among the active ones */\n        fromId(id) {\n            // Waits until the view has been rendered\n            return this.zone.onStable.pipe(Object(take[\"a\" /* take */])(1), \n            // Catch the QueryList changes\n            Object(switchMap[\"a\" /* switchMap */])(() => this.conversationsList.changes.pipe(Object(startWith[\"a\" /* startWith */])(null))), \n            // Seeks for the requested conversation\n            Object(map[\"a\" /* map */])(() => this.conversationsList.find(conv => conv.id === id)), \n            // Filters out unwanted emissions\n            Object(filter[\"a\" /* filter */])(conv => !!conv), Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])(undefined, conv => conv.id), \n            // Returns the child conversation's data observable\n            Object(switchMap[\"a\" /* switchMap */])(conv => conv.data$));\n        }\n        /** Returns the last message currently listed from the active conversation */\n        lastMessage() {\n            // Waits until the view has been rendered\n            return this.zone.onStable.pipe(Object(take[\"a\" /* take */])(1), \n            // Catch the QueryList changes\n            Object(switchMap[\"a\" /* switchMap */])(() => this.messagesList.changes.pipe(Object(startWith[\"a\" /* startWith */])(null))), \n            // Seeks for the requested message data\n            Object(map[\"a\" /* map */])(() => { var _a; return (_a = this.messagesList.last) === null || _a === void 0 ? void 0 : _a.data; }), \n            // Filters out duplicates\n            Object(distinctUntilChanged[\"a\" /* distinctUntilChanged */])());\n        }\n        /** Tracks the deletion of conversations */\n        onDeleting(flag, id) {\n            // Tracks how many conversations are in the proess of deleting\n            this.deletingCount = this.deletingCount + (flag ? 1 : -1);\n            // Once done...\n            if (this.deletingCount <= 0) {\n                // Resets the text\n                this.text = \"\";\n                // Reloads the page \n                this.reload();\n            }\n        }\n        /** Reloads the chat content */\n        reload() {\n            // Starts by navigating to this very same route without any queryParameter. \n            // This will update reset the conversationId and the message thread\n            return this.router.navigate(['.'], { relativeTo: this.route, replaceUrl: true })\n                // Reloads all the conversations from scratch next\n                .then(() => this.reload$.next());\n        }\n        /** Scrolls te view to the bottom to make the latest message visible */\n        scrollToBottom() {\n            this.scroller.scrollTo({ bottom: 0 });\n        }\n        /** Forces the view to scroll whenever the keyboard expanded */\n        onKeyboardExpand() {\n            // Scrolls to bottom wheneve the autoScroll mode is enabled\n            this.autoScroll && this.scrollToBottom();\n        }\n        /** Send the current message */\n        send(body) {\n            // Updates the key usage statistics\n            this.updateFavorites(body);\n            // Sends the message adding it to the current conversation thread\n            this.thread.add({ body, sender: this.me, recipient: this.recipient }).then(() => {\n                // Enables automatic scrolling\n                this.autoScroll = true;\n                // Resets the last message text\n                this.text = \"\";\n            });\n            // Prevents default\n            return false;\n        }\n        /** Sorts the favorite keys based on usage */\n        sortFavorites(stats) {\n            return Object.keys(stats).sort((a, b) => stats[b] - stats[a]);\n        }\n        /** Updates the favorite statistics upon the given message */\n        updateFavorites(body) {\n            let match;\n            let emojis = [];\n            while (match = this.regex.exec(body)) {\n                const key = match[0];\n                if (emojis.findIndex(emoji => emoji === key) < 0) {\n                    emojis.push(match[0]);\n                    this.stats[key] = (this.stats[key] || 0) + 1;\n                }\n            }\n            if (emojis.length > 0) {\n                this.keys = this.sortFavorites(this.stats);\n            }\n        }\n        /** ngFor tracking function */\n        trackById(data) {\n            return data.id;\n        }\n        /** Sort conversations based on their updated timestamp */\n        sortByUpdated(data, dir) {\n            const _dir = dir === 'desc' ? -1 : 1;\n            return data.sort((a, b) => {\n                const aDate = a === null || a === void 0 ? void 0 : a.data().updated;\n                if (!aDate) {\n                    return _dir;\n                }\n                const bDate = b === null || b === void 0 ? void 0 : b.data().updated;\n                if (!bDate) {\n                    return -_dir;\n                }\n                return bDate < aDate ? _dir : (bDate > aDate ? -_dir : 0);\n            });\n        }\n    }\n    ChatComponent.ɵfac = function ChatComponent_Factory(t) { return new (t || ChatComponent)(core[\"Qb\" /* ɵɵdirectiveInject */](database[\"b\" /* DatabaseService */]), core[\"Qb\" /* ɵɵdirectiveInject */](fesm2015_router[\"a\" /* ActivatedRoute */]), core[\"Qb\" /* ɵɵdirectiveInject */](fesm2015_router[\"g\" /* Router */]), core[\"Qb\" /* ɵɵdirectiveInject */](scrolling[\"a\" /* ScrollObservable */]), core[\"Qb\" /* ɵɵdirectiveInject */](utils_user[\"b\" /* UserProfile */]), core[\"Qb\" /* ɵɵdirectiveInject */](lib_utils[\"b\" /* EmojiRegex */]), core[\"Qb\" /* ɵɵdirectiveInject */](core[\"B\" /* NgZone */])); };\n    ChatComponent.ɵcmp = core[\"Kb\" /* ɵɵdefineComponent */]({ type: ChatComponent, selectors: [[\"wm-chat\"]], viewQuery: function ChatComponent_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"Lc\" /* ɵɵviewQuery */](conversation_component_Conversation, 1);\n                core[\"Lc\" /* ɵɵviewQuery */](message_component_Message, 1);\n            }\n            if (rf & 2) {\n                let _t;\n                core[\"uc\" /* ɵɵqueryRefresh */](_t = core[\"fc\" /* ɵɵloadQuery */]()) && (ctx.conversationsList = _t);\n                core[\"uc\" /* ɵɵqueryRefresh */](_t = core[\"fc\" /* ɵɵloadQuery */]()) && (ctx.messagesList = _t);\n            }\n        }, features: [core[\"Ab\" /* ɵɵInheritDefinitionFeature */]], decls: 1, vars: 1, consts: [[\"gtag\", \"chat\", 4, \"wmContent\", \"wmContentSelect\"], [\"gtag\", \"chat\"], [\"wmActionbar\", \"\"], [\"fxFlex\", \"100\", \"fxLayout\", \"column\", \"fxLayoutAlign\", \"end stretch\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"center\", 4, \"ngIf\"], [4, \"ngIf\"], [\"wmFab\", \"right bottom\"], [3, \"value\", \"keys\", \"disabled\", \"valueChange\", \"expanded\", \"send\", 4, \"wmFooter\"], [3, \"dontLeave\", 4, \"ngIf\"], [\"mat-stroked-button\", \"\", \"type.lt-sm\", \"icon\", \"color\", \"primary\", 3, \"routerLink\"], [3, \"icon\", 4, \"ngIf\", \"ngIfElse\"], [\"newMessage\", \"\"], [\"wmSidenav\", \"\", \"persist\", \"\", \"minWidth\", \"280px\", \"maxWidth\", \"350px\", 3, \"opened\", \"openedChange\"], [3, \"icon\"], [\"color\", \"primary\", 3, \"content\", \"highlight\", \"showUnread\", \"deleting\", \"click\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"content\", \"deleting\", \"click\", 4, \"wmToolbar\"], [3, \"content\", \"deleting\", \"click\"], [\"color\", \"primary\", 3, \"content\", \"highlight\", \"showUnread\", \"deleting\", \"click\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"center\"], [\"mode\", \"indeterminate\", \"diameter\", \"40\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"thread\", \"message\"], [\"fxFlexAlign\", \"center\", 1, \"group-label\", \"mat-elevation-z2\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", 3, \"click\", 4, \"ngIf\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", 3, \"click\"], [3, \"value\", \"keys\", \"disabled\", \"valueChange\", \"expanded\", \"send\"], [3, \"dontLeave\"], [\"mat-dialog-title\", \"\"], [3, \"wm-readme\"], [\"align\", \"end\"], [\"mat-button\", \"\", \"color\", \"warn\", \"cdkFocusInitial\", \"\", 3, \"mat-dialog-close\"], [\"mat-button\", \"\", \"color\", \"primary\", 3, \"mat-dialog-close\"]], template: function ChatComponent_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Gc\" /* ɵɵtemplate */](0, ChatComponent_ng_container_0_Template, 9, 5, \"ng-container\", 0);\n            }\n            if (rf & 2) {\n                core[\"pc\" /* ɵɵproperty */](\"wmContentSelect\", \"chat\");\n            }\n        }, directives: [content_directive[\"a\" /* ContentDirective */], gtag_directive[\"a\" /* GtagDirective */], actionbar_directive[\"a\" /* ActionbarDirective */], flex[\"b\" /* DefaultFlexDirective */], flex[\"e\" /* DefaultLayoutDirective */], flex[\"d\" /* DefaultLayoutAlignDirective */], common[\"m\" /* NgIf */], fab_directive[\"a\" /* FabDirective */], sticky_footer_directive_StickyFooterDirective, fesm2015_button[\"b\" /* MatButton */], button_media_changer_directive[\"a\" /* ButtonMediaChanger */], fesm2015_router[\"h\" /* RouterLink */], sidenav_directive[\"a\" /* SidenavDirective */], icon_component[\"a\" /* IconComponent */], common[\"l\" /* NgForOf */], toolbar_directive_ToolbarDirective, conversation_component_Conversation, progress_spinner[\"c\" /* MatSpinner */], message_component_Message, balloon_component_BalloonComponent, flex[\"a\" /* DefaultFlexAlignDirective */], icon[\"a\" /* MatIcon */], composer_component_MessageComposer, dialog_component[\"a\" /* DialogComponent */], can_leave_directive[\"a\" /* CanLeaveDirective */], fesm2015_dialog[\"h\" /* MatDialogTitle */], fesm2015_dialog[\"e\" /* MatDialogContent */], readme_component[\"a\" /* ReadmeComponent */], fesm2015_dialog[\"c\" /* MatDialogActions */], fesm2015_dialog[\"d\" /* MatDialogClose */]], pipes: [common[\"b\" /* AsyncPipe */], moment_pipe[\"c\" /* MomentPipe */], pipes_pipe_CreatedTimePipe, pipes_pipe_SnapshotDataPipe, moment_pipe[\"a\" /* CalendarPipe */]], styles: [\"[_nghost-%COMP%]{position:relative;min-height:100%;width:100%;padding:8px;display:flex;flex-direction:column;box-sizing:border-box}[_nghost-%COMP%]   .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%]{margin-top:12px}[_nghost-%COMP%]   .in[_ngcontent-%COMP%] + .in[_ngcontent-%COMP%], [_nghost-%COMP%]   .out[_ngcontent-%COMP%] + .out[_ngcontent-%COMP%]{margin-top:2px}[_nghost-%COMP%]   .group-label[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:auto}\"], data: { animation: $animations } });\n    return ChatComponent;\n})();\n\n// EXTERNAL MODULE: ./content/src/lib/router/content-router.module.ts\nvar content_router_module = __webpack_require__(\"J3Me\");\n\n// CONCATENATED MODULE: ./wizdm/src/app/pages/chat/chat.module.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst routes = [\n    {\n        path: '',\n        content: ['chat', 'emoji-keys'],\n        component: chat_component_ChatComponent,\n        canActivate: [auth_guard[\"a\" /* AuthGuard */], utils_user[\"c\" /* ValidProfile */], chat_service_ChatService], data: { authGuardPipe: auth_guard[\"d\" /* emailVerified */] },\n        canDeactivate: [can_leave[\"a\" /* CanLeaveGuard */]]\n    }\n];\nlet chat_module_ChatModule = /*@__PURE__*/ (() => {\n    class ChatModule {\n    }\n    ChatModule.ɵmod = core[\"Ob\" /* ɵɵdefineNgModule */]({ type: ChatModule });\n    ChatModule.ɵinj = core[\"Nb\" /* ɵɵdefineInjector */]({ factory: function ChatModule_Factory(t) { return new (t || ChatModule)(); }, imports: [[\n                common[\"c\" /* CommonModule */],\n                flex_layout[\"a\" /* FlexLayoutModule */],\n                icon[\"b\" /* MatIconModule */],\n                fesm2015_button[\"c\" /* MatButtonModule */],\n                list[\"e\" /* MatListModule */],\n                badge[\"b\" /* MatBadgeModule */],\n                divider[\"b\" /* MatDividerModule */],\n                progress_spinner[\"b\" /* MatProgressSpinnerModule */],\n                redirect_src[\"a\" /* RedirectModule */],\n                pipes_module_PipesModule,\n                gtag_src[\"a\" /* GtagModule */],\n                lib_icon[\"a\" /* IconModule */],\n                lib_button[\"a\" /* ButtonChangerModule */],\n                readme_src[\"a\" /* ReadmeModule */],\n                avatar[\"a\" /* AvatarModule */],\n                balloon_module_BalloonModule,\n                dialog[\"b\" /* DialogModule */],\n                teleport_src[\"a\" /* TeleportModule */],\n                actionbar[\"a\" /* ActionbarModule */],\n                sidenav[\"a\" /* SidenavModule */],\n                toolbar_module_ToolbarModule,\n                sticky_footer_module_StickyFooterModule,\n                fab[\"a\" /* FabModule */],\n                moment[\"a\" /* MomentPipesModule */],\n                can_leave[\"b\" /* CanLeaveModule */],\n                conversation_module_ConversationModule,\n                message_module_MessageModule,\n                composer_module_ComposerModule,\n                src[\"e\" /* ContentRouterModule */].forChild(routes)\n            ]] });\n    return ChatModule;\n})();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}