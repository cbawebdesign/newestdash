(function () {
  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

  function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  (window["webpackJsonp"] = window["webpackJsonp"] || []).push([["profile-fixer-profile-fixer-module"], {
    /***/
    "0DpH":
    /*!****************************************************************************!*\
      !*** ./wizdm/src/app/pages/admin/profile-fixer/profile-fixer.component.ts ***!
      \****************************************************************************/

    /*! exports provided: ProfileFixerComponent */

    /***/
    function DpH(module, __webpack_exports__, __webpack_require__) {
      "use strict";

      __webpack_require__.r(__webpack_exports__);
      /* harmony export (binding) */


      __webpack_require__.d(__webpack_exports__, "ProfileFixerComponent", function () {
        return ProfileFixerComponent;
      });
      /* harmony import */


      var rxjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(
      /*! rxjs */
      "qCKp");
      /* harmony import */


      var _wizdm_connect_storage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(
      /*! @wizdm/connect/storage */
      "tFpD");
      /* harmony import */


      var _wizdm_connect_functions_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(
      /*! @wizdm/connect/functions/client */
      "kSUX");
      /* harmony import */


      var app_utils_user__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(
      /*! app/utils/user */
      "lWmb");
      /* harmony import */


      var rxjs_operators__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(
      /*! rxjs/operators */
      "kU1M");
      /* harmony import */


      var _wizdm_rxjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(
      /*! @wizdm/rxjs */
      "j8uH");
      /* harmony import */


      var _angular_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(
      /*! @angular/core */
      "8Y7J");
      /* harmony import */


      var _content_src_lib_streamer_content_directive__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(
      /*! ../../../../../../content/src/lib/streamer/content.directive */
      "Qfjl");
      /* harmony import */


      var _angular_material_button__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(
      /*! @angular/material/button */
      "Dxy4");
      /* harmony import */


      var _elements_src_lib_icon_icon_component__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(
      /*! ../../../../../../elements/src/lib/icon/icon.component */
      "h0Qx");
      /* harmony import */


      var _angular_common__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(
      /*! @angular/common */
      "SVse");
      /* harmony import */


      var _elements_src_lib_dialog_dialog_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(
      /*! ../../../../../../elements/src/lib/dialog/dialog.component */
      "7/R1");
      /* harmony import */


      var _utils_can_leave_can_leave_directive__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(
      /*! ../../../utils/can-leave/can-leave.directive */
      "q9NA");
      /* harmony import */


      var _angular_material_dialog__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(
      /*! @angular/material/dialog */
      "iELJ");
      /* harmony import */


      var _readme_src_lib_readme_component__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(
      /*! ../../../../../../readme/src/lib/readme.component */
      "n8oj");
      /* harmony import */


      var _angular_material_progress_bar__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(
      /*! @angular/material/progress-bar */
      "BTe0");
      /* harmony import */


      var _navigator_actionbar_actionbar_directive__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(
      /*! ../../../navigator/actionbar/actionbar.directive */
      "mx0f");
      /* harmony import */


      var _elements_src_lib_button_button_media_changer_directive__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(
      /*! ../../../../../../elements/src/lib/button/button-media-changer.directive */
      "U3RD");
      /* harmony import */


      var _angular_flex_layout_flex__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(
      /*! @angular/flex-layout/flex */
      "VDRc");

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_wm_icon_1_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelement"](0, "wm-icon", 2);
        }

        if (rf & 2) {
          var msgs_r1 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](4).$implicit;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("icon", (msgs_r1.actions == null ? null : msgs_r1.actions.apply == null ? null : msgs_r1.actions.apply.icon) || "save");
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_ng_template_2_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](0);
        }

        if (rf & 2) {
          var msgs_r1 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](4).$implicit;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"]((msgs_r1.actions == null ? null : msgs_r1.actions.apply == null ? null : msgs_r1.actions.apply.caption) || "Apply fixes");
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_Template(rf, ctx) {
        if (rf & 1) {
          var _r17 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "button", 14);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_Template_button_click_0_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r17);

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2).ngIf;

            var ctx_r15 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r15.applyAllFixes(report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](1, ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_wm_icon_1_Template, 1, 1, "wm-icon", 15);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](2, ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_ng_template_2_Template, 1, 1, "ng-template", null, 16, _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplateRefExtractor"]);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var mobile_r9 = ctx.isMobile;

          var _r11 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵreference"](3);

          var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2).ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("disabled", !report_r3.done);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", mobile_r9)("ngIfElse", _r11);
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_1_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerStart"](0);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](1, ProfileFixerComponent_ng_container_0_section_5_ng_container_1_ng_template_1_Template, 4, 3, "ng-template", 13);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerEnd"]();
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_template_3_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "p");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](1, "Fetching user data...");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_template_3_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "p");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](1, "No anomalies found");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_4_Template(rf, ctx) {
        if (rf & 1) {
          var _r31 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "li", 21);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2, "User ");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "b");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](5, " do not have a profile document");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](6, "button", 22);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_4_Template_button_click_6_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r31);

            var missing_r28 = ctx.$implicit;

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

            var ctx_r29 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r29.createMissingProfile(missing_r28, report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](7, "Create profile");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var missing_r28 = ctx.$implicit;

          var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"](missing_r28.uid);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("disabled", !report_r3.done);
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_5_Template(rf, ctx) {
        if (rf & 1) {
          var _r36 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "li", 21);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2, "Document ");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "b");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](5, " do not have a matching user");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](6, "button", 23);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_5_Template_button_click_6_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r36);

            var orphan_r33 = ctx.$implicit;

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

            var ctx_r34 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r34.deleteOrphanProfile(orphan_r33, report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](7, "Delete profile");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var orphan_r33 = ctx.$implicit;

          var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"](orphan_r33.id);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("disabled", !report_r3.done);
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_ng_container_6_li_1_Template(rf, ctx) {
        if (rf & 1) {
          var _r42 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "li", 21);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2, "Folder ");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "b");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](5, " do not have a matching user");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](6, "button", 24);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_ng_container_6_li_1_Template_button_click_6_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r42);

            var folder_r39 = ctx.$implicit;

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](4).ngIf;

            var ctx_r40 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r40.deleteOrphanFolder(folder_r39, report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](7, "Delete folder");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var folder_r39 = ctx.$implicit;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"](folder_r39.name);
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_ng_container_6_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerStart"](0);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](1, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_ng_container_6_li_1_Template, 8, 1, "li", 18);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerEnd"]();
        }

        if (rf & 2) {
          var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngForOf", report_r3.folders);
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_7_Template(rf, ctx) {
        if (rf & 1) {
          var _r47 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "li", 21);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "button", 25);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_7_Template_button_click_3_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r47);

            var missing_r44 = ctx.ngIf;

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

            var ctx_r45 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r45.guessMissingUserNames(missing_r44, report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4, "Guess user names");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var missing_r44 = ctx.ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate1"]("", missing_r44.length, " user(s) miss a unique user name");
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_8_Template(rf, ctx) {
        if (rf & 1) {
          var _r51 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "li", 21);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "button", 25);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_8_Template_button_click_3_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r51);

            var missing_r48 = ctx.ngIf;

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

            var ctx_r49 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r49.guessMissingFullNames(missing_r48, report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4, "Guess full names");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var missing_r48 = ctx.ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate1"]("", missing_r48.length, " user(s) miss the fullName field");
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_9_Template(rf, ctx) {
        if (rf & 1) {
          var _r55 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "li", 21);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "button", 25);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_9_Template_button_click_3_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r55);

            var indexes_r52 = ctx.ngIf;

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](3).ngIf;

            var ctx_r53 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r53.computeMissingSearchIndex(indexes_r52, report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4, "Fix search indexes");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var indexes_r52 = ctx.ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate1"]("", indexes_r52.length, " user(s) aren't searchable or the search index mismatches the user's name");
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_Template(rf, ctx) {
        if (rf & 1) {
          var _r58 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerStart"](0);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "p");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "ul");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](4, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_4_Template, 8, 2, "li", 18);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](5, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_5_Template, 8, 2, "li", 18);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](6, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_ng_container_6_Template, 2, 1, "ng-container", 3);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](7, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_7_Template, 5, 1, "li", 19);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](8, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_8_Template, 5, 1, "li", 19);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](9, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_li_9_Template, 5, 1, "li", 19);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](10, "button", 20);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_Template_button_click_10_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r58);

            var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2).ngIf;

            var ctx_r56 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

            return ctx_r56.fixAllAnomalies(report_r3);
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](11, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](12);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerEnd"]();
        }

        if (rf & 2) {
          var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2).ngIf;

          var msgs_r1 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"]().$implicit;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate1"]("", report_r3.errorsCount, " anomalies detected:");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngForOf", report_r3.missing);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngForOf", report_r3.orphans);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", report_r3.done);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", report_r3.userNameMissing);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", report_r3.fullNameMissing);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", report_r3.searchIndexMissing);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("disabled", !report_r3.done);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"]((msgs_r1.actions == null ? null : msgs_r1.actions.fix == null ? null : msgs_r1.actions.fix.caption) || "Fix all anomalies");
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_ng_container_5_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerStart"](0);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "p");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](3, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_template_3_Template, 2, 0, "ng-template", null, 17, _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplateRefExtractor"]);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](5, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_ng_container_5_Template, 13, 9, "ng-container", 12);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerEnd"]();
        }

        if (rf & 2) {
          var _r19 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵreference"](4);

          var report_r3 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"]().ngIf;

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate1"]("Analysing uid ", report_r3.currentId, "");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](3);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", report_r3.errorsCount > 0)("ngIfElse", _r19);
        }
      }

      function ProfileFixerComponent_ng_container_0_section_5_Template(rf, ctx) {
        if (rf & 1) {
          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](0, "section");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](1, ProfileFixerComponent_ng_container_0_section_5_ng_container_1_Template, 2, 0, "ng-container", 3);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelement"](2, "mat-progress-bar", 10);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](3, ProfileFixerComponent_ng_container_0_section_5_ng_template_3_Template, 2, 0, "ng-template", null, 11, _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplateRefExtractor"]);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](5, ProfileFixerComponent_ng_container_0_section_5_ng_container_5_Template, 6, 3, "ng-container", 12);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();
        }

        if (rf & 2) {
          var report_r3 = ctx.ngIf;

          var _r5 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵreference"](4);

          var ctx_r2 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", ctx_r2.batch || (report_r3.folders == null ? null : report_r3.folders.length));

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("mode", report_r3.users ? "determinate" : "query")("value", 100 * ((report_r3.currentIndex || 0) + 1) / ((report_r3.users == null ? null : report_r3.users.length) || 1));

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](3);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", report_r3.users)("ngIfElse", _r5);
        }
      }

      function ProfileFixerComponent_ng_container_0_Template(rf, ctx) {
        if (rf & 1) {
          var _r63 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵgetCurrentView"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerStart"](0);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](1, "button", 1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵlistener"]("click", function ProfileFixerComponent_ng_container_0_Template_button_click_1_listener() {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵrestoreView"](_r63);

            var ctx_r62 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"]();

            return ctx_r62.run$.next();
          });

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelement"](2, "wm-icon", 2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](3, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](5, ProfileFixerComponent_ng_container_0_section_5_Template, 6, 5, "section", 3);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵpipe"](6, "async");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](7, "wm-dialog", 4);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](8, "h2", 5);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](9, "b");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](10);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](11, "mat-dialog-content", 6);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](12, "span");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](13, "You're about to leave the page without saving the applied fixes.");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelement"](14, "br");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](15, "Please confirm.");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](16, "mat-dialog-actions", 7);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](17, "button", 8);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](18);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementStart"](19, "button", 9);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtext"](20);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementEnd"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵelementContainerEnd"]();
        }

        if (rf & 2) {
          var msgs_r1 = ctx.$implicit;

          var ctx_r0 = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵnextContext"]();

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("icon", (msgs_r1.actions == null ? null : msgs_r1.actions.run == null ? null : msgs_r1.actions.run.icon) || "assignment");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"]((msgs_r1.actions == null ? null : msgs_r1.actions.run == null ? null : msgs_r1.actions.run.caption) || "Analyze users");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("ngIf", _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵpipeBind1"](6, 10, ctx_r0.report$));

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](2);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("dontLeave", ctx_r0.batch);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](3);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"]((msgs_r1.canLeave == null ? null : msgs_r1.canLeave.title) || "Unsaved fixes");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("wm-readme", msgs_r1.canLeave == null ? null : msgs_r1.canLeave.message);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](6);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("mat-dialog-close", false);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"]((msgs_r1.canLeave == null ? null : msgs_r1.canLeave.cancel) || "Stay");

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("mat-dialog-close", true);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵadvance"](1);

          _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtextInterpolate"]((msgs_r1.canLeave == null ? null : msgs_r1.canLeave.ok) || "Leave anyhow");
        }
      }

      var ProfileFixerComponent = /*#__PURE__*/function () {
        function ProfileFixerComponent(client, users, st) {
          var _this = this;

          _classCallCheck(this, ProfileFixerComponent);

          this.client = client;
          this.users = users;
          this.st = st;
          this.run$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__["Subject"](); // Builds the report observable to emit each step of the analysis

          this.report$ = this.run$.pipe( // Starts by resetting the WriteBatch, if any.
          Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["tap"])(function () {
            _this.batch = null;
          }), // Concatenates two tasks
          Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["switchMap"])(function () {
            return Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["concat"])( // First task simply emits an empty report to display the 'Fetchind data' message while loading data from the server
            Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["of"])({}), // Second task starts by loading all the data from the server
            Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["forkJoin"])(_this.listAllUsers(), _this.listAllProfiles(), _this.listAllFolders()).pipe( // Collects the results to initialize the repoprt with the input data
            Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["map"])(function (_ref) {
              var _ref2 = _slicedToArray(_ref, 3),
                  users = _ref2[0],
                  profiles = _ref2[1],
                  folders = _ref2[2];

              return {
                users: users,
                profiles: profiles,
                folders: folders,
                missing: [],
                orphans: [],
                currentId: '',
                errorsCount: 0
              };
            }), // Runs every UserRecord by the animationScheduler
            Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["switchMap"])(function (report) {
              return Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["from"])(report.users, rxjs__WEBPACK_IMPORTED_MODULE_0__["animationFrameScheduler"]).pipe( // Analyze each record building up the resulting report
              Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["scan"])(function (report, user, index) {
                // Keeps track of the pregress
                report.currentId = user.uid;
                report.currentIndex = index; // Gets the profile supposidely matching the UserRecord. Note that both UserRecord[] and 
                // UserData[] arrays are purposely sorted in ascending uid order server side

                var profile = report.profiles[index - report.missing.length + report.orphans.length]; // Matches the UserRecord with the profile:
                // 1. Accounts for missing profiles (the user exists without a profile)

                if (!profile || profile.id > user.uid) {
                  report.missing.push(user);
                  report.errorsCount++;
                } // 2. Accounts for orphan profiles (the profile exists without a user)
                else if (profile.id < user.uid) {
                    report.orphans.push(profile);
                    report.errorsCount++;
                  } // Verifies the user has a storage folder


                var folderIndex = report.folders.findIndex(function (folder) {
                  return folder.name === user.uid;
                });

                if (folderIndex >= 0) {
                  report.folders.splice(folderIndex, 1);
                } // Analyzes the profile for inconsistencies


                _this.analyzeProfile(profile, report); // Emits the current report


                return report;
              }, report), // Once every UserRecord as being analyzed, lets check for orphan profiles
              Object(_wizdm_rxjs__WEBPACK_IMPORTED_MODULE_5__["append"])(function (report) {
                // Computes the starting position accounting for missing and already discovered orphan profiles
                var start = report.users.length - report.missing.length + report.orphans.length; // Completes if there's nothing left to do

                if (start >= report.profiles.length) {
                  return Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["empty"])();
                } // Runs every profile left otherwise


                return Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["from"])(report.profiles.slice(start), rxjs__WEBPACK_IMPORTED_MODULE_0__["animationFrameScheduler"]).pipe( // Analyze each orhpan profile
                Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["scan"])(function (report, profile) {
                  // Keeps track of the progress
                  report.currentId = profile.id;
                  report.currentIndex++; // Collects the orphans 

                  report.orphans.push(profile);
                  report.errorsCount++; // Emits the report

                  return report;
                }, report));
              }, report), // Done
              Object(_wizdm_rxjs__WEBPACK_IMPORTED_MODULE_5__["append"])(function (report) {
                return Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["of"])(Object.assign(Object.assign({}, report), {
                  done: true
                }));
              }));
            })));
          }));
        }
        /** The DatabaseService */


        _createClass(ProfileFixerComponent, [{
          key: "db",
          get: function get() {
            return this.users.db;
          }
          /** List all users returning them in ascending order sorted by uid */

        }, {
          key: "listAllUsers",
          value: function listAllUsers() {
            return this.client.get('users');
          }
          /** List all user's profile ordered by id */

        }, {
          key: "listAllProfiles",
          value: function listAllProfiles() {
            var _this2 = this;

            return Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["defer"])(function () {
              return _this2.users.get(function (qf) {
                return qf.orderBy(_this2.db.sentinelId);
              });
            });
          }
          /** Deletes a storage folder from the default bucket */

        }, {
          key: "deleteFolder",
          value: function deleteFolder(prefix) {
            return this.client["delete"]("folders/".concat(prefix));
          }
          /** List all storage folders */

        }, {
          key: "listAllFolders",
          value: function listAllFolders() {
            return this.st.reference('/').listAll().pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["map"])(function (result) {
              return result.prefixes;
            }));
          }
          /** Analyzes a profile serching for inconsistencies */

        }, {
          key: "analyzeProfile",
          value: function analyzeProfile(profile, report) {
            // Skips when no profile is given
            if (!profile) {
              return report;
            } // Checks for user names. Required for user profile navigation


            if (!profile.userName) {
              report.userNameMissing = (report['userNameMissing'] || []).concat(profile);
              report.errorsCount++;
            } // Checks for full names. Required for user sorting


            if (!profile.fullName) {
              report.fullNameMissing = (report['fullNameMissing'] || []).concat(profile);
              report.errorsCount++;
            } // Checks for search indexes. Required for user searching


            if (!profile.searchIndex) {
              report.searchIndexMissing = (report['searchIndexMissing'] || []).concat(profile);
              report.errorsCount++;
            } else {
              // Computes a new search index to compare the profile with 
              var _this$users$formatDat = this.users.formatData(Object.assign({
                lastName: ''
              }, profile)),
                  searchIndex = _this$users$formatDat.searchIndex; // Compare the search indexes for equality


              if (searchIndex.length !== profile.searchIndex.length || searchIndex.some(function (value, index) {
                return value !== profile.searchIndex[index];
              })) {
                report.searchIndexMissing = (report['searchIndexMissing'] || []).concat(profile);
                report.errorsCount++;
              }
            }

            return report;
          }
          /** Creates a new profile from the user record (BatchWrite) */

        }, {
          key: "createMissingProfile",
          value: function createMissingProfile(user, report) {
            var index = report.missing.findIndex(function (missing) {
              return missing === user;
            });

            if (index >= 0) {
              var batch = this.batch || (this.batch = this.db.batch());
              batch.set(this.users.ref.doc(user.uid), this.users.userData(user));
              report.missing.splice(index, 1);
              report.errorsCount--;
            }
          }
          /** Deletes the orphan profile (WriteBatch) */

        }, {
          key: "deleteOrphanProfile",
          value: function deleteOrphanProfile(profile, report) {
            var index = report.orphans.findIndex(function (orphan) {
              return orphan === profile;
            });

            if (index >= 0) {
              var batch = this.batch || (this.batch = this.db.batch());
              batch["delete"](this.users.ref.doc(profile.id));
              report.orphans.splice(index, 1);
              report.errorsCount--;
            }
          }
          /** Deletes the orphan folder immediately */

        }, {
          key: "deleteOrphanFolder",
          value: function deleteOrphanFolder(folder, report) {
            var index = report.folders.findIndex(function (orphan) {
              return orphan === folder;
            });

            if (index >= 0) {
              this.deleteFolder(folder.name).subscribe(function () {
                report.folders.splice(index, 1);
                report.errorsCount--;
              });
            }
          }
          /** Guesse a user nick-name (WriteBatch) */

        }, {
          key: "guessMissingUserNames",
          value: function guessMissingUserNames(profiles, report) {
            var _this3 = this;

            if (!profiles) {
              return;
            }

            var batch = this.batch || (this.batch = this.db.batch());
            var guesses = [];
            Promise.all(profiles.map(function (profile) {
              var _this3$users$formatDa = _this3.users.formatData(Object.assign({
                lastName: ''
              }, profile)),
                  fullName = _this3$users$formatDa.fullName;

              return _this3.users.guessUserName(fullName).then(function (userName) {
                while (guesses.find(function (guess) {
                  return guess === userName;
                })) {
                  userName = userName.concat('z');
                }

                console.log("Guessing", userName);
                batch.update(_this3.users.ref.doc(profile.id), {
                  userName: userName
                });
                guesses.push(userName);
                report.errorsCount--;
              });
            })).then(function () {
              return delete report.userNameMissing;
            });
          }
          /** Guesses a user's fullName (WriteBatch) */

        }, {
          key: "guessMissingFullNames",
          value: function guessMissingFullNames(profiles, report) {
            var _this4 = this;

            if (!profiles) {
              return;
            }

            var batch = this.batch || (this.batch = this.db.batch());
            profiles.forEach(function (profile) {
              var _this4$users$formatDa = _this4.users.formatData(Object.assign({
                lastName: ''
              }, profile)),
                  fullName = _this4$users$formatDa.fullName;

              batch.update(_this4.users.ref.doc(profile.id), {
                fullName: fullName
              });
              report.errorsCount--;
            });
            delete report.userNameMissing;
          }
          /** Coputes the search index (WriteBatch) */

        }, {
          key: "computeMissingSearchIndex",
          value: function computeMissingSearchIndex(profiles, report) {
            var _this5 = this;

            if (!profiles) {
              return;
            }

            var batch = this.batch || (this.batch = this.db.batch());
            profiles.forEach(function (profile) {
              var _this5$users$formatDa = _this5.users.formatData(Object.assign({
                lastName: ''
              }, profile)),
                  searchIndex = _this5$users$formatDa.searchIndex;

              batch.update(_this5.users.ref.doc(profile.id), {
                searchIndex: searchIndex
              });
              report.errorsCount--;
            });
            delete report.searchIndexMissing;
          }
          /**  */

        }, {
          key: "fixAllAnomalies",
          value: function fixAllAnomalies(report) {
            var _this6 = this;

            var _a, _b;

            (_a = report.missing) === null || _a === void 0 ? void 0 : _a.forEach(function (user) {
              return _this6.createMissingProfile(user, report);
            });
            (_b = report.orphans) === null || _b === void 0 ? void 0 : _b.forEach(function (profile) {
              return _this6.deleteOrphanProfile(profile, report);
            });
            this.guessMissingUserNames(report.userNameMissing, report);
            this.computeMissingSearchIndex(report.searchIndexMissing, report);
          }
        }, {
          key: "applyAllFixes",
          value: function applyAllFixes(report) {
            var _this7 = this;

            if (!report) {
              return;
            }

            Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["forkJoin"])(Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["from"])(this.batch ? this.batch.commit() : Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["empty"])()), Object(rxjs__WEBPACK_IMPORTED_MODULE_0__["from"])(report.folders || []).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_4__["switchMap"])(function (folder) {
              return _this7.deleteFolder(folder.name);
            }))).toPromise().then(function () {
              return _this7.batch = null;
            });
          }
        }]);

        return ProfileFixerComponent;
      }();

      ProfileFixerComponent.ɵfac = function ProfileFixerComponent_Factory(t) {
        return new (t || ProfileFixerComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵdirectiveInject"](_wizdm_connect_functions_client__WEBPACK_IMPORTED_MODULE_2__["FunctionsClient"]), _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵdirectiveInject"](app_utils_user__WEBPACK_IMPORTED_MODULE_3__["UserProfile"]), _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵdirectiveInject"](_wizdm_connect_storage__WEBPACK_IMPORTED_MODULE_1__["StorageService"]));
      };

      ProfileFixerComponent.ɵcmp = _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵdefineComponent"]({
        type: ProfileFixerComponent,
        selectors: [["wm-profile-fixer"]],
        decls: 1,
        vars: 1,
        consts: [[4, "wmContent", "wmContentSelect"], ["mat-stroked-button", "", "color", "primary", 3, "click"], [3, "icon"], [4, "ngIf"], [3, "dontLeave"], ["mat-dialog-title", ""], [3, "wm-readme"], ["align", "end"], ["mat-button", "", "color", "primary", "cdkFocusInitial", "", 3, "mat-dialog-close"], ["mat-button", "", "color", "warn", 3, "mat-dialog-close"], ["color", "primary", 3, "mode", "value"], ["fetchingUsers", ""], [4, "ngIf", "ngIfElse"], ["wmActionbar", ""], ["mat-flat-button", "", "type.lt-sm", "icon", "color", "primary", 3, "disabled", "click"], [3, "icon", 4, "ngIf", "ngIfElse"], ["applyFixes", ""], ["allFine", ""], ["fxLayoutGap", "8px", 4, "ngFor", "ngForOf"], ["fxLayoutGap", "8px", 4, "ngIf"], ["mat-stroked-button", "", "color", "warn", 3, "disabled", "click"], ["fxLayoutGap", "8px"], ["mat-button", "", "color", "accent", 3, "disabled", "click"], ["mat-button", "", "color", "warn", 3, "disabled", "click"], ["mat-button", "", "color", "warn", 3, "click"], ["mat-button", "", "color", "accent", 3, "click"]],
        template: function ProfileFixerComponent_Template(rf, ctx) {
          if (rf & 1) {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵtemplate"](0, ProfileFixerComponent_ng_container_0_Template, 21, 12, "ng-container", 0);
          }

          if (rf & 2) {
            _angular_core__WEBPACK_IMPORTED_MODULE_6__["ɵɵproperty"]("wmContentSelect", "admin-fixer");
          }
        },
        directives: [_content_src_lib_streamer_content_directive__WEBPACK_IMPORTED_MODULE_7__["ContentDirective"], _angular_material_button__WEBPACK_IMPORTED_MODULE_8__["MatButton"], _elements_src_lib_icon_icon_component__WEBPACK_IMPORTED_MODULE_9__["IconComponent"], _angular_common__WEBPACK_IMPORTED_MODULE_10__["NgIf"], _elements_src_lib_dialog_dialog_component__WEBPACK_IMPORTED_MODULE_11__["DialogComponent"], _utils_can_leave_can_leave_directive__WEBPACK_IMPORTED_MODULE_12__["CanLeaveDirective"], _angular_material_dialog__WEBPACK_IMPORTED_MODULE_13__["MatDialogTitle"], _angular_material_dialog__WEBPACK_IMPORTED_MODULE_13__["MatDialogContent"], _readme_src_lib_readme_component__WEBPACK_IMPORTED_MODULE_14__["ReadmeComponent"], _angular_material_dialog__WEBPACK_IMPORTED_MODULE_13__["MatDialogActions"], _angular_material_dialog__WEBPACK_IMPORTED_MODULE_13__["MatDialogClose"], _angular_material_progress_bar__WEBPACK_IMPORTED_MODULE_15__["MatProgressBar"], _navigator_actionbar_actionbar_directive__WEBPACK_IMPORTED_MODULE_16__["ActionbarDirective"], _elements_src_lib_button_button_media_changer_directive__WEBPACK_IMPORTED_MODULE_17__["ButtonMediaChanger"], _angular_common__WEBPACK_IMPORTED_MODULE_10__["NgForOf"], _angular_flex_layout_flex__WEBPACK_IMPORTED_MODULE_18__["DefaultLayoutGapDirective"]],
        pipes: [_angular_common__WEBPACK_IMPORTED_MODULE_10__["AsyncPipe"]],
        styles: ["[_nghost-%COMP%] {\n  position: relative;\n  min-height: 100%;\n  padding-top: 32px;\n  display: flex;\n  flex-direction: column;\n}\n[_nghost-%COMP%]   .mat-progress-bar[_ngcontent-%COMP%] {\n  margin-bottom: 16px;\n}\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2ZpbGUtZml4ZXIuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0E7RUFFRSxrQkFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7RUFFQSxhQUFBO0VBQ0Esc0JBQUE7QUFGRjtBQU1FO0VBQW9CLG1CQUFBO0FBSHRCIiwiZmlsZSI6InByb2ZpbGUtZml4ZXIuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJcbjpob3N0IHtcblxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1pbi1oZWlnaHQ6IDEwMCU7XG4gIHBhZGRpbmctdG9wOiAzMnB4O1xuXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIC8vanVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIC8vYWxpZ24taXRlbXM6IGNlbnRlcjtcblxuICAubWF0LXByb2dyZXNzLWJhciB7IG1hcmdpbi1ib3R0b206IDE2cHg7IH1cbn0iXX0= */"]
      });
      /***/
    },

    /***/
    "joOy":
    /*!*************************************************************************!*\
      !*** ./wizdm/src/app/pages/admin/profile-fixer/profile-fixer.module.ts ***!
      \*************************************************************************/

    /*! exports provided: ProfileFixerModule */

    /***/
    function joOy(module, __webpack_exports__, __webpack_require__) {
      "use strict";

      __webpack_require__.r(__webpack_exports__);
      /* harmony export (binding) */


      __webpack_require__.d(__webpack_exports__, "ProfileFixerModule", function () {
        return ProfileFixerModule;
      });
      /* harmony import */


      var _angular_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(
      /*! @angular/common */
      "SVse");
      /* harmony import */


      var _angular_flex_layout__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(
      /*! @angular/flex-layout */
      "u9T3");
      /* harmony import */


      var _angular_material_button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(
      /*! @angular/material/button */
      "Dxy4");
      /* harmony import */


      var _angular_material_progress_bar__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(
      /*! @angular/material/progress-bar */
      "BTe0");
      /* harmony import */


      var _wizdm_elements_icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(
      /*! @wizdm/elements/icon */
      "txmD");
      /* harmony import */


      var _wizdm_readme__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(
      /*! @wizdm/readme */
      "C1VQ");
      /* harmony import */


      var _wizdm_elements_dialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(
      /*! @wizdm/elements/dialog */
      "XNpK");
      /* harmony import */


      var _wizdm_elements_button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(
      /*! @wizdm/elements/button */
      "uaks");
      /* harmony import */


      var _wizdm_content__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(
      /*! @wizdm/content */
      "g7MM");
      /* harmony import */


      var app_utils_can_leave__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(
      /*! app/utils/can-leave */
      "h4JL");
      /* harmony import */


      var app_navigator_actionbar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(
      /*! app/navigator/actionbar */
      "kNiW");
      /* harmony import */


      var _profile_fixer_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(
      /*! ./profile-fixer.component */
      "0DpH");
      /* harmony import */


      var _angular_core__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(
      /*! @angular/core */
      "8Y7J");
      /* harmony import */


      var _content_src_lib_router_content_router_module__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(
      /*! ../../../../../../content/src/lib/router/content-router.module */
      "J3Me");

      var routes = [{
        path: '',
        content: 'admin-fixer',
        component: _profile_fixer_component__WEBPACK_IMPORTED_MODULE_11__["ProfileFixerComponent"],
        canDeactivate: [app_utils_can_leave__WEBPACK_IMPORTED_MODULE_9__["CanLeaveGuard"]]
      }];

      var ProfileFixerModule = function ProfileFixerModule() {
        _classCallCheck(this, ProfileFixerModule);
      };

      ProfileFixerModule.ɵmod = _angular_core__WEBPACK_IMPORTED_MODULE_12__["ɵɵdefineNgModule"]({
        type: ProfileFixerModule
      });
      ProfileFixerModule.ɵinj = _angular_core__WEBPACK_IMPORTED_MODULE_12__["ɵɵdefineInjector"]({
        factory: function ProfileFixerModule_Factory(t) {
          return new (t || ProfileFixerModule)();
        },
        imports: [[_angular_common__WEBPACK_IMPORTED_MODULE_0__["CommonModule"], _angular_flex_layout__WEBPACK_IMPORTED_MODULE_1__["FlexLayoutModule"], _angular_material_button__WEBPACK_IMPORTED_MODULE_2__["MatButtonModule"], _angular_material_progress_bar__WEBPACK_IMPORTED_MODULE_3__["MatProgressBarModule"], _wizdm_elements_icon__WEBPACK_IMPORTED_MODULE_4__["IconModule"], _wizdm_readme__WEBPACK_IMPORTED_MODULE_5__["ReadmeModule"], _wizdm_elements_dialog__WEBPACK_IMPORTED_MODULE_6__["DialogModule"], _wizdm_elements_button__WEBPACK_IMPORTED_MODULE_7__["ButtonChangerModule"], app_navigator_actionbar__WEBPACK_IMPORTED_MODULE_10__["ActionbarModule"], app_utils_can_leave__WEBPACK_IMPORTED_MODULE_9__["CanLeaveModule"], _wizdm_content__WEBPACK_IMPORTED_MODULE_8__["ContentRouterModule"].forChild(routes)]]
      });

      (function () {
        (typeof ngJitMode === "undefined" || ngJitMode) && _angular_core__WEBPACK_IMPORTED_MODULE_12__["ɵɵsetNgModuleScope"](ProfileFixerModule, {
          declarations: [_profile_fixer_component__WEBPACK_IMPORTED_MODULE_11__["ProfileFixerComponent"]],
          imports: [_angular_common__WEBPACK_IMPORTED_MODULE_0__["CommonModule"], _angular_flex_layout__WEBPACK_IMPORTED_MODULE_1__["FlexLayoutModule"], _angular_material_button__WEBPACK_IMPORTED_MODULE_2__["MatButtonModule"], _angular_material_progress_bar__WEBPACK_IMPORTED_MODULE_3__["MatProgressBarModule"], _wizdm_elements_icon__WEBPACK_IMPORTED_MODULE_4__["IconModule"], _wizdm_readme__WEBPACK_IMPORTED_MODULE_5__["ReadmeModule"], _wizdm_elements_dialog__WEBPACK_IMPORTED_MODULE_6__["DialogModule"], _wizdm_elements_button__WEBPACK_IMPORTED_MODULE_7__["ButtonChangerModule"], app_navigator_actionbar__WEBPACK_IMPORTED_MODULE_10__["ActionbarModule"], app_utils_can_leave__WEBPACK_IMPORTED_MODULE_9__["CanLeaveModule"], _content_src_lib_router_content_router_module__WEBPACK_IMPORTED_MODULE_13__["ContentRouterModule"]]
        });
      })();
      /***/

    }
  }]);
})();
//# sourceMappingURL=profile-fixer-profile-fixer-module-es5.js.map